# Template file for 'irrlicht'
pkgname=irrlicht
version=1.8.1
revision=1
hostmakedepends="unzip pkg-config"
makedepends="libjpeg-turbo-devel libpng-devel libXcursor-devel libXext-devel MesaLib-devel"
short_desc="Lightning fast realtime 3D engine"
maintainer="Juan RP <xtraeme@voidlinux.eu>"
license="LGPL-2.1"
homepage="http://irrlicht.sourceforge.net"
distfiles="${SOURCEFORGE_SITE}/${pkgname}/${pkgname}-${version}.zip"
checksum=814bb90116d5429449ba1d169e2cbff881c473b7eada4c2447132bc4f4a6e97b

pre_build() {
	cd source/Irrlicht
	for file in COpenGLExtensionHandler.h glext.h glxext.h wglext.h; do
		$XBPS_FETCH_CMD "http://sourceforge.net/p/irrlicht/code/4600/tree/trunk/source/Irrlicht/${file}?format=raw>${file}"
	done
}
do_build() {
	cd source/Irrlicht
	make ${makejobs} NDEBUG=1 sharedlib
	make ${makejobs} NDEBUG=1
}
do_install() {
	cd source/Irrlicht

	vmkdir usr/lib
	sed -i "/^INSTALL_DIR/s:=.*:=${DESTDIR}/usr/lib:" Makefile
	make install

	cd ${wrksrc}
	vinstall lib/Linux/libIrrlicht.a 644 usr/lib
	chmod 644 ${DESTDIR}/usr/include/$pkgname/*

	cd ${DESTDIR}/usr/lib
	ln -s libIrrlicht.so.${version} libIrrlicht.so.1
}

irrlicht-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}-${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
	}
}
