# Template file for 'darktable'
pkgname=darktable
version=1.4.2
revision=3
build_style=cmake
maintainer="Carlo Dormeletti <carlo.dormeletti@email.it>"
homepage="http://www.darktable.org/"
license="GPL"
short_desc="Virtual lighttable and darkroom for photographers"
hostmakedepends="cmake pkg-config intltool"
makedepends="gtk+-devel glib-devel exiv2-devel lcms2-devel
  libglade-devel libxslt-devel dbus-glib-devel libcurl-devel libgphoto2-devel
  libwebp-devel libsoup-devel lensfun-devel sqlite-devel librsvg-devel 
  lua-devel json-glib-devel libgomp-devel colord-devel libopenjpeg-devel 
  libopenexr-devel libgraphicsmagick-devel SDL-devel"

distfiles="${SOURCEFORGE_SITE}/${pkgname}/1.4/${pkgname}-${version}.tar.xz"
checksum="c1311a6e336007b85d21647652ebec3e26840248a968eab04ab5f0a56c2e0709"

# This needs to be built with SSE, otherwise some CPUs might crash with
# an ilegal instruction (vstmxcsr). Notably most AMD CPUs with -mtune=generic.
#
# Let's assume this has been fixed in recent gcc versions and just force SSE.
CXXFLAGS="-msse"

post_install() {
	mv ${DESTDIR}/usr/lib/darktable/libdarktable.so ${DESTDIR}/usr/lib/
}
