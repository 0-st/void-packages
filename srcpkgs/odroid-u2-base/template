# Template file for 'odroid-u2-base'
pkgname=odroid-u2-base
version=1.4
revision=3
build_style=meta
homepage="http://www.voidlinux.eu"
short_desc="Void Linux Odroid U2 platform package"
maintainer="Enno Boland <eb@s01.de>"
license="Public Domain"

only_for_archs="armv7l"
makedepends="ntp?ntp-daemon dhcpcd openssh-server odroid-u2-kernel"
depends="${makedepends}"
hostmakedepends="uboot-mkimage"

conf_files=/etc/default/odroid-led

# enable odroid-led, ntpd, dhcpcd and sshd by default.
systemd_services="
	odroid-led.service on
	ntpdate.service on
	ntpd.service on
	dhcpcd.service on
	sshd.service on"

# Allow upgrades for compatibility.
provides="odroid-u2-ubootcfg-${version}_${revision}"
replaces="odroid-u2-ubootcfg>=0"

_default_scr="boot-auto_edid.scr"

do_build() {
	# Building uboot scr's
	for source in ${FILESDIR}/*.ini; do
		name=$(basename ${source%.ini})
		mkimage -A arm -T script -C none -n "${name}" -d $source ${name}.scr
	done
	cp ${_default_scr} boot.scr
}

do_install() {
	# Install uboot scr's
	for scr in *.scr; do
		echo $scr
		vinstall $scr 600 boot
	done

	# Install LED utilities
	vinstall ${FILESDIR}/odroid-led 744 /usr/sbin
	vinstall ${FILESDIR}/odroid-led.default 744 /etc/default odroid-led
	vinstall ${FILESDIR}/odroid-led.service 644 /usr/lib/systemd/system
}
