# Template file for 'unzip'
pkgname=unzip
version=6.0
homepage="http://infozip.sf.net/"
license="BSD"
makedepends="bzip2-devel"
wrksrc=unzip60
distfiles="${SOURCEFORGE_SITE}/infozip/${pkgname}60.tar.gz"
revision=2
short_desc="List, test and extract compressed files in a ZIP archive"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=036d96991646d0449ed0aa952e4fbe21b476ce994abc276e49d30e686708bd37

CFLAGS="-D_FILE_OFFSET_BITS=64 -DWILD_STOP_AT_DIR -DLARGE_FILE_SUPPORT"
CFLAGS="${CFLAGS} -DUNICODE_SUPPORT -DUNICODE_WCHAR -DUTF8_MAYBE_NATIVE"
CFLAGS="${CFLAGS} -DNO_LCHMOD -DDATE_FORMAT=DF_YMD -DUSE_BZIP2 -DNATIVE"

do_build()
{
	cd ${wrksrc} && make ${makejobs} -f unix/Makefile LOCAL_UNZIP="$CFLAGS" \
		prefix=/usr LF2="" CC=$CC D_USE_BZ2=-DUSE_BZIP2 \
		L_BZ2=-lbz2 unzips || return 1
}

do_install()
{
	cd ${wrksrc} && make ${makejobs} -f unix/Makefile prefix=${DESTDIR}/usr \
		LN='ln -fs' INSTALL_PROGRAM="install" install || return 1
	mkdir -p ${DESTDIR}/usr/share && \
		mv ${DESTDIR}/usr/man ${DESTDIR}/usr/share
}
