# Template file for 'cyrus-sasl'
. ${XBPS_SRCPKGDIR}/libsasl/template

# Unset some unneeded stuff.
unset run_depends build_depends

pkgname=cyrus-sasl
configure_args="--with-saslauthd=/run/saslauthd
--enable-login --enable-plain --enable-sql --disable-sqlite
--enable-postgresql --enable-mysql --enable-ldapdb --with-ldap=/usr"
depends="e2fsprogs-libs cyrus-sasl-modules"
makedepends="libsasl-devel libldap-devel mit-krb5-devel e2fsprogs-devel pam-devel openssl-devel postgresql-libs-devel libmysqlclient-devel"
short_desc="Cyrus SASL - auth daemon and administration tools"
long_desc="${long_desc}

 This package includes the Cyrus SASL authentication daemon and administration
 programs for the SASL users database and common binary files for plugin
 modules."

revision=6
subpackages="${pkgname}-modules-ldap ${pkgname}-modules-sql ${pkgname}-modules"
systemd_services="saslauthd.service on"
conf_files="/etc/conf.d/saslauthd"



post_install()
{
	# Remove stuff in libsasl{,-devel} pkgs.
	rm -rf ${DESTDIR}/usr/share/man/man3
	rm -rf ${DESTDIR}/usr/include
	rm -f ${DESTDIR}/usr/lib/libsasl*
	rm -rf ${DESTDIR}/usr/lib/sasl2/libsasldb*

	# systemd
	vinstall ${FILESDIR}/saslauthd.service 644 lib/systemd/system
	vinstall ${FILESDIR}/saslauthd.tmpfiles.d 644 \
		usr/lib/tmpfiles.d saslauthd.conf
}
