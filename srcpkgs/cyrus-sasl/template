# Template file for 'cyrus-sasl'
. ${XBPS_SRCPKGDIR}/libsasl/template

# Unset some unneeded stuff.
unset run_depends build_depends

pkgname=cyrus-sasl
configure_args="--with-saslauthd=/run/saslauthd
--enable-login --enable-plain --enable-sql --disable-sqlite
--enable-postgresql --enable-mysql --enable-ldapdb --with-ldap=/usr"
short_desc="Cyrus SASL - auth daemon and administration tools"
long_desc="${long_desc}

 This package includes the Cyrus SASL authentication daemon and administration
 programs for the SASL users database and common binary files for plugin
 modules."

revision=5
subpackages="${pkgname}-modules-ldap ${pkgname}-modules-sql ${pkgname}-modules"
systemd_services="saslauthd.service on"
conf_files="/etc/conf.d/saslauthd"

Add_dependency run mit-krb5-libs
Add_dependency run e2fsprogs-libs
Add_dependency run cyrus-sasl-modules

Add_dependency build libsasl-devel
Add_dependency build libldap-devel
Add_dependency build mit-krb5-devel
Add_dependency build e2fsprogs-devel
Add_dependency build pam-devel
Add_dependency build openssl-devel
Add_dependency build postgresql-libs-devel
Add_dependency build libmysqlclient-devel

post_install()
{
	# Remove stuff in libsasl{,-devel} pkgs.
	rm -rf ${DESTDIR}/usr/share/man/man3
	rm -rf ${DESTDIR}/usr/include
	rm -f ${DESTDIR}/usr/lib/libsasl*
	rm -rf ${DESTDIR}/usr/lib/sasl2/libsasldb*

	# systemd
	vinstall ${FILESDIR}/saslauthd.service 644 lib/systemd/system
	vinstall ${FILESDIR}/saslauthd.tmpfiles.d 644 \
		usr/lib/tmpfiles.d saslauthd.conf
}
