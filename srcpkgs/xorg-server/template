# Template build file for 'xorg-server'.
pkgname=xorg-server
version=1.13.2
revision=1
build_style=gnu-configure
configure_args="--enable-ipv6 --enable-xcsecurity --enable-record
 --enable-xnest --enable-xephyr --enable-composite --enable-xvfb
 --enable-glx-tls --disable-static --disable-config-hal
 --disable-config-dbus --enable-config-udev --sysconfdir=/etc/X11
 --with-xkb-path=/usr/share/X11/xkb --with-xkb-output=/var/lib/xkb
 --with-fontrootdir=/usr/share/fonts/X11 --with-sha1=libcrypto
 --disable-dmx --disable-xfree86-utils --enable-dga --enable-xorg
 --enable-install-setuid --disable-xfbdev --disable-xfake
 --enable-kdrive --enable-kdrive-evdev --enable-kdrive-kbd
 --enable-kdrive-mouse --enable-xorg --enable-xcsecurity"
short_desc="The X11 server from X.org"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://xorg.freedesktop.org"
license="MIT/X11, BSD"
distfiles="${XORG_SITE}/xserver/${pkgname}-${version}.tar.bz2"
checksum=3850adb89e9170ad85aea39d240279494c07779e50cd3cd60126028681209408

subpackages="${pkgname}-xnest ${pkgname}-xephyr ${pkgname}-xvfb
 ${pkgname}-devel"
fulldepends="xkeyboard-config"

# See hw/xfree86/common/xf86Module.h. Only care for the major version.
provides="xserver-abi-extension-7 xserver-abi-input-18 xserver-abi-video-13"

makedepends="pkg-config perl flex inputproto>=2.2 glproto>=1.4.15 xproto>=7.0.22
 dri2proto>=2.1 xf86driproto randrproto videoproto compositeproto scrnsaverproto
 resourceproto>=1.2.0 xineramaproto xcmiscproto bigreqsproto libudev-devel>=183
 openssl-devel libX11-devel libXext-devel libdmx-devel libpciaccess-devel
 libXfont-devel libXmu-devel libXrender-devel libXfixes-devel libXi-devel
 libXaw-devel libdrm-devel libXtst-devel libXres-devel libxkbui-devel
 libxkbfile-devel libXxf86dga-devel libXv-devel pixman-devel MesaLib-devel"

post_install() {
	vinstall ${FILESDIR}/11-quirks.conf 644 etc/X11/xorg.conf.d
	vinstall COPYING 644 usr/share/licenses/${pkgname}
	# Support nvidia and amd binary blobs to provide their own
	# implementation.
	mv ${DESTDIR}/usr/lib/xorg/modules/extensions/libglx.so \
		${DESTDIR}/usr/lib/xorg/modules/extensions/libglx-xorg.so
}
