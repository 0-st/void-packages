# Template file for 'pciutils'
pkgname=pciutils
version=3.1.7
revision=1
distfiles="http://www.kernel.org/pub/software/utils/$pkgname/$pkgname-$version.tar.gz"
build_style=custom-install
short_desc="PCI bus related utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=0f39818eabd793bb48d5b98ca52141d8247306a85876482c0075d0c95aeccea2
long_desc="
 The $pkgname package contains various utilities for inspecting and
 setting devices connected to the PCI bus."

subpackages="$pkgname-devel"
Add_dependency run glibc
Add_dependency build wget
Add_dependency build which

do_install()
{
	cd $wrksrc
	sed -i -e 's/^OPT=.*/OPT=-O2 -pipe -fPIC -DPIC/g' Makefile
	./update-pciids.sh

	make ZLIB=no DNS=no PREFIX=/usr SHAREDIR=/usr/share/hwdata \
		MANDIR=/usr/share/man DESTDIR=${DESTDIR} \
		all install-lib || exit 1
	make clean
	make ZLIB=no SHARED=yes DNS=no PREFIX=/usr SHAREDIR=/usr/share/hwdata \
		MANDIR=/usr/share/man DESTDIR=${DESTDIR} \
		all install-lib || exit 1
	make PREFIX=/usr DESTDIR=${DESTDIR} SHAREDIR=/usr/share/hwdata \
		MANDIR=/usr/share/man install || exit 1
	for i in config.h header.h pci.h types.h; do
		install -D -m 644 lib/${i} ${DESTDIR}/usr/include/pci/${i}
	done
	cd ${DESTDIR}/usr/lib && \
		ln -sf libpci.so.${version} libpci.so.3 && \
		ln -sf libpci.so.${version} libpci.so
}
