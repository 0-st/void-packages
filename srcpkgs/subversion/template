# Template file for 'subversion'
pkgname=subversion
version=1.6.17
homepage="http://subversion.apache.org/"
distfiles="$homepage/downloads/$pkgname-$version.tar.bz2"
build_style=custom-install
short_desc="Enterprise-class centralized version control for the masses"
maintainer="Juan RP <xtraeme@gmail.com>"
license="Apache-2.0, BSD"
checksum=d629c657e171616d30cc0cbddf1011a065770813bfc32f78c6940d09ca868124
long_desc="
 Apache Subversion is a full-featured version control system originally
 designed to be a better CVS. Subversion has since expanded beyond its
 original goal of replacing CVS, but its basic model, design, and interface
 remain heavily influenced by that goal. Even today, Subversion should still
 feel very familiar to CVS users."

# XXX enable kwallet when kdelibs is available.
subpackages="$pkgname-python $pkgname-perl $pkgname-ruby"
subpackages="${subpackages} $pkgname-gnome-keyring-auth $pkgname-devel"
subpackages="${subpackages} $pkgname-apache libsvn"

Add_dependency run glibc
Add_dependency run libsasl
Add_dependency run apr
Add_dependency run libsvn			">=${version}"

Add_dependency build pkg-config
Add_dependency build perl
Add_dependency build ruby-devel
Add_dependency build python-devel
Add_dependency build swig
Add_dependency build apr-util-devel
Add_dependency build libldap-devel
Add_dependency build db-devel
Add_dependency build gdbm-devel
Add_dependency build expat-devel
Add_dependency build apr-devel
Add_dependency build libuuid-devel
Add_dependency build zlib-devel
Add_dependency build sqlite-devel
Add_dependency build libsasl-devel
Add_dependency build dbus-devel
Add_dependency build libgnome-keyring-devel
Add_dependency build glib-devel
Add_dependency build neon-devel
Add_dependency build apache-devel

do_build()
{
	./configure --prefix=/usr --with-apxs --disable-javahl \
		--without-kwallet --with-gnome-keyring --with-editor=vim \
		--disable-mod-activation

	(make ${makejobs} external-all && \
		make ${makejobs} LT_LDFLAGS="-L$Fdestdir/usr/lib" local-all)
}

do_install()
{
	export LD_LIBRARY_PATH=${DESTDIR}/usr/lib:$LD_LIBRARY_PATH

	make DESTDIR=${DESTDIR} install
	make DESTDIR=${DESTDIR} swig-py
	make DESTDIR=${DESTDIR} install-swig-py
	make DESTDIR=${DESTDIR} swig-pl
	make DESTDIR=${DESTDIR} INSTALLDIRS=vendor install-swig-pl
	make DESTDIR=${DESTDIR} swig-rb
	make DESTDIR=${DESTDIR} install-swig-rb

	rm -rf ${DESTDIR}/usr/lib/perl5/core_perl
	install -d ${DESTDIR}/usr/share/subversion
	install -d -m755 tools/hook-scripts ${DESTDIR}/usr/share/subversion/
	rm -f ${DESTDIR}/usr/share/subversion/hook-scripts/*.in

	install -D -m644 tools/client-side/bash_completion \
		${DESTDIR}/etc/bash_completion.d/subversion
}
