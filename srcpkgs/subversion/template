# Template file for 'subversion'
pkgname=subversion
version=1.7.5
revision=1
homepage="http://subversion.apache.org/"
subpackages="$pkgname-python $pkgname-perl $pkgname-gnome-keyring-auth $pkgname-devel libsvn"
# XXX enable kwallet when kdelibs is available.
makedepends="pkg-config perl>=5.16 python-devel swig apr-util-devel libldap-devel db-devel gdbm-devel expat-devel apr-devel libuuid-devel sqlite-devel libsasl-devel dbus-devel libgnome-keyring-devel glib-devel neon-devel apache-devel"
short_desc="Enterprise-class centralized version control for the masses"
maintainer="Juan RP <xtraeme@gmail.com>"
license="Apache-2.0, BSD"
distfiles="http://apache.mirror.rafal.ca/subversion/${pkgname}-${version}.tar.bz2"
checksum=cb23ccd08b0c1f0c66fdcda773265e404d95f378493ba64b49dbaaf54ae44aec
long_desc="
 Apache Subversion is a full-featured version control system originally
 designed to be a better CVS. Subversion has since expanded beyond its
 original goal of replacing CVS, but its basic model, design, and interface
 remain heavily influenced by that goal. Even today, Subversion should still
 feel very familiar to CVS users."

do_configure() {
	./configure --prefix=/usr --with-apxs --disable-javahl \
		--without-kwallet --with-gnome-keyring --with-editor=vim \
		--disable-mod-activation
}

do_build() {
	make ${makejobs} external-all
	make ${makejobs} LT_LDFLAGS="-L$Fdestdir/usr/lib" local-all
	make ${makejobs} \
		swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
		swig_pydir_extra=/usr/lib/python2.7/site-packages/svn \
		swig-py swig-pl
}

do_install() {
	export LD_LIBRARY_PATH=${DESTDIR}/usr/lib:$LD_LIBRARY_PATH

	make DESTDIR=${DESTDIR} INSTALLDIRS=vendor \
		swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
		swig_pydir_extra=/usr/lib/python2.7/site-packages/svn \
		install install-swig-py install-swig-pl

	rm -rf ${DESTDIR}/usr/lib/perl5/core_perl
	install -d ${DESTDIR}/usr/share/subversion
	install -d -m755 tools/hook-scripts ${DESTDIR}/usr/share/subversion/
	rm -f ${DESTDIR}/usr/share/subversion/hook-scripts/*.in

	install -D -m644 tools/client-side/bash_completion \
		${DESTDIR}/etc/bash_completion.d/subversion
}
