# Template file for 'subversion'
pkgname=subversion
version=1.7.5
homepage="http://subversion.apache.org/"
distfiles="http://apache.mirror.rafal.ca/subversion/${pkgname}-${version}.tar.bz2"
short_desc="Enterprise-class centralized version control for the masses"
maintainer="Juan RP <xtraeme@gmail.com>"
license="Apache-2.0, BSD"
checksum=cb23ccd08b0c1f0c66fdcda773265e404d95f378493ba64b49dbaaf54ae44aec
long_desc="
 Apache Subversion is a full-featured version control system originally
 designed to be a better CVS. Subversion has since expanded beyond its
 original goal of replacing CVS, but its basic model, design, and interface
 remain heavily influenced by that goal. Even today, Subversion should still
 feel very familiar to CVS users."

# XXX enable kwallet when kdelibs is available.
subpackages="$pkgname-python $pkgname-perl"
subpackages="${subpackages} $pkgname-gnome-keyring-auth $pkgname-devel"
subpackages="${subpackages} $pkgname-apache libsvn"

Add_dependency build pkg-config
Add_dependency build perl
#Add_dependency build ruby-devel
Add_dependency build python-devel
Add_dependency build swig
Add_dependency build apr-util-devel
Add_dependency build libldap-devel
Add_dependency build db-devel
Add_dependency build gdbm-devel
Add_dependency build expat-devel
Add_dependency build apr-devel
Add_dependency build libuuid-devel
Add_dependency build zlib-devel
Add_dependency build sqlite-devel
Add_dependency build libsasl-devel
Add_dependency build dbus-devel
Add_dependency build libgnome-keyring-devel
Add_dependency build glib-devel
Add_dependency build neon-devel
Add_dependency build apache-devel

do_configure() {
	./configure --prefix=/usr --with-apxs --disable-javahl \
		--without-kwallet --with-gnome-keyring --with-editor=vim \
		--disable-mod-activation
}

do_build() {
	make ${makejobs} external-all
	make ${makejobs} LT_LDFLAGS="-L$Fdestdir/usr/lib" local-all
	make ${makejobs} \
		swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
		swig_pydir_extra=/usr/lib/python2.7/site-packages/svn \
		swig-py swig-pl
}

do_install() {
	export LD_LIBRARY_PATH=${DESTDIR}/usr/lib:$LD_LIBRARY_PATH

	make DESTDIR=${DESTDIR} INSTALLDIRS=vendor \
		swig_pydir=/usr/lib/python2.7/site-packages/libsvn \
		swig_pydir_extra=/usr/lib/python2.7/site-packages/svn \
		install install-swig-py install-swig-pl

	rm -rf ${DESTDIR}/usr/lib/perl5/core_perl
	install -d ${DESTDIR}/usr/share/subversion
	install -d -m755 tools/hook-scripts ${DESTDIR}/usr/share/subversion/
	rm -f ${DESTDIR}/usr/share/subversion/hook-scripts/*.in

	install -D -m644 tools/client-side/bash_completion \
		${DESTDIR}/etc/bash_completion.d/subversion
}
