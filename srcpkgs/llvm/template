# Template file for 'llvm'
pkgname=llvm
version=3.1
wrksrc="${pkgname}-${version}.src"
distfiles="
http://www.llvm.org/releases/${version}/llvm-${version}.src.tar.gz
http://www.llvm.org/releases/${version}/clang-${version}.src.tar.gz"
subpackages="libclang clang-analyzer clang clang-devel libllvm llvm-devel llvm-docs"
build_style=gnu-configure
configure_args="--disable-expensive-checks --disable-debug-runtime
--enable-targets=all --enable-bindings=none --enable-optimize
--enable-shared --enable-libffi --enable-llvmc-dynamic"
# XXX: Investigate bindings support.
makedepends="groff perl python libffi-devel"
revision=1
short_desc="Low Level Virtual Machine"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.llvm.org"
license="BSD"
checksum="
1ea05135197b5400c1f88d00ff280d775ce778f8f9ea042e25a1e1e734a4b9ab
ff63e215dcd3e2838ffdea38502f8d35bab17e487f3c3799579961e452d5a786"
long_desc="
 Low Level Virtual Machine (LLVM) is:

 1. A compilation strategy designed to enable effective program optimization
    across the entire lifetime of a program. LLVM supports effective
    optimization at compile time, link-time (particularly interprocedural),
    run-time and offline (i.e., after software is installed), while remaining
    transparent to developers and maintaining compatibility with existing
    build scripts.

 2. A virtual instruction set - LLVM is a low-level object code
    representation that uses simple RISC-like instructions, but provides
    rich, language-independent, type information and dataflow (SSA)
    information about operands. This combination enables sophisticated
    transformations on object code, while remaining light-weight enough to
    be attached to the executable. This combination is key to allowing
    link-time, run-time, and offline transformations.

 3. A compiler infrastructure - LLVM is also a collection of source code that
    implements the language and compilation strategy. The primary components
    of the LLVM infrastructure are a GCC-based C &amp; C++ front-end, a
    link-time optimization framework with a growing set of global and
    interprocedural analyses and transformations, static back-ends for many
    popular (and some obscure) architectures, a back-end which emits portable
    C code, and a Just-In-Time compilers for several architectures.

 4. LLVM does not imply things that you would expect from a high-level
    virtual machine. It does not require garbage collection or run-time code
    generation (In fact, LLVM makes a great static compiler!). Note that
    optional LLVM components can be used to build high-level virtual machines
    and other systems that need these services."

post_extract() {
	# Move clang files into the llvm source.
	if [ -d ${XBPS_BUILDDIR}/clang-${version}.src ]; then
		mv ${XBPS_BUILDDIR}/clang-${version}.src ${wrksrc}/tools/clang
	fi
}
