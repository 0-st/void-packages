# Template file for 'vboot-utils'
pkgname=vboot-utils
version=45.7262
revision=1
build_style=gnu-makefile
hostmakedepends="pkg-config"
makedepends="libressl-devel libuuid-devel liblzma-devel libyaml-devel"
short_desc="Verified boot kernel utilities"
maintainer="Enno Boland <gottox@voidlinux.eu>"
license="BSD"
homepage="https://chromium.googlesource.com/chromiumos/platform/vboot_reference.git"
distfiles="$homepage/+archive/refs/heads/release-R${version//./-}.B.tar.gz"
checksum=a4192cc71686ee453e7d82ed1e3802d66a4257f0c8253922ab368fd910071e60
CFLAGS=-D_GNU_SOURCE
create_wrksrc=yes

do_build() {
	local _arch=
	case $XBPS_TARGET_MACHINE in
		x86_64*) _arch=x86_64 ;;
		i686*) _arch=x86 ;;
		arm*) _arch=arm ;;
	esac
	make CC="$CC" LD="$CC" AR="$AR" CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" \
		MINIMAL=1 ARCH=$_arch ${makejobs} \
		cgpt utils futil
}

do_install() {
	make STRIP=true DESTDIR=${DESTDIR}/usr install
	rm -r $DESTDIR/usr/lib/pkgconfig
	vmkdir etc
	vmkdir usr/share/vboot
	mv $DESTDIR/usr/default $DESTDIR/etc
	vcopy tests/devkeys usr/share/vboot/devkeys
}
