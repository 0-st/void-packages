# Template build file for "git".
pkgname=git
version=2.1.2
revision=2
build_style=gnu-configure
configure_args="--with-curl --with-expat --without-tcltk
 ac_cv_fread_reads_directories=no ac_cv_snprintf_returns_bogus=no"
make_install_args="NO_INSTALL_HARDLINKS=1"
hostmakedepends="xmlto>=0.0.25_2 asciidoc perl python"
makedepends="libressl-devel libcurl-devel expat-devel"
# Required by https://
depends="ca-certificates"
replaces="git-docs>=0"
short_desc="GIT Tree History Storage Tool"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://git-scm.com/"
license="GPL-2"
distfiles="https://www.kernel.org/pub/software/scm/git/git-${version}.tar.xz"
checksum=7b27c8978bccf436f3c2b8c6142f35b236edd34ef7c778b1333166c098c7a18b

subpackages="git-svn git-perl"

post_build() {
	make ${makejobs} -C Documentation man
}
post_install() {
	make NO_INSTALL_HARDLINKS=1 DESTDIR=${DESTDIR} install-doc
	vinstall contrib/completion/git-completion.bash 644 \
		usr/share/bash-completion/completions git
	vinstall contrib/completion/git-prompt.sh 644 usr/share/git
}

git-perl_package() {
	noarch=yes
	depends="git-${version}_${revision} perl-Authen-SASL perl-MIME-tools perl-Net-SMTP-SSL"
	short_desc+=" - perl utilities"
	pkg_install() {
		for f in add--interactive archimport cvsexportcommit cvsimport \
			cvsserver relink send-email; do
			vmove usr/libexec/git-core/git-${f}
		done
		vmove usr/share/perl5
		vmove usr/share/man/man3
	}
}
git-svn_package() {
	depends="git-perl-${version}_${revision} subversion-perl perl-Term-ReadKey"
	short_desc+=" - subversion support"
	pkg_install() {
		vmove "usr/share/perl5/site_perl/Git/SVN*"
		vmove usr/libexec/git-core/git-remote-testsvn
		vmove usr/libexec/git-core/git-svn
		vmove usr/share/man/man1/git-svn.1
		vmove "usr/share/man/man3/Git::SVN*"
	}
}
