# Template build file for "git".
pkgname=git
version=1.8.1.3
revision=1
build_style=gnu-configure
configure_args="--with-curl --with-expat --without-tcltk"
make_install_args="NO_INSTALL_HARDLINKS=1"
short_desc="GIT Tree History Storage Tool"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://git-scm.com/"
license="GPL-2"
distfiles="http://git-core.googlecode.com/files/git-$version.tar.gz"
checksum=3753247dbfd802aaf1cb2c917b8e873b6ed13c009ab0fa5f7d90b3c759195ff1

subpackages="git-docs git-perl git-python"
# Required by https://
depends="ca-certificates"
makedepends="xmlto>=0.0.25_2 asciidoc perl openssl-devel libcurl-devel
 expat-devel python-devel"

if [ -n "$XBPS_CROSS_TRIPLET" ]; then
	subpackages="git-perl"
	configure_args="${configure_args} --without-python
			ac_cv_fread_reads_directories=no
			ac_cv_snprintf_returns_bogus=no"
	makedepends="perl"
	crossmakedepends="openssl-devel libcurl-devel expat-devel"
fi

post_build() {
	if [ -z "$XBPS_CROSS_TRIPLET" ]; then
		make ${makejobs} -C Documentation man
	fi
}

post_install() {
	if [ -z "$XBPS_CROSS_TRIPLET" ]; then
		make NO_INSTALL_HARDLINKS=1 DESTDIR=${DESTDIR} install-doc
	fi
	vinstall contrib/completion/git-completion.bash 644 \
		usr/share/bash-completion/completions git
}
