From dd9cf9737b7d47ba3e3ab90a49dfca340f2a8cdf Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Wed, 13 Mar 2013 23:15:42 +0100
Subject: [PATCH] xbps-query: fix segfault when listing unexistent package
 files.

---
 NEWS                             | 2 ++
 bin/xbps-query/show-info-files.c | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/bin/xbps-query/show-info-files.c b/bin/xbps-query/show-info-files.c
index de5db5c..046eb37 100644
--- bin/xbps-query/show-info-files.c
+++ bin/xbps-query/show-info-files.c
@@ -223,6 +223,8 @@ show_pkg_files(prop_dictionary_t filesd)
 
 		for (x = 0; x < prop_array_count(array); x++) {
 			obj = prop_array_get(array, x);
+			if (prop_object_type(obj) != PROP_TYPE_DICTIONARY)
+				continue;
 			prop_dictionary_get_cstring_nocopy(obj, "file", &file);
 			printf("%s", file);
 			if (prop_dictionary_get_cstring_nocopy(obj,
-- 
1.8.1.3

