From bdcdb9f1a042c7e542d23ae5790ae5a1925904c8 Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Fri, 1 Feb 2013 13:40:27 +0100
Subject: [PATCH] xbps_fetch_file: don't check for file truncation if server
 answers with invalid info.

---
 NEWS           | 3 +++
 lib/download.c | 2 +-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/lib/download.c b/lib/download.c
index d73de87..090591d 100644
--- lib/download.c
+++ lib/download.c
@@ -249,7 +249,7 @@ xbps_fetch_file(struct xbps_handle *xhp, const char *uri, const char *flags)
 		errno = EIO;
 		rv = -1;
 		goto out;
-	} else if ((bytes_dload + url->offset) != url_st.size) {
+	} else if (url_st.size > 0 && ((bytes_dload + url->offset) != url_st.size)) {
 		xbps_dbg_printf(xhp, "file %s is truncated\n", filename);
 		errno = EIO;
 		rv = -1;
-- 
1.8.1.1

