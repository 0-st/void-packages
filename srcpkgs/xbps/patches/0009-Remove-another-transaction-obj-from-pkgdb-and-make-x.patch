From 178a6b58ae0a06e9d424f7879bafb4e8a26879e4 Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Thu, 7 Feb 2013 17:49:28 +0100
Subject: [PATCH 09/10] Remove another transaction obj from pkgdb and make
 xbps-pkgdb catch it.

---
 bin/xbps-pkgdb/check_pkg_unneeded.c | 5 ++++-
 include/xbps_api.h.in               | 2 +-
 lib/package_register.c              | 1 +
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/bin/xbps-pkgdb/check_pkg_unneeded.c b/bin/xbps-pkgdb/check_pkg_unneeded.c
index 8354b52..1379f4a 100644
--- bin/xbps-pkgdb/check_pkg_unneeded.c
+++ bin/xbps-pkgdb/check_pkg_unneeded.c
@@ -1,5 +1,5 @@
 /*-
- * Copyright (c) 2012 Juan Romero Pardines.
+ * Copyright (c) 2013 Juan Romero Pardines.
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -56,5 +56,8 @@ check_pkg_unneeded(struct xbps_handle *xhp, const char *pkgname, void *arg)
 	if (prop_dictionary_get(pkgd, "transaction"))
 		prop_dictionary_remove(pkgd, "transaction");
 
+	if (prop_dictionary_get(pkgd, "skip-obsoletes"))
+		prop_dictionary_remove(pkgd, "skip-obsoletes");
+
 	return 0;
 }
diff --git a/lib/package_register.c b/lib/package_register.c
index d78d0be..3ab6dd9 100644
--- lib/package_register.c
+++ lib/package_register.c
@@ -161,6 +161,7 @@ xbps_register_pkg(struct xbps_handle *xhp, prop_dictionary_t pkgrd, bool flush)
 	 */
 	prop_dictionary_remove(pkgd, "remove-and-update");
 	prop_dictionary_remove(pkgd, "transaction");
+	prop_dictionary_remove(pkgd, "skip-obsoletes");
 
 	if (!xbps_pkgdb_replace_pkg(xhp, pkgd, pkgname, flush)) {
 		xbps_dbg_printf(xhp,
-- 
1.8.1.1

