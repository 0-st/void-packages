From 0f22579a34741e2a33f9bdb06b0ad0f1681cdd3d Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Fri, 28 Dec 2012 10:42:13 +0100
Subject: [PATCH] libxbps: fixed regression executing "pre-remove" action in
 installed pkgs.

---
 NEWS                 | 3 +++
 lib/package_remove.c | 5 ++---
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/lib/package_remove.c b/lib/package_remove.c
index 0b6fc03..3118e19 100644
--- a/lib/package_remove.c
+++ b/lib/package_remove.c
@@ -233,8 +233,6 @@ xbps_remove_pkg(struct xbps_handle *xhp,
 	if (!update)
 		xbps_set_cb_state(xhp, XBPS_STATE_REMOVE, 0, pkgname, version, NULL);
 
-	pkgver = xbps_xasprintf("%s-%s", pkgname, version);
-
 	if (chdir(xhp->rootdir) == -1) {
 		rv = errno;
 		xbps_set_cb_state(xhp, XBPS_STATE_REMOVE_FAIL,
@@ -259,7 +257,8 @@ xbps_remove_pkg(struct xbps_handle *xhp,
 	 * Run the pre remove action.
 	 */
 	if (pkgd) {
-		rv = xbps_pkg_exec_script(xhp, pkgd, "remove", "pre", update);
+		rv = xbps_pkg_exec_script(xhp, pkgd, "remove-script",
+		    "pre", update);
 		if (rv != 0) {
 			xbps_set_cb_state(xhp, XBPS_STATE_REMOVE_FAIL,
 			    errno, pkgname, version,
-- 
1.8.0.3

