# Template file for 'anacron'
pkgname=anacron
version=2.3
revision=2
distfiles="${SOURCEFORGE_SITE}/$pkgname/$pkgname-$version.tar.gz"
build_style=gnu_makefile
make_install_args="PREFIX=$XBPS_DESTDIR/$pkgname-$version
 MANDIR=$XBPS_DESTDIR/$pkgname-$version/usr/share/man"
short_desc="cron-like program that doesn't go by time"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=5ceee6f22cd089bdaf1c0841200dbe5726babaf9e2c432bb17c1fc95da5ca99f
long_desc="
 Anacron is a periodic command scheduler. It executes commands at intervals
 specified in days. Unlike cron, it does not assume that the system is
 running continuously. It can therefore be used to control the execution
 of daily, weekly and monthly jobs (or anything with a period of n days),
 on systems that don't run 24 hours a day. When installed and configured
 properly, Anacron will make sure that the commands are run at the specified
 intervals as closely as machine-uptime permits."

keep_empty_dirs=yes
conf_files="/etc/anacrontab"
openrc_services="anacrond default true"

Add_dependency run glibc
Add_dependency full bash
Add_dependency full run-parts

pre_build()
{
	sed -i 's/const int isleap;/int isleap;/' $wrksrc/gregor.c
}

post_install()
{
	install -d ${DESTDIR}/etc/cron.daily ${DESTDIR}/etc/cron.weekly \
		${DESTDIR}/etc/cron.monthly ${DESTDIR}/etc/init.d
	install -m755 ${FILESDIR}/00anacron.daily \
		${DESTDIR}/etc/cron.daily/00anacron
	install -m755 ${FILESDIR}/00anacron.weekly \
		${DESTDIR}/etc/cron.weekly/00anacron
	install -m755 ${FILESDIR}/00anacron.monthly \
		${DESTDIR}/etc/cron.monthly/00anacron
	install -m644 ${FILESDIR}/anacrontab ${DESTDIR}/etc
	install -m755 ${FILESDIR}/anacrond.rc ${DESTDIR}/etc/init.d/anacrond
}
