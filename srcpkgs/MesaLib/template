# Template build file for 'MesaLib'.
pkgname=MesaLib
version=7.10.3
revision=2
wrksrc="Mesa-${version}"
patch_args="-Np1"
distfiles="ftp://ftp.freedesktop.org/pub/mesa/$version/$pkgname-$version.tar.bz2"
build_style=gnu_configure
configure_args="--enable-glx-tls --enable-xcb
--with-dri-drivers=i915,i965,mach64,mga,r128,savage,tdfx,unichrome
--enable-gallium-radeon --enable-gallium-r600 --enable-gallium-swrast
--enable-gallium-nouveau --disable-glut --enable-gles1 --enable-gles2
--enable-egl --disable-gallium-egl
--with-dri-driverdir=/usr/lib/xorg/modules/dri"
short_desc="Graphics library similar to SGI's OpenGL"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.mesa3d.org/"
license="MIT, LGPL-2.1"
checksum=1e701fc839b872677ddca9ed8784d754c9da1fbeda98173980e06aa7df0e85c0
long_desc="
 MesaLib is a 3-D graphics library with an API which is very similar to
 that of OpenGL*. To the extent that Mesa utilizes the OpenGL command syntax
 or state machine, it is being used with authorization from Silicon Graphics,
 Inc. However, the author makes no claim that Mesa is in any way a
 compatible replacement for OpenGL or associated with Silicon Graphics, Inc."

subpackages="$pkgname-devel"
Add_dependency run libgcc
Add_dependency run glibc
Add_dependency run libstdc++
Add_dependency run libXext
Add_dependency run libXxf86vm
Add_dependency run libXdamage
Add_dependency run libXfixes
Add_dependency run libX11
Add_dependency run libxcb
Add_dependency run libudev
Add_dependency run libdrm		">=2.4.23"
Add_dependency run expat
Add_dependency run libXt
Add_dependency run talloc

Add_dependency build flex
Add_dependency build pkg-config
Add_dependency build glproto
Add_dependency build dri2proto		">=2.1"
Add_dependency build makedepend
Add_dependency build libXext-devel
Add_dependency build libXxf86vm-devel
Add_dependency build libXdamage-devel
Add_dependency build libXfixes-devel
Add_dependency build libX11-devel
Add_dependency build libxcb-devel
Add_dependency build libudev-devel
Add_dependency build libdrm-devel
Add_dependency build expat-devel
Add_dependency build libXt-devel
Add_dependency build talloc-devel
Add_dependency build libxml2-python

post_install()
{
	# Remove radeon Gallium state tracker, conflicts with
	# xf86-video-ati!
	rm -f ${DESTDIR}/usr/lib/xorg/modules/drivers/radeon_drv.so

	# Make a symlink from gallium software rasterizer to emulate
	# the classic one.
	ln -s /usr/lib/xorg/modules/dri/swrastg_dri.so \
		${DESTDIR}/usr/lib/xorg/modules/dri/swrast_dri.so
}
