# Template file for 'lvm2'
pkgname=lvm2
version=2.02.66
wrksrc=LVM2.${version}
distfiles="ftp://sources.redhat.com/pub/lvm2/LVM2.${version}.tgz"
build_style=gnu_configure
configure_args="--disable-selinux --enable-readline --enable-pkgconfig
 --enable-fsadm --enable-applib"
make_install_target="DESTDIR=$XBPS_DESTDIR/$pkgname-$version
 sbindir=$XBPS_DESTDIR/$pkgname-$version/sbin
 libdir=$XBPS_DESTDIR/$pkgname-$version/lib install"
short_desc="Logical Volume Manager 2 utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=a52f8e9abbc4c8ec1dbced8eca480b5edebc8504767b8fa4ff3ffafd2f48d842
long_desc="
 LVM2 includes all of the support for handling read/write operations on
 physical volumes (hard disks, RAID-Systems, magneto optical, etc.,
 multiple devices (MD), see mdadd(8) or even loop devices, see
 losetup(8)), creating volume groups (kind of virtual disks) from one
 or more physical volumes and creating one or more logical volumes
 (kind of logical partitions) in volume groups."

keep_empty_dirs=yes
subpackages="liblvm2app liblvm2app-devel device-mapper device-mapper-devel"
conf_files="/etc/lvm/lvm.conf"
triggers="initramfs-tools"
openrc_services="lvm2 shutdown true"

Add_dependency run glibc
Add_dependency run bash
Add_dependency run readline
Add_dependency run ncurses-libs
Add_dependency run device-mapper
Add_dependency build readline-devel
Add_dependency build ncurses-devel

post_install()
{
	local initramfsdir=${DESTDIR}/usr/share/initramfs-tools

	install -d ${DESTDIR}/etc/lvm/archive ${DESTDIR}/etc/lvm/backup \
		${DESTDIR}/etc/init.d ${initramfsdir}/scripts/local-top \
		${initramfsdir}/hooks
	install -m755 ${FILESDIR}/lvm2.initramfs-hook ${initramfsdir}/hooks/lvm2
	install -m755 ${FILESDIR}/lvm2.initramfs-local-top \
		${initramfsdir}/scripts/local-top/lvm2
	install -m755 ${FILESDIR}/lvm2.rc ${DESTDIR}/etc/init.d/lvm2
	rm -f ${DESTDIR}/lib/*.so ${DESTDIR}/usr/lib/*.so
	cd ${DESTDIR}/usr/lib && \
		ln -sf $(echo ../../lib/libdevmapper.so.*) libdevmapper.so
	cd ${DESTDIR}/usr/lib && \
		ln -sf $(echo ../../lib/liblvm2app.so.*) liblvm2app.so
	chmod 755 ${DESTDIR}/lib/*.so* ${DESTDIR}/sbin/*
}
