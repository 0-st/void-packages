# Template file for 'lvm2'
pkgname=lvm2
version=2.02.85
revision=3
wrksrc=LVM2.${version}
distfiles="ftp://sources.redhat.com/pub/lvm2/LVM2.${version}.tgz"
build_style=gnu-configure
configure_args="--disable-selinux --enable-readline --enable-pkgconfig
 --enable-fsadm --enable-applib"
make_install_target="DESTDIR=$XBPS_DESTDIR/$pkgname-$version
 sbindir=$XBPS_DESTDIR/$pkgname-$version/sbin
 libdir=$XBPS_DESTDIR/$pkgname-$version/lib install"
short_desc="Logical Volume Manager 2 utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://sourceware.org/lvm2/"
license="GPL-2, LGPL-2.1"
checksum=e5c2b0d76e7b1df7630e211734eb09697d66ab879b17eb19545cb77272813eb7
long_desc="
 LVM2 includes all of the support for handling read/write operations on
 physical volumes (hard disks, RAID-Systems, magneto optical, etc.,
 multiple devices (MD), see mdadd(8) or even loop devices, see
 losetup(8)), creating volume groups (kind of virtual disks) from one
 or more physical volumes and creating one or more logical volumes
 (kind of logical partitions) in volume groups."

subpackages="liblvm2app liblvm2app-devel device-mapper device-mapper-devel"
conf_files="/etc/lvm/lvm.conf"
triggers="initramfs-tools"

Add_dependency run bash
Add_dependency build readline-devel

post_install()
{
	local initramfsdir=usr/share/initramfs-tools

	vmkdir etc/lvm/archive
	touch ${DESTDIR}/etc/lvm/archive/.owned
	vmkdir etc/lvm/backup
	touch ${DESTDIR}/etc/lvm/backup/.owned

	vinstall ${FILESDIR}/lvm2.initramfs-hook 755 \
		${initramfsdir}/hooks lvm2
	vinstall ${FILESDIR}/lvm2.initramfs-local-top 755 \
		${initramfsdir}/scripts/local-top lvm2
	rm -f ${DESTDIR}/lib/*.so ${DESTDIR}/usr/lib/*.so
	cd ${DESTDIR}/usr/lib && \
		ln -sf $(echo ../../lib/libdevmapper.so.*) libdevmapper.so
	cd ${DESTDIR}/usr/lib && \
		ln -sf $(echo ../../lib/liblvm2app.so.*) liblvm2app.so
	chmod 755 ${DESTDIR}/lib/*.so* ${DESTDIR}/sbin/*
}
