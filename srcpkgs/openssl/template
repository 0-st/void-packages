# Template file for 'openssl'
pkgname=openssl
_openssl_version=1.0.0
version=${_openssl_version}i
homepage="http://www.openssl.org/"
distfiles="${homepage}/source/$pkgname-$version.tar.gz"
short_desc="Secure Socket Layer and cryptographic library - runtime utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
license="BSD"
checksum=548262d15777c504be1ab9bb8fabef1e14a3de54837a6593c8f403dd843d5e57
long_desc="
 The OpenSSL Project is a collaborative effort to develop a robust,
 commercial-grade, full-featured, and Open Source toolkit implementing the
 Secure Sockets Layer (SSL v2/v3) and Transport Layer Security (TLS v1)
 protocols as well as a full-strength general purpose cryptography library."

disable_parallel_build=yes

conf_files="/etc/ssl/openssl.cnf"
subpackages="libssl openssl-devel"
make_dirs="
/etc/ssl/certs 0755 root root
/etc/ssl/private 0750 root root"

Add_dependency full perl	">=0"
Add_dependency build zlib-devel

do_configure() {
	./config --prefix=/usr --openssldir=/etc/ssl --libdir=lib \
		zlib shared threads -Wa,--noexecstack
}

do_build() {
	make ${makejobs}
}

do_install() {
	make INSTALL_PREFIX=${DESTDIR} MANDIR=/usr/share/man install

	chmod 755 ${DESTDIR}/usr/lib/engines/*.so
	for _solib_ in libssl.so libcrypto.so; do
		chmod 755 ${DESTDIR}/usr/lib/${_solib_}.${_openssl_version}
		cd ${DESTDIR}/usr/lib && \
			ln -sf ${_solib_}.${_openssl_version} ${_solib_}.1 && \
			ln -sf ${_solib_}.${_openssl_version} ${_solib_}
	done
}
