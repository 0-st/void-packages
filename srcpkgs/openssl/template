# Template file for 'openssl'
pkgname=openssl
openssl_version=0.9.8
version=${openssl_version}n
distfiles="http://www.openssl.org/source/$pkgname-$version.tar.gz"
build_style=configure
configure_script="./config"
configure_args="--prefix=/usr
 --install_prefix=$XBPS_DESTDIR/$pkgname-$version --openssldir=/etc/ssl
 zlib-dynamic shared threads"
make_build_target="all"
short_desc="Secure Socket Layer and cryptographic library"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=b01abc28376b866515df58f1b004da8453166291783d4e7477cda89b000c1f01
long_desc="
 The OpenSSL Project is a collaborative effort to develop a robust,
 commercial-grade, full-featured, and Open Source toolkit implementing the
 Secure Sockets Layer (SSL v2/v3) and Transport Layer Security (TLS v1)
 protocols as well as a full-strength general purpose cryptography library."

# Does not build with -j.
disable_parallel_build=yes
conf_files="/etc/ssl/openssl.cnf"
subpackages="openssl-devel"

Add_dependency run glibc
Add_dependency run zlib
Add_dependency build perl
Add_dependency build zlib-devel

post_install()
{
	# Grr. Stupid Makefile, remove stuff installed in wrong dir.
	rm -rf $DESTDIR/usr/usr

	# Fix for correct SONAME in shared libs.
	cd $DESTDIR/usr/lib || exit 1
	for f in libssl libcrypto; do
		ln -sf $f.so.${openssl_version} $f.so.7
	done
	# Remove passwd.1 manpage, it's supplied by the shadow pkg.
	rm -f ${DESTDIR}/usr/share/man/man1/passwd.1
}
