# Template file for 'dbus'
pkgname=dbus
version=1.4.14
revision=1
homepage="http://dbus.freedesktop.org/"
distfiles="${homepage}/releases/dbus/$pkgname-$version.tar.gz"
build_style=gnu_configure
configure_args="--disable-selinux --enable-userdb-cache --with-xml=expat
--localstatedir=/var --disable-dnotify --enable-inotify --with-dbus-user=dbus
--disable-doxygen-docs --disable-xml-docs --disable-tests
--with-systemdsystemunitdir=/lib/systemd/system"
short_desc="Message bus system"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
checksum=47f27efc29aa9d1cc64b74e374204084d6fd53191e70dd584b604181059e5877
long_desc="
 D-BUS is a message bus, used for sending messages between applications.
 Conceptually, it fits somewhere in between raw sockets and CORBA in terms
 of complexity.

 D-BUS supports broadcast messages, asynchronous messages (thus decreasing
 latency), authentication, and more.  It is designed to be low-overhead;
 messages are sent using a binary protocol, not using XML.  D-BUS also
 supports a method call mapping for its messages, but it is not required;
 this makes using the system quite simple."

conf_files="/etc/dbus-1/session.conf /etc/dbus-1/system.conf"
subpackages="$pkgname-devel $pkgname-libs"
openrc_services="dbus default true"
system_accounts="dbus"

Add_dependency run glibc
Add_dependency run expat
Add_dependency run dbus-libs
Add_dependency run libX11

Add_dependency build coreutils
Add_dependency build pkg-config
Add_dependency build expat-devel
Add_dependency build libX11-devel

post_install()
{
	# install dbus-launch.
	install -m755 tools/dbus-launch ${DESTDIR}/usr/bin
	install -m644 doc/dbus-launch.1 ${DESTDIR}/usr/share/man/man1
	install -Dm755 ${FILESDIR}/30-dbus-xinit \
		${DESTDIR}/etc/X11/xinit/xinitrc.d/30-dbus
	# Install the OpenRC service
	install -D -m755 ${FILESDIR}/dbus.rc ${DESTDIR}/etc/init.d/dbus
}
