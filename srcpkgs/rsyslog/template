# Template file for 'rsyslog'
pkgname=rsyslog
version=5.8.4
homepage="http://www.rsyslog.com"
distfiles="${homepage}/files/download/rsyslog/$pkgname-$version.tar.gz"
build_style=gnu_configure
configure_args="--enable-gnutls --enable-mysql --enable-pgsql
--enable-imdiag --enable-imfile --enable-mail --enable-gssapi-krb5"
short_desc="An Enhanced multi-threaded syslog daemon"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3"
checksum=fdae6a027942f46eef8abcf2b6b28399986b5e983452e046e729eae70f13febe
long_desc="
 Rsyslog is an enhanced multi-threaded syslogd supporting, among
 others, MySQL, PgSQL, syslog/tcp, RFC 3195, permitted sender lists,
 filtering on any message part, and fine grain output format control."

subpackages="$pkgname-docs $pkgname-gssapi $pkgname-gnutls"
subpackages="${subpackages} $pkgname-mysql $pkgname-postgresql"
conf_files="/etc/rsyslog.conf /etc/conf.d/rsyslogd"
openrc_services="rsyslogd default true"
provides="syslog-daemon-0"
replaces="syslog-daemon>=0"

Add_dependency run glibc
Add_dependency run zlib
Add_dependency build pkg-config
Add_dependency build zlib-devel
Add_dependency build gnutls-devel
Add_dependency build postgresql-libs-devel
Add_dependency build libmysqlclient-devel
Add_dependency build mit-krb5-devel

post_install()
{
	vinstall ${FILESDIR}/rsyslogd.rc 755 etc/init.d rsyslogd
	vinstall ${FILESDIR}/rsyslogd.confd 644 etc/conf.d rsyslogd
	vinstall ${FILESDIR}/rsyslog.conf 644 etc
	vinstall ${FILESDIR}/rsyslog.logrotate 644 etc/logrotate.d rsyslog
	# Install HTML documentation.
	install -d ${DESTDIR}/usr/share/doc/rsyslog/html
	install -m644 ${wrksrc}/doc/*.{html,png} \
		${DESTDIR}/usr/share/doc/rsyslog/html
}
