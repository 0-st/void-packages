# Template file for 'rsyslog'
pkgname=rsyslog
version=6.2.0
revision=2
build_style=gnu-configure
configure_args="--enable-gnutls --enable-mysql --enable-pgsql
--enable-imdiag --enable-imfile --enable-mail --enable-gssapi-krb5
--with-systemdsystemunitdir=/lib/systemd/system --enable-zlib
--enable-imptcp --enable-imttcp --enable-mmsnmptrapd
--enable-impstats --enable-omprog --enable-omstdout
--enable-pmlastmsg --enable-pmcisconames --enable-pmaixforwardedfrom
--enable-pmsnare --enable-pmrfc3164sd --enable-omuxsock
--enable-smcustbindcdr --enable-imtemplate --enable-omtemplate
LDFLAGS=-Wl,--allow-shlib-undefined"
makedepends="automake pkg-config zlib-devel gnutls-devel postgresql-libs-devel libmysqlclient-devel mit-krb5-devel libee-devel"
short_desc="An Enhanced multi-threaded syslog daemon"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3"
homepage="http://www.rsyslog.com"
distfiles="${homepage}/files/download/rsyslog/$pkgname-$version.tar.gz"
checksum=f8869a1c25d0dd9ff04468743969ffc9ff89c6f7afa3046f77f91c3982543cc1
long_desc="
 Rsyslog is an enhanced multi-threaded syslogd supporting, among
 others, MySQL, PgSQL, syslog/tcp, RFC 3195, permitted sender lists,
 filtering on any message part, and fine grain output format control."

subpackages="rsyslog-docs rsyslog-gssapi rsyslog-gnutls rsyslog-mysql rsyslog-postgresql"
conf_files="/etc/rsyslog.conf"
systemd_services="rsyslog.service on"
provides="syslog-daemon-0"
replaces="syslog-daemon>=0"
make_dirs="/etc/rsyslog.d 0755 root root"
disable_parallel_build=yes

pre_configure() {
	autoreconf -fi
}

post_install() {
	vinstall ${FILESDIR}/rsyslog.conf 644 etc
	vinstall ${FILESDIR}/rsyslog.logrotate 644 etc/logrotate.d rsyslog
	# Install HTML documentation.
	install -d ${DESTDIR}/usr/share/doc/rsyslog/html
	install -m644 ${wrksrc}/doc/*.{html,png} \
		${DESTDIR}/usr/share/doc/rsyslog/html
}
