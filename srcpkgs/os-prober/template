# Template file for 'os-prober'
pkgname=os-prober
version=1.39
wrksrc=${pkgname}
distfiles="${DEBIAN_SITE}/main/o/$pkgname/${pkgname}_$version.tar.gz"
build_style=custom-install
short_desc="Utility to detect other OSes on a set of drives"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=d5b440d5d8872a864c063d17981adedfacb74d9fb478a3a6fa572da6f34e4ccc
long_desc="
 This package detects other OSes available on a system and outputs the
 results in a generic machine-readable format."

keep_empty_dirs=yes

Add_dependency run glibc
Add_dependency full gettext

do_build()
{
	cd ${wrksrc} && make || return 1
}

do_install()
{
	local ARCH

	case "${xbps_machine}" in
		i[56]86|x86_64) ARCH=x86;;
	esac

	install -d ${DESTDIR}/usr/bin ${DESTDIR}/usr/lib/os-prober
	install -d ${DESTDIR}/usr/share/os-prober
	install -d ${DESTDIR}/var/lib/os-prober
	install -d ${DESTDIR}/usr/lib/os-probes/init
	install -d ${DESTDIR}/usr/lib/os-probes/mounted
	install -d ${DESTDIR}/usr/lib/linux-boot-probes/mounted

	cd ${wrksrc} || return 1
	install -m755 os-prober ${DESTDIR}/usr/bin || return 1
	install -m755 linux-boot-prober ${DESTDIR}/usr/bin || return 1
	install -m755 newns ${DESTDIR}/usr/lib/os-prober || return 1
	install -m644 common.sh ${DESTDIR}/usr/share/os-prober || return 1

	cp -a linux-boot-probes/common/* \
		${DESTDIR}/usr/lib/linux-boot-probes || return 1
	cp -a linux-boot-probes/mounted/common/* \
		${DESTDIR}/usr/lib/linux-boot-probes/mounted || return 1
	cp -a linux-boot-probes/mounted/${ARCH}/* \
		${DESTDIR}/usr/lib/linux-boot-probes/mounted || return 1

	cp -a os-probes/common/* ${DESTDIR}/usr/lib/os-probes || return 1
	cp -a os-probes/init/common/* \
		${DESTDIR}/usr/lib/os-probes/init || return 1
	cp -a os-probes/mounted/common/* \
		${DESTDIR}/usr/lib/os-probes/mounted || return 1	
	cp -a os-probes/mounted/${ARCH}/* \
		${DESTDIR}/usr/lib/os-probes/mounted || return 1
}
