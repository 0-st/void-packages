# Template file for 'os-prober'
pkgname=os-prober
version=1.47
wrksrc=${pkgname}
distfiles="${DEBIAN_SITE}/main/o/$pkgname/${pkgname}_$version.tar.gz"
build_style=custom-install
short_desc="Utility to detect other OSes on a set of drives"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://packages.debian.org/sid/os-prober"
license="GPL-2"
checksum=702c8e0bc148c13708d9e52cf8255b5d7bcd6fbabac3d823f506f2fe2376654f
long_desc="
 This package detects other OSes available on a system and outputs the
 results in a generic machine-readable format."

keep_empty_dirs=yes

Add_dependency run glibc
Add_dependency full gettext

do_build()
{
	make ${makejobs}
}

do_install()
{
	local ARCH

	case "${xbps_machine}" in
		i[56]86|x86_64) ARCH=x86;;
	esac

	vmkdir usr/lib/os-probes/init
	vmkdir usr/lib/os-probes/mounted
	vmkdir usr/share/os-prober
	vmkdir var/lib/os-prober
	vmkdir usr/lib/linux-boot-probes/mounted

	vinstall os-prober 755 usr/bin
	vinstall linux-boot-prober 755 usr/bin
	vinstall newns 755 usr/lib/os-prober
	vinstall common.sh 644 usr/share/os-prober

	vcopy "linux-boot-probes/common/*" usr/lib/linux-boot-probes
	vcopy "linux-boot-probes/mounted/common/*" \
		usr/lib/linux-boot-probes/mounted
	vcopy "linux-boot-probes/mounted/${ARCH}/*" \
		usr/lib/linux-boot-probes/mounted
	vcopy "os-probes/common/*" usr/lib/os-probes
	vcopy "os-probes/init/common/*" usr/lib/os-probes/init
	vcopy "os-probes/mounted/common/*" usr/lib/os-probes/mounted
	vcopy "os-probes/mounted/${ARCH}/*" usr/lib/os-probes/mounted
}
