# Build template file for 'gvim'.
#
# Source vim template and overwrite some vars, it's stupid
# to duplicate all this stuff again!
#
. ${XBPS_SRCPKGDIR}/vim/template
unset subpackages

pkgname=gvim
configure_args="${configure_args} --enable-gui=gtk2 --with-x
--with-vim-name=gvim"
make_install_target="-C src
DESTDIR=${XBPS_DESTDIR}/${pkgname}-${version} installvimbin install-icons"
short_desc="${short_desc} (GTK+ GUI)"
long_desc="${long_desc}

 This packages contains gvim, the GTK+ GUI version of vim."

gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run atk
Add_dependency run glib
Add_dependency run pango
Add_dependency run cairo
Add_dependency run freetype
Add_dependency run fontconfig
Add_dependency run gdk-pixbuf
Add_dependency run gtk+
Add_dependency run libXt
Add_dependency run libX11
Add_dependency run libSM
Add_dependency run libICE

Add_dependency build pkg-config
Add_dependency build atk-devel
Add_dependency build glib-devel
Add_dependency build pango-devel
Add_dependency build cairo-devel
Add_dependency build freetype-devel
Add_dependency build fontconfig-devel
Add_dependency build gtk+-devel
Add_dependency build libXt-devel
Add_dependency build libX11-devel
Add_dependency build libSM-devel
Add_dependency build libICE-devel

Add_dependency full desktop-file-utils
Add_dependency full hicolor-icon-theme

pre_install()
{
	sed -i "s|/locolor|/hicolor|g" ${wrksrc}/src/Makefile || return 1
	for d in 16 32 48; do
		install -d ${DESTDIR}/usr/share/icons/hicolor/${d}x${d}/apps
	done
}

post_install()
{
	install -D -m644 ${FILESDIR}/gvim.desktop \
		${DESTDIR}/usr/share/applications/gvim.desktop
}
