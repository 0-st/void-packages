# Template file for 'shorewall'
pkgname=shorewall
version=4.5.21.3
revision=1
_disturl="http://www.shorewall.net/pub/${pkgname}/4.5/${pkgname}-4.5.21"
distfiles="
 ${_disturl}/${pkgname}-${version}.tar.bz2
 ${_disturl}/shorewall6-${version}.tar.bz2
 ${_disturl}/shorewall-core-${version}.tar.bz2"
checksum="
 dd1160c077112264094478ee81d83c2757d6d72d0d8e7fe6bf000427282a8356
 2eccf072ffb83733e73697f425cfd832de91ec70cb19231bb9f88a461790c0da
 220725caf825ff0df7c7cf8e78866ec80c847e8b9160cdb8fbc19613248bdc2a"
maintainer="Steven R <strob AT styez DOT com>"
homepage="http://www.shorewall.net/"
license="GPL"
short_desc="An iptables-based firewall for Linux systems"

do_build(){
for product in shorewall{-core,6,}; do
	cd ${XBPS_BUILDDIR}/${product}-${version}
	./configure HOST=archlinux SBINDIR=/usr/bin
done
}

do_install() {
	:
}

shorewall_package() {
	noarch="yes"
	depends="shorewall-core perl"
	systemd_services="shorewall.service off"
	make_dirs="/var/lib/shorewall 0755 0 0"
	conf_files="/etc/shorewall/{accounting,actions,blrules,clear,conntrack,ecn,findgw,hosts,init,initdone,interfaces,lib.private,maclist,masq,nat,netmap,params,policy,providers,proxyarp,refresh,refreshed,restored,routes,stoppedrules,rtrules,rules,scfilter,secmarks,shorewall.conf,start,started,stop,stopped,tcclasses,tcclear,tcdevices,tcfilters,tcinterfaces,tcpri,tcrules,tos,tunnels,zones}"
	pkg_install() {
		cd ${XBPS_BUILDDIR}/shorewall-${version}
		DESTDIR="${DESTDIR}" ./install.sh
		install -d "${DESTDIR}/usr/share/doc/shorewall/"
		cp -r Samples "${DESTDIR}/usr/share/doc/shorewall/"
		vmove all
	}
}

shorewall-core_package() {
	short_desc+=" - Core Shorewall libraries"
	noarch="yes"
	depends="iptables iproute2"
	pkg_install() {
		cd ${XBPS_BUILDDIR}/shorewall-core-${version}
		DESTDIR="${DESTDIR}" ./install.sh
		vmove all
	}
}

shorewall6_package() {
	short_desc+=" - IPv6 support"
	noarch="yes"
	depends="shorewall"
	pkg_install() {
		cd ${XBPS_BUILDDIR}/shorewall6-${version}
		DESTDIR="${DESTDIR}" ./install.sh
		vmove all
	}
}
