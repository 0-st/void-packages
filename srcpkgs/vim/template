# Template file for 'vim'
pkgname=vim
_distver=7.3
_patchver=050
version=${_distver}.${_patchver}
wrksrc=vim73
distfiles="ftp://ftp.vim.org/pub/vim/unix/$pkgname-${_distver}.tar.bz2"
build_style=gnu_configure
configure_args="--disable-perlinterp --disable-pythoninterp --disable-rubyinterp
 --disable-cscope --disable-workshop --disable-netbeans --disable-sniff
 --disable-gpm --disable-hangulinput --disable-xim --enable-gui=no
 --without-x --enable-multibyte --with-tlib=ncursesw"
short_desc="Vim editor (vi clone)"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=5c5d5d6e07f1bbc49b6fe3906ff8a7e39b049928b68195b38e3e3d347100221d
long_desc="
 Vim is an almost compatible version of the UNIX editor Vi. Many new features
 have been added: multi level undo, syntax highlighting, command line history,
 on-line help, filename completion, block operations, etc."

subpackages="vim-common"
Add_dependency run glibc
Add_dependency run ncursesw
Add_dependency run acl
Add_dependency run vim-common		">=${version}"
Add_dependency build glibc-devel
Add_dependency build ncursesw-devel
Add_dependency build acl-devel

pre_configure()
{
	local url="ftp://ftp.vim.org/pub/vim/patches/${_distver}"

        if [ "${_patchver}" -gt 000 ]; then
                cd ${XBPS_SRCDISTDIR} || return 1
                for p in $(seq -w 001 ${_patchver}); do
                        [ -f ${XBPS_SRCDISTDIR}/${_distver}.${p} ] && continue
                        msg_normal " Fetching ${url}/${_distver}-$p patch..."
                        $XBPS_FETCH_CMD ${url}/${_distver}.$p 2>&1
                done
        fi
        cd ${wrksrc}
        for p in $(seq -w 001 ${_patchver}); do
                patch -s -Np0 -i ${XBPS_SRCDISTDIR}/${_distver}.${p} && \
                        msg_normal "Applied patch ${_distver}.$p."
        done
}
