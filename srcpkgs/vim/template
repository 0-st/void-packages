# Template file for 'vim'
pkgname=vim
_distver=7.3
_patchver=754
version=${_distver}.${_patchver}
revision=1
subpackages="vim-common vim-x11 gvim"
depends="vim-common>=$version"
makedepends="mercurial ncurses-devel acl-devel pkg-config libXt-devel
 gtk+-devel"
short_desc="Vim editor (vi clone)"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.vim.org"
license=""
long_desc="
 Vim is an almost compatible version of the UNIX editor Vi. Many new features
 have been added: multi level undo, syntax highlighting, command line history,
 on-line help, filename completion, block operations, etc."

nofetch=yes
noextract=yes

do_fetch() {
	local url="http://code.google.com/p/vim/"
	hg clone -u v7-3-${_patchver} ${url} ${pkgname}-${version}
}

pre_configure() {
	mkdir -p /tmp/vim-x11
	cp -a $wrksrc/* /tmp/vim-x11
	mv /tmp/vim-x11 $wrksrc/
	mkdir -p /tmp/gvim
	cp -a $wrksrc/* /tmp/gvim
	mv /tmp/gvim $wrksrc/gvim
}

do_configure() {
	local sharedargs="--disable-perlinterp --disable-pythoninterp \
		--disable-rubyinterp --disable-cscope --disable-workshop \
		--disable-netbeans --disable-sniff --disable-gpm \
		--disable-hangulinput --disable-xim --enable-multibyte \
		--with-tlib=ncursesw --with-ex-name=vim-ex \
		--with-view-name=vim-view"

	# Normal version.
	cd $wrksrc
	./configure ${CONFIGURE_SHARED_ARGS} ${sharedargs} \
		--enable-gui=no --with-x=no

	# X11 version.
	cd $wrksrc/vim-x11
	./configure ${CONFIGURE_SHARED_ARGS} ${sharedargs} \
		--enable-gui=no --with-x

	# GTK+ version.
	cd $wrksrc/gvim
	./configure ${CONFIGURE_SHARED_ARGS} ${sharedargs} \
		--enable-gui=gtk2 --with-x --with-vim-name=gvim
}

do_build() {
	for f in "" vim-x11 gvim; do
		cd $wrksrc/$f && make ${makejobs}
	done
}

do_install() {
	make DESTDIR=$DESTDIR install
	# Create vim-ex symlink.
	cd ${DESTDIR}/usr/bin && ln -sf vim vim-ex
	rm -f ${DESTDIR}/usr/bin/{ex,view}

	find ${DESTDIR}/usr/share/man -type f -name evim.1 -delete
}
