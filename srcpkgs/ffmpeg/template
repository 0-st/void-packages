# Template file for 'ffmpeg'
pkgname=ffmpeg
version=0.7.3
homepage="http://www.ffmpeg.org"
distfiles="${homepage}/releases/ffmpeg-${version}.tar.bz2"
build_style=custom-install
short_desc="Decoding, encoding and streaming software"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3"
checksum=58ee859d9c4f5c477ea5bd0dd8e6848ce3af8b6c0ffe3b556612d437e85abb17
long_desc="
 FFmpeg is the first complete and free Internet Live Audio and Video
 Broadcasting solution. FFMpeg aims at being the command line tool to
 handle audio and video. It is a three-in-one solution.

 FFmpeg includes a soft VCR capable of encoding in many different
 formats simultaneously, a streaming server for Netcasting multimedia
 and is available under the GNU General Public License.

 FFmpeg generates streaming files, in many popular formats
 simultaneously, faster than any other solution."

subpackages="libavcodec libavdevice libavformat libavutil libavfilter"
subpackages="${subpackages} libpostproc libswscale $pkgname-devel"

Add_dependency run glibc
Add_dependency run libavformat
Add_dependency run libavcodec
Add_dependency run libavutil
Add_dependency run alsa-lib
Add_dependency run libX11
Add_dependency run libXext
Add_dependency run libXfixes
Add_dependency run zlib
Add_dependency run bzip2
Add_dependency run faac
Add_dependency run faad2
Add_dependency run lame
Add_dependency run libtheora
Add_dependency run libvorbis
Add_dependency run x264
Add_dependency run xvidcore
Add_dependency run libavdevice
Add_dependency run libpostproc
Add_dependency run libswscale
Add_dependency run libavfilter
Add_dependency run SDL
Add_dependency run libvpx
Add_dependency run libva

Add_dependency build pkg-config
Add_dependency build coreutils
Add_dependency build perl	">=0"
Add_dependency build yasm
Add_dependency build alsa-lib-devel
Add_dependency build libX11-devel
Add_dependency build libXext-devel
Add_dependency build libXfixes-devel
Add_dependency build zlib-devel
Add_dependency build bzip2-devel
Add_dependency build faac-devel
Add_dependency build faad2-devel
Add_dependency build lame-devel
Add_dependency build libtheora-devel
Add_dependency build libvorbis-devel
Add_dependency build x264-devel
Add_dependency build xvidcore-devel
Add_dependency build SDL-devel
Add_dependency build libvpx-devel
Add_dependency build libva-devel

do_configure()
{
	./configure \
		--prefix=/usr \
		--enable-gpl \
		--enable-libmp3lame \
		--enable-libvorbis \
		--enable-libfaac \
		--enable-libxvid \
		--enable-libx264 \
		--enable-libvpx \
		--enable-libtheora \
		--enable-postproc \
		--enable-shared \
		--enable-x11grab \
		--disable-libopencore_amrnb \
		--disable-libopencore_amrwb \
		--disable-libschroedinger \
		--disable-libopenjpeg \
		--enable-version3 \
		--enable-nonfree \
		--enable-runtime-cpudetect \
		--disable-debug  # libfaac is nonfree
}

do_build()
{
	sed -i -e "s|pod2man|/usr/lib/perl5/core_perl/bin/pod2man|g" Makefile
	make ${makejobs}
	make doc/ff{mpeg,play,server}.1
}

do_install()
{
	make DESTDIR=${DESTDIR} install install-man
}
