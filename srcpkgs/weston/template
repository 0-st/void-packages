# Template file for 'weston'.
pkgname=weston
version=1.2.0
revision=1
build_style=gnu-configure
configure_args="--with-cairo-glesv2"
short_desc="Reference implementation of a Wayland compositor"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://wayland.freedesktop.org/"
license="MIT"
distfiles="http://wayland.freedesktop.org/releases/${pkgname}-${version}.tar.xz"
checksum=122e12ae8e4ec4618780465c0cc31d70d67054900a2aac458f82ed6eb5d397b7

hostmakedepends="pkg-config"
makedepends="libpng-devel>=1.6 wayland-devel>=${version} libxkbcommon-devel
 libxcb-devel>=1.9.1 xcb-util-keysyms-devel pixman-devel pango-devel
 cairo-devel>=1.12.14_5 mtdev-devel libwebp-devel poppler-glib-devel pam-devel
 systemd-devel libunwind-devel lcms2-devel libudev-devel"

case "$XBPS_TARGET_MACHINE" in
armv6l) # Assume RPi for now.
	makedepends+=" rpi-firmware rpi-firmware-pcfiles"
	# Just enable the RPi compositor.
	configure_args+=" --disable-x11-compositor --disable-drm-compositor
		--disable-wayland-compositor --disable-simple-egl-clients
		--disable-fbdev-compositor --disable-egl --disable-colord
		--disable-resize-optimization --disable-xwayland-test
		--disable-setuid-install --disable-xwayland
		--disable-weston-launch WESTON_NATIVE_BACKEND=rpi-backend.so"
	;;
x86_64|i686)
	makedepends+=" libXcursor-devel colord-devel glu-devel"
	configure_args+=" --enable-clients"
	;;
esac

post_install() {
	vinstall COPYING 644 usr/share/license/$pkgname

	if [ "$XBPS_TARGET_MACHINE" = "i686" -o "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
		for f in clickdot cliptest dnd eventdemo flower image \
			resizor simple-egl simple-shm smoke view; do
			vinstall clients/$f 755 usr/bin weston-$f
		done
	fi

	# Remove development files.
	rm -rf ${DESTDIR}/usr/include
	rm -rf ${DESTDIR}/usr/lib/pkgconfig
}

weston_package() {
	# cairo built with gles2 option.
	depends="wayland>=1.2.0 cairo>=1.12.14_5"
	pkg_install() {
		vmove all
	}
}
