# Template file for 'lsof'
pkgname=lsof
version=4.83
wrksrc=lsof_${version}
#build_wrksrc=lsof_${version}_src
distfiles="ftp://sunsite.ualberta.ca/pub/Mirror/lsof/lsof_${version}.tar.bz2"
build_style=custom-install
short_desc="LiSt Open Files"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=b89f930bbe36b970e3cd070b9860ee701d8c7285ffedf2fbcec0e5fa3cb1f544
long_desc="
 Lsof is a UNIX-specific tool. Its name stands for LiSt Open Files, and it does
 just that. It lists information about files that are open by the processes
 running on a UNIX system."

Add_dependency run glibc

do_build()
{
        # We have to do this dance because the real distfile is
	# included in the .tar.bz2 archive.
	tar xf ${wrksrc}/lsof_${version}_src.tar \
		-C ${wrksrc} || return 1
	cd ${wrksrc}/lsof_${version}_src || return 1
	sed "s|/\* #define\tHASSECURITY\t1 \*/|#define\tHASSECURITY\t1|" \
		-i dialects/linux/machine.h
	./Configure -n linux || return 1
	make ${makejobs} || return 1
}

do_install()
{
	cd ${wrksrc}/lsof_${version}_src || return 1
	install -D -m755 lsof \
		${DESTDIR}/usr/sbin/lsof || return 1
	install -D -m644 lsof.8 \
		${DESTDIR}/usr/share/man/man8/lsof.8 || return 1
	install -D -m644 ${FILESDIR}/license.txt \
		${DESTDIR}/usr/share/licenses/lsof_license.txt || return 1
}
