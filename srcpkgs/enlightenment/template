# Template file for 'enlightenment'
pkgname=enlightenment
_distver=0.19.0
_patchver=alpha1
version=${_distver}${_patchver}
wrksrc="${pkgname}-${_distver}-${_patchver}"
revision=3
build_style=gnu-configure
configure_args="--enable-pam --disable-bluez4"
hostmakedepends="pkg-config efl>=1.10"
makedepends="
 pam-devel pixman-devel elementary-devel>=1.10 evas_generic_loaders>=1.10
 emotion_generic_players>=1.10 hicolor-icon-theme desktop-file-utils"
depends="hicolor-icon-theme desktop-file-utils elementary>=1.10
 evas_generic_loaders>=1.10 emotion_generic_players>=1.10"
conf_files="/etc/enlightenment/sysactions.conf"
lib32disabled=yes
homepage="http://enlightenment.org"
short_desc="Enlightenment desktop"
maintainer="Juan RP <xtraeme@gmail.com>"
license="BSD"
distfiles="http://download.enlightenment.org/rel/apps/${pkgname}/${pkgname}-${_distver}-${_patchver}.tar.bz2"
checksum=84c6529547ec1b0111a2b3124385242ab2a7522e6668426364c1dc06d024e036

# Package build options
build_options="systemd wayland"
build_options_default="wayland"

if [ "$build_option_systemd" ]; then
	configure_args+=" --enable-systemd"
	makedepends+=" systemd-devel"
else
	configure_args+=" --disable-systemd"
fi

if [ "$build_option_wayland" ]; then
	configure_args+=" --disable-wl-desktop-shell --enable-wayland-egl --enable-wayland-clients"
	makedepends+=" libxkbcommon-devel MesaLib-devel wayland-devel"
else
	configure_args+=" --disable-wayland-egl"
fi

post_install() {
	if [ -z "$build_option_systemd" ]; then
		# Use our native tools to shutdown/suspend.
		sed -i 's/^action:.*halt.*/action: halt shutdown -h now/g' ${DESTDIR}/etc/${pkgname}/sysactions.conf
		sed -i 's/^action:.*reboot.*/action: reboot shutdown -r now/g' ${DESTDIR}/etc/${pkgname}/sysactions.conf
		sed -i 's/^action:.*suspend.*/action: suspend zzz/g' ${DESTDIR}/etc/${pkgname}/sysactions.conf
		sed -i 's/^action:.*hibernate.*/action: hibernate ZZZ/g' ${DESTDIR}/etc/${pkgname}/sysactions.conf
	fi
	vmkdir usr/share/licenses/${pkgname}
	install -m644 COPYING* ${DESTDIR}/usr/share/licenses/${pkgname}
	vinstall ${FILESDIR}/e-applications.menu 644 etc/xdg/menus
	rm -rf ${DESTDIR}/usr/share/${pkgname}/doc
}

enlightenment-devel_package() {
	depends="elementary-devel>=1.10"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
	}
}
