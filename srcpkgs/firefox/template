# Template build file for 'firefox'.
pkgname=firefox
_majorver=7.0
_minorver=1
version=${_majorver}.${_minorver}
revision=1
wrksrc=mozilla-release
patch_args="-Np1"
distfiles="${MOZILLA_SITE}/${pkgname}/releases/${version}/source/${pkgname}-${version}.source.tar.bz2"
short_desc="Lightweight gecko-based web browser"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.mozilla.org/projects/firefox"
license="MPL-1.1, GPL-2, LGPL-2.1"
checksum=81ecf63fca67186094d49dd5a6fe7f5dbd143a39f872ad126de38f246334fc04
long_desc="
 Mozilla Firefox is a free, open-source and cross-platform web browser
 for Windows, Linux, MacOS X and many other operating systems. It is
 small, fast and easy to use, and offers many advantages over other web
 browsers, such as tabbed browsing and the ability to block pop-up
 windows.

 Firefox also offers excellent bookmark and history management, and it
 can be extended by developers using industry standards such as XML,
 CSS, JavaScript, C++, etc. Many extensions are available."

gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run glibc
Add_dependency run sqlite
Add_dependency run libpng
Add_dependency run nss
Add_dependency run cairo
Add_dependency run pixman
Add_dependency run freetype
Add_dependency run fontconfig
Add_dependency run libXrender
Add_dependency run libX11
Add_dependency run zlib
Add_dependency run hunspell
Add_dependency run libevent
Add_dependency run libvpx
Add_dependency run alsa-lib
Add_dependency run nspr
Add_dependency run dbus-libs
Add_dependency run libXext
Add_dependency run pango
Add_dependency run glib
Add_dependency run gtk+
Add_dependency run atk
Add_dependency run gdk-pixbuf
Add_dependency run libXt
Add_dependency run startup-notification
Add_dependency run libstdc++
Add_dependency run libgcc
Add_dependency run dbus-glib
Add_dependency run libnotify
Add_dependency run GConf

Add_dependency run desktop-file-utils
Add_dependency run hicolor-icon-theme

Add_dependency build unzip
Add_dependency build zip
Add_dependency build perl	">=0"
Add_dependency build python	">=2.7.2_3" # linux2 sys.platform fix
Add_dependency build yasm
Add_dependency build libIDL-devel
Add_dependency build nss-devel
Add_dependency build gtk+-devel
Add_dependency build libevent-devel
Add_dependency build libnotify-devel
Add_dependency build libvpx-devel
Add_dependency build libXrender-devel
Add_dependency build libXScrnSaver-devel
Add_dependency build GConf-devel
Add_dependency build startup-notification-devel
Add_dependency build dbus-glib-devel
Add_dependency build alsa-lib-devel
Add_dependency build hunspell-devel
Add_dependency build wireless_tools-devel

do_build() {
	cp -f ${FILESDIR}/mozconfig .mozconfig
	export LDFLAGS="$XBPS_LDFLAGS -Wl,-R/usr/lib/firefox-${_majorver}"
	make -f client.mk MOZ_MAKE_FLAGS="${makejobs}"
}

do_install() {
	make -f client.mk DESTDIR=${DESTDIR} install

	vinstall ${FILESDIR}/firefox.desktop 644 usr/share/applications
	for i in 16x16 22x22 24x24 32x32 48x48 256x256; do
		vinstall browser/branding/official/default${i%x*}.png 644 \
			usr/share/icons/hicolor/${i}/apps firefox.png
	done

	# We don't want the development stuff
	rm -rf ${DESTDIR}/usr/{include,lib/firefox-devel-${_majorver},share/idl}

	# https://bugzilla.mozilla.org/show_bug.cgi?id=658850
	ln -sf /usr/lib/firefox-${_majorver}/firefox-bin \
		${DESTDIR}/usr/lib/firefox-${_majorver}/firefox
}
