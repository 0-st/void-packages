# Template build file for 'firefox'.
pkgname=firefox
version=16.0.1
revision=1
wrksrc=mozilla-release
short_desc="Lightweight gecko-based web browser"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.mozilla.org/projects/firefox"
license="MPL-1.1, GPL-2, LGPL-2.1"
distfiles="${MOZILLA_SITE}/${pkgname}/releases/${version}/source/${pkgname}-${version}.source.tar.bz2"
checksum=57ed98109718aacfdeda2af11b0179916e462ede8ac6576ee99c7d066b162fe7
long_desc="
 Mozilla Firefox is a free, open-source and cross-platform web browser
 for Windows, Linux, MacOS X and many other operating systems. It is
 small, fast and easy to use, and offers many advantages over other web
 browsers, such as tabbed browsing and the ability to block pop-up
 windows.

 Firefox also offers excellent bookmark and history management, and it
 can be extended by developers using industry standards such as XML,
 CSS, JavaScript, C++, etc. Many extensions are available."

depends="desktop-file-utils hicolor-icon-theme"

makedepends="unzip zip perl python yasm jpeg-devel libpng-devel>=1.5.10
 pixman-devel libIDL-devel nss-devel>=3.13.3 sqlite-devel libXrender-devel
 gtk+-devel libevent-devel libnotify-devel libvpx-devel GConf-devel
 startup-notification-devel dbus-glib-devel alsa-lib-devel hunspell-devel
 wireless_tools-devel libXScrnSaver-devel"

do_build() {
	# Fix PRE_RELEASE_SUFFIX
	sed -i '/^PRE_RELEASE_SUFFIX := ""/s/ ""//' browser/base/Makefile.in
	cp -f ${FILESDIR}/mozconfig .mozconfig
	export LDFLAGS="-Wl,-R/usr/lib/firefox"

	make ${makejobs} -f client.mk MOZ_MAKE_FLAGS="${makejobs}"
}

do_install() {
	make -f client.mk DESTDIR=${DESTDIR} install

	vinstall ${FILESDIR}/vendor.js 644 usr/lib/firefox/defaults/pref

	vinstall ${FILESDIR}/firefox.desktop 644 usr/share/applications
	for i in 16x16 22x22 24x24 32x32 48x48 256x256; do
		vinstall browser/branding/official/default${i%x*}.png 644 \
			usr/share/icons/hicolor/${i}/apps firefox.png
	done

	# We don't want the development stuff
	rm -rf ${DESTDIR}/usr/{include,lib/firefox-devel,share/idl}

	# https://bugzilla.mozilla.org/show_bug.cgi?id=658850
	ln -sf firefox ${DESTDIR}/usr/lib/firefox/firefox-bin
}
