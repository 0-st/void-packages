# Template file for 'nss'
pkgname=nss
version=3.12.4
distfiles="${MOZILLA_SITE}/security/nss/releases/NSS_3_12_4_RTM/src/${pkgname}-${version}.tar.gz"
build_style=custom-install
short_desc="Mozilla Network Security Services"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=8202546524c69ce03e1c3ef5e2956b71b8fa0a5bffdf06568597e7c0d1f83bf0
long_desc="
 Network Security Services (NSS) is a set of libraries designed to support
 cross-platform development of security-enabled server applications.
 Applications built with NSS can support SSL v2 and v3, TLS, PKCS \#5,
 PKCS \#7, PKCS \#11, PKCS \#12, S/MIME, X.509 v3 certificates, and other
 security standards."

subpackages="$pkgname-devel"
Add_dependency run glibc
Add_dependency run zlib
Add_dependency full nspr
Add_dependency full sqlite

do_install()
{
	install -d ${DESTDIR}/usr/include/nss ${DESTDIR}/usr/lib/pkgconfig
	if [ "$xbps_machine" = "x86_64" ]; then
		_use64="USE_64=1"
	fi
	for dir in coreconf dbm nss; do
		make -C mozilla/security/${dir} \
			LIBRUNPATH= BUILD_OPT=1 \
			NSS_USE_SYSTEM_SQLITE=1 \
			NSPR_INCLUDE_DIR=/usr/include/nspr \
			NSPR_LIB_DIR=/usr/lib ${_use64} || return 1
	done
	
	install -m644 mozilla/dist/public/nss/*.h ${DESTDIR}/usr/include/nss
	install -m755 mozilla/dist/*.OBJ/lib/*.so ${DESTDIR}/usr/lib

	( echo "Name: NSS"; \
	  echo "Description: Mozilla Network Security Services"; \
	  echo "Version: ${version}"; \
	  echo "Cflags: -I/usr/include/nss"; \
	  echo "Libs: -L/usr/lib -lnss3 -lsmime3 -lssl3 -lsoftokn3 -lpthread -ldl"; \
	) >${DESTDIR}/usr/lib/pkgconfig/nss.pc
	chmod 644 ${DESTDIR}/usr/lib/pkgconfig/nss.pc
}
