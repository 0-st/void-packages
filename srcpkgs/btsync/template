pkgname=btsync
version=2.0.105
revision=1
repository=nonfree
short_desc="Automatically sync files via secure, distributed technology"
maintainer="Juhani Imberg <juhani@imberg.fi>"
license="Propietary license"
homepage="https://www.getsync.com"

case "${XBPS_TARGET_MACHINE}" in
x86_64)
	_type=x64
	_hash=9e1427b7a6c6e960a378b97ac458ad53c445457ed0e5c8bf693f446597377b78
	;;
i686)
	_type=i386
	_hash=4d446255ff6332da9a244737d6c20e7dcd32d24a8eaabffbaf73147e5898ed8f
	;;
arm*)
	_type=arm
	_hash=c63fccb76ba3f5dd1197f33bfb8427747faaca9c030f9d8c7f5dfc016d293807
	;;
esac

distfiles="https://download-cdn.getsyncapp.com/${version}/linux-${_type}/BitTorrent-Sync_${_type}.tar.gz"
checksum="$_hash"
create_wrksrc=true

do_install() {
	vbin btsync
	vlicense LICENSE.TXT
	vdoc README

	vmkdir etc

	vmkdir var/lib/btsync
	touch ${DESTDIR}/var/lib/btsync/.keep

	./btsync --dump-sample-config \
		| sed 's:/home/user/\.sync:/var/lib/btsync:' \
		| sed 's:btsync/btsync.pid:btsync.pid:' \
		| sed 's:\/\/ "pid_file":  "pid_file":' \
		| sed 's:\/\/ "storage_path":  "storage_path":' \
		> "${DESTDIR}/etc/btsync.conf"

	vsv btsync
}
