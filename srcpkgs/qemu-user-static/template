# Template file for 'qemu-user-static'
pkgname=qemu-user-static
version=1.4.0
revision=1
wrksrc="qemu-${version}"
makedepends="pkg-config automake glib-devel pixman-devel"
short_desc="QEMU User-mode emulators (statically compiled)"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://qemu.org"
license="GPL-2, LGPL-2.1"
distfiles="http://wiki.qemu.org/download/qemu-${version}.tar.bz2"
checksum=066297ed77408fb7588889c271a85cf3c259ad55c939315988e6062d7708eda8

do_configure() {
	./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/libexec \
		--disable-kvm --disable-vnc-png --disable-vnc-tls \
		--disable-virtfs --disable-fdt --disable-seccomp \
		--disable-kvm --enable-linux-user --disable-system
}

do_build() {
	make ${makejobs} LDFLAGS="-static -lrt"
}

do_install() {
	make DESTDIR=${DESTDIR} install
	# Remove unneeded stuff.
	rm -rf ${DESTDIR}/etc ${DESTDIR}/usr/share ${DESTDIR}/usr/libexec
	for f in nbd io img; do
		rm -f ${DESTDIR}/usr/bin/qemu-${f}
	done
	for f in ${DESTDIR}/usr/bin/*; do
		mv ${f} ${f}-static
	done 
}
