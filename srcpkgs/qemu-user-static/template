# Template file for 'qemu-user-static'
pkgname=qemu-user-static
version=1.4.1
revision=1
wrksrc="qemu-${version}"
hostmakedepends="pkg-config automake"
makedepends="libglib-devel pixman-devel"
short_desc="QEMU User-mode emulators (statically compiled)"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://qemu.org"
license="GPL-2, LGPL-2.1"
distfiles="http://wiki.qemu.org/download/qemu-${version}.tar.bz2"
checksum=75063a9326221607de3599e89fb5af80f2d8080ddc55ca253fff113843432df1

do_configure() {
	./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/libexec \
		--disable-kvm --disable-vnc-png --disable-vnc-tls \
		--disable-virtfs --disable-fdt --disable-seccomp \
		--disable-kvm --enable-linux-user --disable-system
}

do_build() {
	make ${makejobs} LDFLAGS="-static -lrt"
}

do_install() {
	make DESTDIR=${DESTDIR} install
	# Remove unneeded stuff.
	rm -rf ${DESTDIR}/etc ${DESTDIR}/usr/share ${DESTDIR}/usr/libexec
	for f in nbd io img; do
		rm -f ${DESTDIR}/usr/bin/qemu-${f}
	done
	for f in ${DESTDIR}/usr/bin/*; do
		mv ${f} ${f}-static
	done 
}

qemu-user-static_package() {
	pkg_install() {
		vmove all
	}
}
