# Template file for 'virtualbox-ose-guest'.
#
short_desc="${short_desc} - guest utilities"
long_desc="${long_desc}

 This package provides the guest utilities of the Open Source Edition of
 VirtualBox. These utilities are meant to be run inside the virtual machine.
 They provide closer integration and allow to share data through shared folders
 between the host system and the virtual machine."

systemd_services="virtualbox-guest.service"

Add_dependency run libgcc
Add_dependency run glibc
Add_dependency run libstdc++
Add_dependency run libX11
Add_dependency run libXrandr
Add_dependency run libXt
Add_dependency run libXext
Add_dependency run libXmu
Add_dependency run libXcomposite
Add_dependency run libXdamage
Add_dependency run libXfixes
Add_dependency run pam
Add_dependency run virtualbox-ose-guest-dkms ">=${version}"

do_install()
{
	cd ${wrksrc}
	source ./env.sh

	cd ${wrksrc}/out/linux.$BUILD_PLATFORM_ARCH/release/bin/additions
	install -d ${DESTDIR}/usr/bin ${DESTDIR}/sbin

	install -m755 VBoxClient VBoxControl VBoxService ${DESTDIR}/usr/bin
	install -m755 mount.vboxsf ${DESTDIR}/sbin
	install -Dm755 ${wrksrc}/src/VBox/Additions/x11/Installer/vboxclient.desktop \
		${DESTDIR}/etc/xdg/autostart/vboxclient.desktop

	cd ${wrksrc}/out/linux.$BUILD_PLATFORM_ARCH/release/bin
	install -D vboxmouse_drv.so \
		${DESTDIR}/usr/lib/xorg/modules/input/vboxmouse.so
	cd ${wrksrc}/out/linux.$BUILD_PLATFORM_ARCH/release/bin/additions
	install -D vboxvideo_drv.so \
		${DESTDIR}/usr/lib/xorg/modules/drivers/vboxvideo.so
	install -d ${DESTDIR}/usr/lib/xorg/modules/dri
	install -m755 VBoxOGL*.so ${DESTDIR}/usr/lib
	ln -sf /usr/lib/VBoxOGL.so \
		${DESTDIR}/usr/lib/xorg/modules/dri/vboxvideo_dri.so
	cd ${wrksrc}/out/linux.$BUILD_PLATFORM_ARCH/release/bin/additions
	install -Dm755 pam_vbox.so ${DESTDIR}/lib/security/pam_vbox.so

	vinstall ${FILESDIR}/virtualbox-guest.service 644 lib/systemd/system
}
