#
# This script creates default /etc/passwd and /etc/group
# files if they are unexistent.
#
# Also shadow passwords are enabled.

create_passwd()
{
	cat > ./etc/passwd <<_EOF
root:x:0:0:root:/root:/bin/bash
nobody:x:99:99:Unprivileged User:/dev/null:/bin/false
_EOF
	echo "Created default /etc/passwd file."
}

create_group()
{
	# Default group list as specified by LFS.
	cat > ./etc/group <<_EOF
root:x:0:
bin:x:1:
sys:x:2:
kmem:x:3:
wheel:x:4:
tty:x:5:
tape:x:6:
daemon:x:7:
floppy:x:8:
disk:x:9:
lp:x:10:
dialout:x:11:
audio:x:12:
video:x:13:
utmp:x:14:
usb:x:15:
cdrom:x:16:
optical:x:17:
mail:x:18:
storage:x:19:
scanner:x:20:
plugdev:x:21:
nogroup:x:99:
users:x:100:
_EOF
	echo "Created default /etc/group file."
}

case "${ACTION}" in
post)
	echo "Running ${PKGNAME}-${VERSION} post installation hooks..."

	[ ! -f ./etc/passwd ] && create_passwd
	[ ! -f ./etc/group ] && create_group

	if [ ! -f ./etc/shadow ]; then
		echo "Enabling shadowed (group) passwords..."
		pwconv && grpconv
	fi
	;;
esac
