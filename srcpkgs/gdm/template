# Template file for 'gdm'
pkgname=gdm
version=3.6.0
revision=5
build_style=gnu-configure
configure_args="--disable-schemas-compile --disable-static
--with-at-spi-registryd-directory=/usr/libexec --without-tcp-wrappers
--with-systemd  --with-screenshot-dir=/var/lib/gdm/greeter
--with-xauth-dir=/run/gdm --with-pid-file=/run/gdm/gdm.pid
--with-systemdsystemunitdir=/usr/lib/systemd/system"
makedepends="pkg-config intltool which gnome-doc-utils gobject-introspection
pam-devel nss-devel accountsservice-devel gtk+3-devel>=3.6.0_2 upower-devel
libcanberra-devel libXrandr-devel systemd-devel at-spi2-core-devel itstool"
fulldepends="xrdb dconf>=0.13.90 hicolor-icon-theme polkit-gnome xorg-server
metacity gnome-session>=3.6.0 gnome-settings-daemon>=3.6.0 dbus-x11"
short_desc="GNOME Display Manager"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.gnome.org"
license="GPL-2"
distfiles="${GNOME_SITE}/$pkgname/3.6/$pkgname-$version.tar.xz"
checksum=ea63736fc8f7234aca442f4e99b3ba9cc29dce5e464ed93f7bf7eb8c49abd60b
long_desc="
 GDM is the GNOME Display Manager, it is the little proggie that runs
 in the background, runs your X sessions, presents you with a login box
 and then tells you to piss off because you forgot your password. It
 does pretty much everything that you would want to use xdm for, but
 does not involve as much crack. It doesn't use any code from xdm, and
 has a more paranoid and safer design overall. It also includes many
 features over xdm, the biggest one of which is that it is more user
 friendly, even if your X setup is failing. The goal is that users
 should never, ever have to use the command line to customize or
 troubleshoot gdm. It of course supports xdmcp, and in fact extends
 xdmcp a little bit in places where I thought xdm was lacking (but is
 still compatible with xdm's xdmcp)."

subpackages="libgdm gdm-devel"

conf_files="
/etc/gdm/custom.conf
/etc/pam.d/gdm
/etc/pam.d/gdm-autologin
/etc/pam.d/gdm-fingerprint
/etc/pam.d/gdm-password
/etc/pam.d/gdm-smartcard
/etc/pam.d/gdm-welcome"

# Create the 'gdm' system user/group.
system_accounts="gdm"
gdm_homedir="/var/lib/gdm"
systemd_services="gdm.service off"

post_install() {
	# Use our own pam files.
	rm -f ${DESTDIR}/etc/pam.d/*
	for f in ${FILESDIR}/*.pam; do
		vinstall ${f} 644 etc/pam.d ${f%.pam}
	done
	# Install systemd service.
	vinstall ${FILESDIR}/gdm.tmpfiles.d 644 usr/lib/tmpfiles.d gdm.conf

	chmod 1770 ${DESTDIR}/var/log/gdm
	chmod 700 ${DESTDIR}/var/lib/gdm/.config/dconf
}
