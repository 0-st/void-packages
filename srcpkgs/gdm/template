# Template file for 'gdm'
pkgname=gdm
version=3.4.1
revision=4
distfiles="${GNOME_SITE}/$pkgname/3.4/$pkgname-$version.tar.xz"
build_style=gnu-configure
configure_args="--disable-schemas-compile --disable-scrollkeeper
--with-at-spi-registryd-directory=/usr/libexec --without-tcp-wrappers
--disable-static --without-systemd --with-console-kit
--with-xauth-dir=/run/gdm --with-pid-file=/run/gdm/gdm.pid
--with-screenshot-dir=/var/lib/gdm/greeter"
makedepends="pkg-config intltool which gnome-doc-utils gobject-introspection
pam-devel nss-devel accountsservice-devel gtk+3-devel upower-devel
libcanberra-devel libXrandr-devel libxklavier-devel at-spi2-core-devel"
fulldepends="xrdb dconf hicolor-icon-theme polkit-gnome xorg-server metacity gnome-session gnome-settings-daemon"
subpackages="gdm-devel"
gtk_iconcache_dirs="/usr/share/icons/hicolor"
short_desc="GNOME Display Manager"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.gnome.org"
license="GPL-2"
checksum=6292968dff5fc89877b5e1aaa3c7d1484dd3ed2d4f388e935841d053439be665
long_desc="
 GDM is the GNOME Display Manager, it is the little proggie that runs
 in the background, runs your X sessions, presents you with a login box
 and then tells you to piss off because you forgot your password. It
 does pretty much everything that you would want to use xdm for, but
 does not involve as much crack. It doesn't use any code from xdm, and
 has a more paranoid and safer design overall. It also includes many
 features over xdm, the biggest one of which is that it is more user
 friendly, even if your X setup is failing. The goal is that users
 should never, ever have to use the command line to customize or
 troubleshoot gdm. It of course supports xdmcp, and in fact extends
 xdmcp a little bit in places where I thought xdm was lacking (but is
 still compatible with xdm's xdmcp)."

conf_files="
/etc/gdm/custom.conf
/etc/pam.d/gdm
/etc/pam.d/gdm-autologin
/etc/pam.d/gdm-fingerprint
/etc/pam.d/gdm-password
/etc/pam.d/gdm-smartcard
/etc/pam.d/gdm-welcome"

# Required runtime directories.
make_dirs="
/var/cache/gdm  			1755 root gdm
/var/log/gdm 				1755 root gdm
/var/lib/gdm/.config/dconf		0755 gdm gdm
/var/lib/gdm/.local/share/applications	0755 gdm gdm
"

# Create the 'gdm' system user/group.
system_accounts="gdm"
gdm_homedir="/var/lib/gdm"
systemd_services="gdm.service off"

post_install() {
	# Use our own pam files.
	rm -f ${DESTDIR}/etc/pam.d/*
	for f in gdm gdm-autologin gdm-fingerprint gdm-password gdm-smartcard \
		gdm-welcome; do
		vinstall ${FILESDIR}/${f}.pam 644 etc/pam.d ${f}
	done
	# Install systemd service.
	vinstall ${FILESDIR}/gdm.service 644 lib/systemd/system
	vinstall ${FILESDIR}/gdm.tmpfiles.d 644 usr/lib/tmpfiles.d gdm.conf

	chmod 1770 ${DESTDIR}/var/log/gdm
	chmod 700 ${DESTDIR}/var/lib/gdm/.config/dconf
}
