# Template file for 'boost'
pkgname=boost
version=1.50.0
revision=2
_boostver="$(echo $version|sed 's|\.|_|g')"
wrksrc="${pkgname}_${_boostver}"
subpackages="boost-build boost-devel boost-jam boost-python"
makedepends="zlib-devel icu-devel>=49.1 python-devel"
short_desc="Free peer-reviewed portable C++ source libraries"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.boost.org/"
license="Boost Software License 1.0"
distfiles="${SOURCEFORGE_SITE}/$pkgname/${pkgname}_${_boostver}.tar.bz2"
checksum=c9ace2b8c81fa6703d1d17c7e478de3bc51101c5adbdeb3f6cb72cf3045a8529
long_desc="
 The Boost web site provides free peer-reviewed portable C++ source libraries.
 The emphasis is on libraries which work well with the C++ Standard Library.
 The libraries are intended to be widely useful, and are in regular use by
 thousands of programmers across a broad spectrum of applications."

disable_debug=yes

if [ -n "$XBPS_CROSS_BUILD" ]; then
	# XXX boost-jam and boost-python subpkgs.
	unset makedepends
	subpackages="boost-build boost-devel"
	crossmakedepends="zlib-devel icu-devel>=49.1"
fi

do_build() {
	if [ -n "$XBPS_CROSS_BUILD" ]; then
		echo "using gcc : arm : ${XBPS_CROSS_TRIPLET}-g++ ;" > \
			tools/build/v2/user-config.jam
	fi
	./bootstrap.sh -prefix=${DESTDIR}/usr
	./bjam toolset=gcc-arm cflags="-fno-strict-aliasing $CFLAGS" ${makejobs}
}

do_install() {
	# Install bjam
	if [ "$XBPS_MACHINE" = "i686" ]; then
		_bindir="bin.linuxx86"
	elif [ "$XBPS_MACHINE" = "x86_64" ]; then
		_bindir="bin.linuxx86_64"
	elif [ "$XBPS_MACHINE" = "armv6l" ]; then
		_bindir="bin.linuxarm"
	fi
	[ -z "$XBPS_CROSS_BUILD" ] && vinstall bjam 755 usr/bin

	# Install headers/libs
	./bjam --prefix=${DESTDIR}/usr install

	# Install Boost.Build stuff.
	vmkdir usr/share/boost-build
	cd ${wrksrc}/tools/build/v2 && cp -a . ${DESTDIR}/usr/share/boost-build
	find ${DESTDIR}/usr/share/boost-build \
		-type f -name \*.orig -exec rm -f {} \;
	( echo '# System wide configuration file for Boost.Build.' ; \
	  echo ; \
	  echo 'using gcc ;' ; ) >${wrksrc}/site-config.jam
	cd $wrksrc
	vinstall site-config.jam 644 etc

	# license
	vinstall LICENSE_1_0.txt 644 usr/share/licenses/boost
}
