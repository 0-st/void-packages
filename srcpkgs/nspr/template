# Template file for 'nspr'
pkgname=nspr
version=4.8.9
distfiles="${MOZILLA_SITE}/nspr/releases/v${version}/src/${pkgname}-${version}.tar.gz"
build_style=gnu_configure
configure_script="./mozilla/nsprpub/configure"
if [ "$xbps_machine" = "x86_64" ]; then
	_for64="--enable-64bit"
fi
configure_args="--libdir=/usr/lib --includedir=/usr/include/nspr
 --enable-optimize --disable-debug --with-pthreads ${_for64}"
short_desc="NetScape Portable Runtime"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.mozilla.org/projects/nspr/"
license="GPL-2, MPL-1.1"
checksum=ff43c7c819e72f03bb908e7652c5d5f59a5d31ee86c333e692650207103d1cce
long_desc="
 Netscape Portable Runtime (NSPR) provides a platform-neutral API for system
 level and libc like functions. The API is used in the Mozilla client, many of
 Netscape/AOL/iPlanet's and other software offerings."

subpackages="$pkgname-devel"
Add_dependency run glibc

post_install()
{
	local nspr_config="${DESTDIR}/usr/bin/nspr-config"
	local pcver="$(${nspr_config} --version)"

	rm -rf ${DESTDIR}/usr/include/nspr/md ${DESTDIR}/usr/share
	rm -f ${DESTDIR}/usr/bin/prerr.* ${DESTDIR}/usr/bin/compile-et.pl

	# Install the pkgconfig file.
	install -d ${DESTDIR}/usr/lib/pkgconfig
	( echo "Name: NSPR"; \
	  echo "Description: The Netscape Portable Runtime"; \
	  echo "Version: ${pcver}"; \
	  echo "Cflags: -I/usr/include/nspr"; \
	  echo "Libs: -L/usr/lib -lplds4 -lplc4 -lnspr4 -lpthread -ldl"; \
	) >${DESTDIR}/usr/lib/pkgconfig/nspr.pc
	chmod 644 ${DESTDIR}/usr/lib/pkgconfig/nspr.pc
	cd ${DESTDIR}/usr/lib/pkgconfig && \
		ln -s nspr.pc mozilla-nspr.pc 
}
