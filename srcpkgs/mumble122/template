# Template file for 'mumble122'
__pkgname=mumble
pkgname=${__pkgname}122
version=1.2.2
homepage="http://${__pkgname}.sourceforge.net/"
distfiles="${SOURCEFORGE_SITE}/${__pkgname}/${__pkgname}-${version}.tar.gz"
short_desc="Open source, low-latency, high quality voice chat for gaming"
maintainer="davehome <davehome@redthumb.info.tm>"
license="BSD"
checksum=2c564e3d5b7481129482f2365375a2dc77e134c0c00012073cfdfbeadaa49be8
long_desc="
 Mumble is a voice chat application for groups. While it can be used for any
 kind of activity, it is primarily intended for gaming. It can be compared to
 programs like Ventrilo or TeamSpeak. People tend to simplify things, so when
 they talk about Mumble they either talk about Mumble the client application
 or about Mumble and Murmur the whole voice chat application suite.

 This is the old version of mumble with a patch to enable JACK support from
 Filipe Coelho (falkTX) of KXStudio."

disable_parallel_build=yes
replaces="lib${__pkgname}<=1.2.3 ${__pkgname}>=0"
provides="${__pkgname}-999"
gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run glibc
Add_dependency run protobuf
Add_dependency run libXi
Add_dependency run qt
Add_dependency run libssl
Add_dependency run libspeex
Add_dependency run libjack
Add_dependency run jack
Add_dependency run libsndfile
Add_dependency run libX11
Add_dependency run alsa-lib
Add_dependency run libpulseaudio
Add_dependency run avahi-compat-libs
Add_dependency run MesaLib
Add_dependency run libstdc++
Add_dependency run libgcc
Add_dependency run libogg
Add_dependency run qt-plugin-sqlite

Add_dependency build protobuf-devel
Add_dependency build libXi-devel
Add_dependency build qt-devel
Add_dependency build openssl-devel
Add_dependency build speex-devel
Add_dependency build jack-devel
Add_dependency build libsndfile-devel
Add_dependency build libX11-devel
Add_dependency build alsa-lib-devel
Add_dependency build pulseaudio-devel
Add_dependency build avahi-compat-libs-devel
Add_dependency build MesaLib-devel
Add_dependency build libstdc++-devel
Add_dependency build libogg-devel
Add_dependency build boost-devel

Add_dependency full desktop-file-utils
Add_dependency full hicolor-icon-theme

wrksrc=${__pkgname}-${version}

do_configure()
{
	# Needs bundled celt for some reason
	qmake -recursive main.pro \
		CONFIG+="no-speechd bundled-celt no-bundled-speex no-g15 \
			pulseaudio no-embed-qt-translations no-update\
			jackaudio no-server" \
		DEFINES+="PLUGIN_PATH=/usr/lib/mumble"
}

do_build()
{
	make ${makejobs} release
}

do_install()
{
	vmkdir usr/bin
	vmkdir usr/lib/mumble
	vmkdir usr/share/applications
	vmkdir usr/share/man/man1
	vmkdir usr/share/icons/hicolor/scalable/apps

	cp ${wrksrc}/release/mumble ${DESTDIR}/usr/bin
	cp ${wrksrc}/release/mumble11x ${DESTDIR}/usr/bin
	cp ${wrksrc}/release/*.so* ${DESTDIR}/usr/lib/mumble
	cp ${wrksrc}/release/plugins/* ${DESTDIR}/usr/lib/mumble

	cp ${wrksrc}/scripts/mumble.desktop ${DESTDIR}/usr/share/applications
	cp ${wrksrc}/man/mumble{,11x}.1 ${DESTDIR}/usr/share/man/man1
	cp ${wrksrc}/icons/mumble.svg ${DESTDIR}/usr/share/icons/hicolor/scalable/apps
}
