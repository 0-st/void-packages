# Template file for 'cinnamon'
pkgname=cinnamon
version=1.6.7
revision=1
build_style=gnu-configure
configure_args="--disable-schemas-compile --enable-compile-warnings=yes
 --disable-static --with-ca-certificates=/etc/ssl/certs/ca-certificates.crt"
makedepends="which gnome-common gettext-devel automake gnome-doc-utils
 pkg-config intltool glib-devel dbus-glib-devel libxml2-devel gtk+3-devel>=3.6.0_2
 libmuffin-devel>=1.1.2 gjs-devel gnome-menus-devel>=3.6.0 GConf-devel
 libsoup-devel libcanberra-devel gobject-introspection libcroco-devel
 MesaLib-devel cogl-devel>=1.12 clutter-devel>=1.12 startup-notification-devel
 polkit-devel NetworkManager-devel libgnome-keyring-devel>=3.6.0
 gnome-desktop-devel>=3.6.0 gnome-bluetooth-devel>=3.6.0 pulseaudio-devel
 gsettings-desktop-schemas-devel>=3.6.0"
depends="desktop-file-utils caribou pulseaudio mesa-demos muffin>=1.1.2
 python-gconf python-lxml python-imaging"
short_desc="The Cinnamon desktop (gnome-shell fork)"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
homepage="http://cinnamon.linuxmint.com/"
long_desc="
 Cinnamon is a Linux desktop which provides advanced innovative features and
 a traditional user experience.

 The desktop layout is similar to Gnome 2. 
 The underlying technology is forked from Gnome Shell.
 The emphasis is put on making users feel at home and providing them with an
 easy to use and comfortable desktop experience."

nofetch=yes
noextract=yes

pycompile_dirs="usr/lib/cinnamon-settings usr/lib/cinnamon-menu-editor"
LDFLAGS="-lgthread-2.0"

do_fetch() {
	local url="git://github.com/linuxmint/Cinnamon.git"
	msg_normal "Fetching source from $url ...\n"
        git clone -b ${version} $url ${pkgname}-${version}
}

pre_configure() {
	_cur="/usr/lib/gnome-session/gnome-session-check-accelerated"
	_new="/usr/libexec/gnome-session-check-accelerated"

	# Fix path to gnome-session-check-accelerated
	sed -i -e "s|${_cur}|${_new}|g" \
		files/usr/share/gnome-session/sessions/cinnamon.session
	./autogen.sh

	# Workaround for 'Unknown attribute IN (Gtk.ShadowType)' in
	# cinnamon-settings.
	sed -i -e "s|Gtk.ShadowType.IN|Gtk.ShadowType.NONE|g" \
		files/usr/lib/cinnamon-settings/cinnamon-settings.py
	# Workaround for 'Unknown attribute MODIFIER_TAP in
	# Gtk.CellRendererAccelMode in cinnamon-settings.
	sed -i -e "s|Gtk.CellRendererAccelMode.MODIFIER_TAP|Gtk.CellRendererAccelMode.GTK|g" \
		files/usr/lib/cinnamon-settings/cinnamon-settings.py
}
