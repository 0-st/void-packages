# Template file for 'xbmc'
pkgname=xbmc
version=10.0
distfiles="http://mirrors.xbmc.org/releases/source/xbmc-$version.tar.gz"
build_style=gnu_configure
short_desc="XBMC Media Center"
configure_args="--disable-hal --disable-webserver --disable-debug
--disable-external-python --enable-goom --enable-mid LDFLAGS="
make_install_target="prefix=${XBPS_DESTDIR}/${pkgname}-${version}/usr install"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=06fa5332f4f448f4f68bf705e0e159591a866b1cace52840c78ea4f5925a404a
long_desc="
 XBMC is an award-winning free and open source (GPL) software media player
 and entertainment hub for digital media. XBMC is available for Linux, OSX,
 Windows, and the original Xbox."

gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run libgcc
Add_dependency run glibc
Add_dependency run libstdc++
Add_dependency run expat
Add_dependency run libpng
Add_dependency run jpeg
Add_dependency run tiff
Add_dependency run libXmu
Add_dependency run libXrandr
Add_dependency run avahi-libs
Add_dependency run libpulseaudio
Add_dependency run SDL_mixer
Add_dependency run libsmbclient
Add_dependency run libmysqlclient
Add_dependency run libmpeg2
Add_dependency run libwavpack
Add_dependency run zlib
Add_dependency run lzo
Add_dependency run MesaLib
Add_dependency run glew
Add_dependency run fribidi
Add_dependency run sqlite
Add_dependency run libpcre
Add_dependency run libcdio
Add_dependency run glib
Add_dependency run freetype
Add_dependency run libogg
Add_dependency run libvorbis
Add_dependency run alsa-lib
Add_dependency run libX11
Add_dependency run libXtst
Add_dependency run libXext
Add_dependency run dbus-libs
Add_dependency run SDL
Add_dependency run libjasper
Add_dependency run faac
Add_dependency run SDL_image
Add_dependency run faad2
Add_dependency run libmodplug
Add_dependency run libssl
Add_dependency run libmad
Add_dependency run fontconfig
Add_dependency run libXrender

Add_dependency build pkg-config
Add_dependency build automake
Add_dependency build expat-devel
Add_dependency build libpng-devel
Add_dependency build jpeg-devel
Add_dependency build tiff-devel
Add_dependency build libXmu-devel
Add_dependency build libXrandr-devel
Add_dependency build avahi-libs-devel
Add_dependency build pulseaudio-devel
Add_dependency build SDL_mixer-devel
Add_dependency build samba-devel
Add_dependency build libmysqlclient-devel
Add_dependency build libmpeg2-devel
Add_dependency build wavpack-devel
Add_dependency build zlib-devel
Add_dependency build lzo-devel
Add_dependency build MesaLib-devel
Add_dependency build glew-devel
Add_dependency build fribidi-devel
Add_dependency build sqlite-devel
Add_dependency build pcre-devel
Add_dependency build libcdio-devel
Add_dependency build glib-devel
Add_dependency build freetype-devel
Add_dependency build libogg-devel
Add_dependency build libvorbis-devel
Add_dependency build alsa-lib-devel
Add_dependency build libX11-devel
Add_dependency build libXtst-devel
Add_dependency build libXext-devel
Add_dependency build dbus-devel
Add_dependency build SDL-devel
Add_dependency build jasper-devel
Add_dependency build faac-devel
Add_dependency build SDL_image-devel
Add_dependency build faad2-devel
Add_dependency build libmodplug-devel
Add_dependency build openssl-devel
Add_dependency build libmad-devel
Add_dependency build fontconfig-devel
Add_dependency build libXrender-devel

Add_dependency full dbus		">=0"
Add_dependency full udisks		">=0"
Add_dependency full upower		">=0"
Add_dependency full hicolor-icon-theme
Add_dependency full desktop-file-utils
Add_dependency full mesa-demos # required glxinfo

pre_configure()
{
	export SVN_REV="-XBPS"
	sed -i -e "/^AM_GNU_GETTEXT_VERSION.*$/d" lib/cpluff/configure.ac
	sed -i -e 's:/usr/bin/lsb_release -d:/bin/true:' xbmc/utils/SystemInfo.cpp
	./bootstrap
}

post_install()
{
	# Fix files containing invalid chars "&".
	find ${DESTDIR} -type f | while read f; do
		if $(echo "$f"|grep -q "&"); then
			newf=$(echo "$f"|sed -e "s|&|and|g")
			mv "$f" "$newf"
		fi
	done
	rm -f ${DESTDIR}/usr/share/icons/hicolor/icon-theme.cache
}
