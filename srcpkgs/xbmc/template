# Template file for 'xbmc'
pkgname=xbmc
version=10.1
revision=11
patch_args="-Np1"
distfiles="http://mirrors.xbmc.org/releases/source/xbmc-$version.tar.gz"
short_desc="XBMC Media Center"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.xbmc.org"
license="GPL-2"
checksum=3403195b7eb1d076523f2394793b7f050df00743892b031f6fea86b998559d8a
long_desc="
 XBMC is an award-winning free and open source (GPL) software media player
 and entertainment hub for digital media. XBMC is available for Linux, OSX,
 Windows, and the original Xbox."

broken_as_needed=yes
gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run dbus		">=0"
Add_dependency run udisks	">=0"
Add_dependency run upower	">=0"
Add_dependency run hicolor-icon-theme
Add_dependency run desktop-file-utils
Add_dependency run mesa-demos # required glxinfo

Add_dependency build pkg-config
Add_dependency build gperf
Add_dependency build cmake
Add_dependency build zip
Add_dependency build automake
Add_dependency build findutils
Add_dependency build nasm
Add_dependency build yasm
Add_dependency build pcre-devel
Add_dependency build expat-devel
Add_dependency build libpng-devel
Add_dependency build jpeg-devel
Add_dependency build tiff-devel
Add_dependency build libXmu-devel
Add_dependency build libXrandr-devel
Add_dependency build avahi-libs-devel
Add_dependency build pulseaudio-devel
Add_dependency build SDL_mixer-devel
Add_dependency build samba-devel
Add_dependency build libmysqlclient-devel
Add_dependency build libmpeg2-devel
Add_dependency build wavpack-devel
Add_dependency build zlib-devel
Add_dependency build lzo-devel
Add_dependency build MesaLib-devel
Add_dependency build glew-devel
Add_dependency build fribidi-devel
Add_dependency build sqlite-devel
Add_dependency build libcdio-devel
Add_dependency build freetype-devel
Add_dependency build jasper-devel
Add_dependency build faac-devel
Add_dependency build SDL_image-devel
Add_dependency build faad2-devel
Add_dependency build libmodplug-devel
Add_dependency build openssl-devel
Add_dependency build libmad-devel
Add_dependency build fontconfig-devel
Add_dependency build libXinerama-devel
Add_dependency build libsamplerate-devel
Add_dependency build libmms-devel
Add_dependency build enca-devel
Add_dependency build bzip2-devel
Add_dependency build boost-devel
Add_dependency build libcurl-devel
Add_dependency build libva-devel
Add_dependency build libvdpau-devel

do_configure() {
	export GIT_REV="-XBPS"
	sed -i -e "/^AM_GNU_GETTEXT_VERSION.*$/d" lib/cpluff/configure.ac
	sed -i -e 's:/usr/bin/lsb_release -d:/bin/true:' xbmc/utils/SystemInfo.cpp
	./bootstrap
	./configure --prefix=/usr --disable-hal --disable-webserver \
		--disable-debug --enable-external-python --enable-goom \
		--enable-mid --enable-vdpau --enable-vaapi
}

do_build() {
	make ${makejobs}
}

post_install() {
	make prefix=${DESTDIR}/usr install

	vinstall tools/Linux/xbmc.desktop 644 usr/share/applications
	vinstall tools/Linux/xbmc-48x48.png 644 usr/share/pixmaps xbmc.png

	vinstall xbmc-xrandr 755 usr/share/xbmc
	vinstall tools/TexturePacker/TexturePacker 755 usr/share/xbmc

	rm -f ${DESTDIR}/usr/share/icons/hicolor/icon-theme.cache
}
