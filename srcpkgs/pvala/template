# Template file for 'pvala'
pkgname=pvala
version=20130929
revision=1
build_style=gnu-configure
configure_args="--enable-vapigen"
hostmakedepends="autoconf automake libtool pkg-config flex libxslt git vala"
makedepends="libglib-devel libfl-devel"
short_desc="Compiler for the GObject type system - Profile plugins version"
maintainer="davehome <davehome@redthumb.info.tm"
homepage="http://live.gnome.org/Vala"
license="LGPL-2.1"
long_desc="
 Vala is a new programming language that aims to bring modern programming
 language features to GNOME developers without imposing any additional runtime
 requirements and without using a different ABI compared to applications and
 libraries written in C.  This version adds an experimental patch that enables
 one to provide profile-based code generator plugin modules (ie. the return of
 the POSIX profile!)"

do_fetch() {
	local url="git://git.gnome.org/vala"
	local _patch="${FILESDIR}/valac-profile-plugins.patch"
	msg_normal "Fetching source from $url ...\n"
	git clone ${url} ${pkgname}-${version}
	msg_normal "Applying ${_patch} ...\n"
	cd "${pkgname}-${version}" && git apply ${_patch}

}

pre_configure() {
	./autogen.sh
}

libpvala_package() {
	short_desc+=" - shared library"
	replaces="libvala>=0"
	provides="libvala-${version}"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

pvala-devel_package() {
	depends="libglib-devel pvala>=${version}"
	short_desc+=" - development files"
	replaces="vala-devel>=0"
	provides="vala-devel-${version}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
		vmove usr/share/aclocal
		vmove usr/share/devhelp
	}
}

pvala_package() {
	depends="libpvala>=${version}"
	replaces="vala>=0"
	provides="vala-${version}"
	pkg_install() {
		vmove all
	}
}
