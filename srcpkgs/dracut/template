# Template file for 'dracut'
pkgname=dracut
version=026
revision=2
build_style=gnu-makefile
make_build_args="sysconfdir=/etc systemdsystemunitdir=/usr/lib/systemd/system"
make_install_args="sysconfdir=/etc systemdsystemunitdir=/usr/lib/systemd/system"
depends="psmisc>=22.14_2 cpio xz systemd>=198"
makedepends="libxslt docbook-xsl asciidoc"
conf_files="/etc/dracut.conf"
make_dirs="/etc/dracut.conf.d 0755 root root"
subpackages="dracut-network"
homepage="http://www.kernel.org/pub/linux/utils/boot/dracut/dracut.html"
short_desc="A new initramfs infrastructure"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
distfiles="${KERNEL_SITE}/utils/boot/$pkgname/$pkgname-$version.tar.xz"
checksum=8e18d9f2538c680476a380560f8a6268480559785303a5db107b2b54c49d3ec7

pre_build() {
	# Remove the nonsense syncheck target.
	sed -i -e "s|all: syncheck|all:|g" Makefile
}

pre_install() {
	# fix path to busybox.
	sed -i "s|/sbin/busybox|/bin/busybox|g" modules.d/05busybox/module-setup.sh
}

post_install() {
	# kernel hooks.
	vinstall ${FILESDIR}/kernel-hook-postinst \
		755 etc/kernel.d/post-install 10-dracut
	vinstall ${FILESDIR}/kernel-hook-postrm \
		755 etc/kernel.d/post-remove 10-dracut
}
