# Template file for 'apache-fop'
pkgname="apache-fop"
version="1.1"
revision=3
short_desc="Java print formatter driven by XSL formatting objects (XSL-FO) and an output independent formatter"
maintainer="Carlo Dormeletti <carlo.dormeletti@email.it>"
license="Apache-2.0"
homepage="http://xmlgraphics.apache.org/fop/"
distfiles="http://mirror.dkd.de/apache/xmlgraphics/fop/source/fop-${version}-src.tar.gz"
checksum="58164cb3298d130522ecd445b8082c71c36242ea6464c8f02ab4157e4a332522"
only_for_archs="i686 x86_64"
hostmakedepends="jdk"
makedepends="apache-ant"
depends="jre "
wrksrc="fop-${version}"

conf_files="/etc/fop.conf"

if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
    makedepends+=" JAI"
    depends+=" JAI"
elif [ "$XBPS_TARGET_MACHINE" = "i686" ]; then
    makedepends+=" JAI"
    depends+=" JAI"
fi

do_build(){
    JAVA_HOME=/usr/share/java ant package
    JAVA_HOME=/usr/share/java ant javadocs
}

do_install() {
    _prefix="usr/share/fop" 
    _docs="usr/share/doc/fop-${version}"
    vmkdir ${_prefix}
    vmkdir ${_docs}
    vmkdir ${_prefix}/build
    vcopy "build/fop*.jar" ${_prefix}/build
    vmkdir ${_prefix}/lib
    vcopy "lib/*" ${_prefix}/lib
    vmkdir ${_docs}/conf
    vcopy "conf/*" ${_docs}/conf
    vmkdir ${_docs}/examples
    vcopy "examples/*" ${_docs}/examples
    vmkdir ${_docs}/javadocs
    vcopy "build/javadocs/*" ${_docs}/javadocs
    vcopy fop ${_prefix}
    vcopy fop.js ${_prefix}
    vcopy KEYS ${_docs}
    vcopy LICENSE ${_docs}
    vcopy NOTICE ${_docs}
    vcopy README ${_docs}
    vcopy status.xml ${_prefix}
    vcopy ${FILESDIR}/README.void ${_docs}
    vinstall ${FILESDIR}/fop.conf 644 etc/
    #create a handy symlink
    vmkdir usr/bin
    ln -sf /usr/share/fop/fop $DESTDIR/usr/bin/fop
}

