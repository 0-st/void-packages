# Template file for 'dovecot'
pkgname=dovecot
version=2.1.9
revision=2
build_style=gnu-configure
configure_args="--with-moduledir=/usr/lib/dovecot/modules --with-sql=plugin
--disable-static --with-nss --with-pam --with-mysql --with-pgsql
--with-sqlite --with-ssl=openssl --with-ssldir=/etc/dovecot/ssl
--with-gssapi --with-ldap=plugin --with-zlib --with-bzlib --with-libcap
--with-solr --with-docs --with-systemdsystemunitdir=/usr/lib/systemd/system"
depends="openssl>=0"
makedepends="openssl-devel mit-krb5-devel libmysqlclient-devel>=5.5.27
postgresql-libs-devel sqlite-devel libldap-devel libcap-devel pam-devel
libcurl-devel expat-devel"
short_desc="IMAP and POP3 server written with security primarily in mind"
maintainer="Juan RP <xtraeme@gmail.com>"
license="LGPL-2.1"
homepage="http://dovecot.org"
distfiles="$homepage/releases/2.1/$pkgname-$version.tar.gz"
checksum=77d11112bced9e2bbb1410ce5e6464af477775315ec67c7f3ab4d0da64e3c512
long_desc="
 Dovecot is an open source IMAP and POP3 email server for Linux/UNIX-like
 systems, written with security primarily in mind. Dovecot is an excellent
 choice for both small and large installations. It's fast, simple to set
 up, requires no special administration and it uses very little memory."

subpackages="${pkgname}-plugin-ldap ${pkgname}-plugin-mysql"
subpackages="${subpackages} ${pkgname}-plugin-pgsql ${pkgname}-plugin-sqlite"

systemd_services="dovecot.service true"
system_accounts="dovecot dovenull"
dovecot_homedir="/var/chroot"
dovenull_homedir="/var/chroot"

conf_files="
/etc/dovecot/conf.d/10-auth.conf
/etc/dovecot/conf.d/10-director.conf
/etc/dovecot/conf.d/10-logging.conf
/etc/dovecot/conf.d/10-mail.conf
/etc/dovecot/conf.d/10-master.conf
/etc/dovecot/conf.d/10-ssl.conf
/etc/dovecot/conf.d/15-lda.conf
/etc/dovecot/conf.d/20-imap.conf
/etc/dovecot/conf.d/20-lmtp.conf
/etc/dovecot/conf.d/20-pop3.conf
/etc/dovecot/conf.d/90-acl.conf
/etc/dovecot/conf.d/90-plugin.conf
/etc/dovecot/conf.d/90-quota.conf
/etc/dovecot/conf.d/auth-checkpassword.conf.ext
/etc/dovecot/conf.d/auth-deny.conf.ext
/etc/dovecot/conf.d/auth-master.conf.ext
/etc/dovecot/conf.d/auth-passwdfile.conf.ext
/etc/dovecot/conf.d/auth-sql.conf.ext
/etc/dovecot/conf.d/auth-static.conf.ext
/etc/dovecot/conf.d/auth-system.conf.ext
/etc/dovecot/conf.d/auth-vpopmail.conf.ext
/etc/dovecot/dovecot.conf
/etc/ssl/dovecot-openssl.cnf"

post_install() {
	local econfdir=usr/share/doc/dovecot/example-config
	local econfdird=${econfdir}/conf.d

	# install example conf files and ssl.conf
	vmkdir etc/dovecot/conf.d
	install -m644 ${DESTDIR}/${econfdird}/*.conf \
		${DESTDIR}/etc/dovecot/conf.d
	install -m644 ${DESTDIR}/${econfdird}/*.conf.ext \
		${DESTDIR}/etc/dovecot/conf.d
	install -m644 ${DESTDIR}/${econfdir}/dovecot.conf ${DESTDIR}/etc/dovecot
	vinstall doc/dovecot-openssl.cnf 644 etc/ssl
	vinstall doc/mkcert.sh 755 usr/sbin dovecot-mkcert.sh
	rm ${DESTDIR}/etc/dovecot/README

	# Remove development stuff.
	rm -rf ${DESTDIR}/usr/include
	rm -rf ${DESTDIR}/usr/share/aclocal
}
