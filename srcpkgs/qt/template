# Template file for 'qt'
pkgname=qt
version=4.6.0
_distname=qt-everywhere-opensource-src
wrksrc=${_distname}-${version}
distfiles="ftp://ftp.qtsoftware.com/qt/source/${_distname}-$version.tar.gz"
build_style=configure
configure_args="-confirm-license -opensource
-prefix /usr -sysconfdir /etc -plugindir /usr/lib/qt/plugins
-translationdir /usr/share/qt/translations -datadir /usr/share/qt
-docdir /usr/share/doc/qt -examplesdir /usr/share/doc/qt/examples
-demosdir /usr/share/doc/qt/demos -largefile -plugin-sql-sqlite -system-sqlite
-xmlpatterns -phonon -phonon-backend -svg -webkit -scripttools -system-zlib
-system-libtiff -system-libpng -system-libmng -system-libjpeg
-openssl-linked -optimized-qmake -no-rpath -reduce-relocations
-no-separate-debug-info -gtkstyle -opengl -glib -no-sql-db2 -no-sql-ibase
-no-sql-mysql -no-sql-oci -no-sql-odbc -no-sql-sqlite2 -no-sql-tds
-no-cups -dbus-linked -no-nas-sound -iconv -shared -release -fast"
make_install_target="INSTALL_ROOT=$XBPS_DESTDIR/$pkgname-$version install"
short_desc="A cross-platform application and UI framework"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=55259c813324f6383cbd441aa2f23e01c320b6d63fbe3b5d52a7715055d28589
long_desc="
 Qt(TM) is a GUI software toolkit. Qt simplifies the task of writing and
 maintaining GUI (graphical user interface) applications."

subpackages="qt-plugin-gstreamer qt-demos qt-docs qt-qmake qt-qtconfig"
subpackages="${subpackages} qt-designer qt-devel qt-devel-tools"

# XXX Missing dependencies: unixodbc, postgresql, mysql, cups.
Add_dependency run glibc
Add_dependency run dbus-libs
Add_dependency build dbus-devel
_qt_deps="fontconfig freetype glib MesaLib jpeg libmng libpng tiff"
_qt_deps="${_qt_deps} sqlite libxml2 libICE libSM libX11 libXext libXrender"
_qt_deps="${_qt_deps} zlib openssl alsa-lib"

for _dep_ in ${_qt_deps}; do
	Add_dependency run	${_dep_}
	Add_dependency build	${_dep_}-devel
done

pre_build()
{
	export LD_LIBRARY_PATH="${wrksrc}/lib:${LD_LIBRARY_PATH}"
}

post_install()
{
	local hicolordir=${DESTDIR}/usr/share/icons/hicolor

	cd ${wrksrc} || return 1
	# install missing icons and desktop files
	for icon in tools/linguist/linguist/images/icons/linguist-*-32.png ; do
		size=$(echo $(basename ${icon}) | cut -d- -f2)
		install -D -m644 ${icon} \
			${hicolordir}/${size}x${size}/apps/linguist.png \
			|| return 1
	done
	install -D -m644 src/gui/dialogs/images/qtlogo-64.png \
		${hicolordir}/64x64/apps/qtlogo.png || return 1
	install -D -m644 tools/assistant/tools/assistant/images/assistant.png \
		${hicolordir}/32x32/apps/assistant.png || return 1
	install -D -m644 tools/designer/src/designer/images/designer.png \
		${hicolordir}/128x128/apps/designer.png || return 1
	install -D -m644 ${FILESDIR}/gstreamer-logo.png \
		${hicolordir}/128x128/apps/phonon-gstreamer.png || return 1
	install -d ${DESTDIR}/usr/share/applications
	install -m644 ${FILESDIR}/*.desktop \
		${DESTDIR}/usr/share/applications || return 1
}
