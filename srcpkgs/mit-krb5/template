# Template file for 'mit-krb5'
pkgname=mit-krb5
version=1.10.1
wrksrc="krb5-${version}"
homepage="http://web.mit.edu/Kerberos"
distfiles="$homepage/dist/krb5/1.10/krb5-$version-signed.tar"
build_style=gnu-configure
configure_script="./src/configure"
configure_args="--disable-rpath --with-system-et
--with-system-ss --with-system-db --enable-shared CFLAGS=-I/usr/include/et"
short_desc="MIT Kerberos 5 implementation"
maintainer="Juan RP <xtraeme@gmail.com>"
license="MIT"
checksum=d57fcef50e8f113907c3bd94f33db352600bce0f9f1b6d0c15a6d67d6ad62f0a
long_desc="
 Kerberos is a network authentication protocol. It is designed to provide
 strong authentication for client/server applications by using secret-key
 cryptography. A free implementation of this protocol is available from the
 Massachusetts Institute of Technology. Kerberos is available in many
 commercial products as well."

noextract=yes
subpackages="$pkgname-devel $pkgname-libs $pkgname-client"
conflicts="heimdal>=0"

Add_dependency run mit-krb5-client

Add_dependency build perl ">=0"
Add_dependency build flex
Add_dependency build db-devel
Add_dependency build e2fsprogs-devel
Add_dependency build openssl-devel

pre_configure() {
	# We have to do this dance because the real distfile is
	# included in the .tar archive.
	tar xf ${XBPS_SRCDISTDIR}/$(basename ${distfiles}) \
		-C ${wrksrc}
	tar xfz ${wrksrc}/krb5-${version}.tar.gz \
		-C ${XBPS_BUILDDIR}
	# Fix db plugin.
	sed -i -e "s|<db.h>|<db_185.h>|" ${wrksrc}/src/plugins/kdb/db2/*.[ch]
}
