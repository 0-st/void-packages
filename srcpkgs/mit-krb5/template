# Template file for 'mit-krb5'
pkgname=mit-krb5
version=1.9.1
wrksrc="krb5-${version}"
homepage="http://web.mit.edu/Kerberos"
distfiles="$homepage/dist/krb5/1.9/krb5-$version-signed.tar"
build_style=gnu-configure
configure_script="./src/configure"
configure_args="--disable-rpath --enable-kdc-replay-cache --with-system-et
--with-system-ss --with-system-db --enable-shared CFLAGS=-I/usr/include/et"
short_desc="MIT Kerberos 5 implementation"
maintainer="Juan RP <xtraeme@gmail.com>"
license="MIT"
checksum=525e258aa7401427a5a9edee0051f83b6151bf96a979ca526393932c90484c8e
long_desc="
 Kerberos is a network authentication protocol. It is designed to provide
 strong authentication for client/server applications by using secret-key
 cryptography. A free implementation of this protocol is available from the
 Massachusetts Institute of Technology. Kerberos is available in many
 commercial products as well."

noextract=yes
subpackages="$pkgname-devel $pkgname-libs $pkgname-client"
conflicts="heimdal>=0"

Add_dependency run glibc
Add_dependency run libdb
Add_dependency run e2fsprogs-libs
Add_dependency run libssl
Add_dependency run mit-krb5-libs
Add_dependency run mit-krb5-client

Add_dependency build perl ">=0"
Add_dependency build flex
Add_dependency build db-devel
Add_dependency build e2fsprogs-devel
Add_dependency build openssl-devel

pre_configure()
{
	# We have to do this dance because the real distfile is
	# included in the .tar archive.
	tar xf ${XBPS_SRCDISTDIR}/$(basename ${distfiles}) \
		-C ${wrksrc}
	tar xfz ${wrksrc}/krb5-${version}.tar.gz \
		-C ${XBPS_BUILDDIR}

	# Fix db plugin.
	sed -i -e "s|<db.h>|<db_185.h>|" ${wrksrc}/src/plugins/kdb/db2/*.[ch]
}
