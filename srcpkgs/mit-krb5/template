# Template file for 'mit-krb5'
pkgname=mit-krb5
version=1.11
revision=1
noextract=yes
wrksrc="krb5-${version}"
build_style=gnu-configure
configure_script="./src/configure"
configure_args="--disable-rpath --with-system-et
--with-system-ss --with-system-db --enable-shared CFLAGS=-I/usr/include/et"
depends="mit-krb5-client-${version}_${revision}"
makedepends="perl>=0 flex db-devel e2fsprogs-devel openssl-devel"
subpackages="${pkgname}-devel ${pkgname}-libs ${pkgname}-client"
conflicts="heimdal>=0"
short_desc="MIT Kerberos 5 implementation"
maintainer="Juan RP <xtraeme@gmail.com>"
license="MIT"
homepage="http://web.mit.edu/Kerberos"
distfiles="$homepage/dist/krb5/1.11/krb5-$version-signed.tar"
checksum=fe37fb93b398db98a1b23f814673ea2ae4b90138f85e1a4027ef639456a78651
long_desc="
 Kerberos is a network authentication protocol. It is designed to provide
 strong authentication for client/server applications by using secret-key
 cryptography. A free implementation of this protocol is available from the
 Massachusetts Institute of Technology. Kerberos is available in many
 commercial products as well."

pre_configure() {
	# We have to do this dance because the real distfile is
	# included in the .tar archive.
	tar xf $XBPS_SRCDISTDIR/$(basename $distfiles) -C $wrksrc
	tar xfz $wrksrc/krb5-$version.tar.gz -C $XBPS_BUILDDIR
	# Fix db plugin.
	sed -i -e "s|<db.h>|<db_185.h>|" $wrksrc/src/plugins/kdb/db2/*.[ch]
}
