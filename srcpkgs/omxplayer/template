# Template file for 'omxplayer'
pkgname=omxplayer
version=20130913
revision=1
short_desc="Commandline OMX player for the Raspberry Pi"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
homepage="https://github.com/huceke/omxplayer"

# XXX only rpi
only_for_archs="armv6l"
hostmakedepends="pkg-config"
makedepends="rpi-firmware>=20130913 pcre-devel boost-devel freetype-devel ffmpeg-devel dbus-devel"

do_fetch() {
	local url="git://github.com/popcornmix/omxplayer.git"
	git clone $url ${pkgname}-${version}
}

pre_build() {
	cp -f ${FILESDIR}/Makefile* .
	sed -e 's,/usr/share/fonts/truetype/freefont,/usr/share/fonts/TTF,g' -i omxplayer.cpp
}
	
do_build() {
	mkdir -p /opt/vc/lib
	sed -e "s|@CROSSBASE@|${XBPS_CROSS_BASE}|g" -i Makefile.include
	make CC="$CC" CXX="$CXX" LD="$LD"
}

do_install() {
	make DESTDIR=${DESTDIR} install
}

omxplayer_package() {
	depends="rpi-firmware>=20130913 freefont-ttf"
	pkg_install() {
		vmove all
	}
}
