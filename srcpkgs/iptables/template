# Template file for 'iptables'
pkgname=iptables
version=1.4.7
revision=2
distfiles="http://www.iptables.org/projects/iptables/files/$pkgname-$version.tar.bz2"
build_style=gnu_configure
configure_args="--enable-devel --enable-libipq --sbindir=/sbin
--with-kernel=/usr/src/kernel-headers-$(${XBPS_PKGDB_CMD} version kernel-headers)"
short_desc="Linux IPv[46] packet filtering ruleset"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=9f61f389cabdde79e26ca78c336db1b6373b67f80f7cfcb3e9d9ff520b325452
long_desc="
 iptables is the userspace command line program used to configure the Linux
 2.4.x and 2.6.x IPv4 packet filtering ruleset. It is targeted towards system
 administrators.

 Since Network Address Translation is also configured from the packet filter
 ruleset, iptables is used for this, too.

 The iptables package also includes ip6tables. ip6tables is used for
 configuring the IPv6 packet filter."

openrc_services="iptables default false"
conf_files="
/etc/conf.d/iptables
/etc/conf.d/ip6tables"

subpackages="$pkgname-devel"

Add_dependency run glibc
Add_dependency build kernel-headers

pre_configure()
{
	export PATH="/bin:/sbin:/usr/bin:/usr/sbin:$PATH"

	sed -i '87 i libxt_RATEEST.so: libxt_RATEEST.oo' \
		${wrksrc}/extensions/GNUmakefile.in
	sed -i '88 i \\t${AM_VERBOSE_CCLD} ${CCLD} ${AM_LDFLAGS} -lm -shared ${LDFLAGS} -o $@ $<;\n' \
		${wrksrc}/extensions/GNUmakefile.in
}

post_install()
{
	install -d ${DESTDIR}/etc/{conf.d,iptables}
	install -m644 ${FILESDIR}/iptables.confd ${DESTDIR}/etc/conf.d/iptables
	install -m644 ${FILESDIR}/ip6tables.confd \
		${DESTDIR}/etc/conf.d/ip6tables
	install -D -m755 ${FILESDIR}/iptables.rc \
		${DESTDIR}/etc/init.d/iptables
	install -m644 ${FILESDIR}/*.rules ${DESTDIR}/etc/iptables
	install -d ${DESTDIR}/var/lib/iptables
	touch -f ${DESTDIR}/var/lib/iptables/.empty_on_purpose
}
