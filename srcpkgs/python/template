# Template build file for 'python'.
pkgname=python
version=2.7.3
wrksrc="Python-$version"
distfiles="http://www.python.org/ftp/python/$version/Python-$version.tar.xz"
makedepends="libffi-devel zlib-devel readline-devel gdbm-devel openssl-devel expat-devel db-devel ncurses-devel sqlite-devel"
short_desc="Interpreted, interactive, object-oriented programming language"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.python.org"
license="PSF"
checksum=61d36be58e9e9c733c49d7b76858d5c08e2c63a84f2066b29d35d3521057c985
long_desc="
 Python is an interpreted, interactive, object-oriented programming language
 that combines remarkable power with very clear syntax. For an introduction
 to programming in Python you are referred to the Python Tutorial. The Python
 Library Reference documents built-in and standard types, constants, functions
 and modules. Finally, the Python Reference Manual describes the syntax and
 and semantics of the core language in (perhaps too) much detail.

 Python's basic power can be extended with your own modules written in C or
 C++. On most systems such modules may be dynamically loaded. Python is also
 adaptable as an extension language for existing applications."

pycompile_dirs="usr/lib/python2.7"
subpackages="$pkgname-devel"


do_configure() {
	# Enable built-in SQLite3 module to load extensions (Arch fix FS#22122)
	sed -i "/SQLITE_OMIT_LOAD_EXTENSION/d" setup.py

	export OPT="${XBPS_CFLAGS}"
	./configure ${CONFIGURE_SHARED_ARGS} --with-threads \
		--enable-ipv6 --with-signal-module --enable-shared \
		--with-system-ffi --enable-unicode=ucs4 --with-system-expat \
		--with-wctype-functions
}

do_build() {
	make ${makejobs}
}

do_install() {
	make DESTDIR=${DESTDIR} install

	chmod 755 ${DESTDIR}/usr/lib/libpython*.so*
	install -Dm644 LICENSE ${DESTDIR}/usr/share/licenses/python/LICENSE
}
