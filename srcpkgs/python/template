# Template build file for 'python'.
pkgname=python
version=2.7.2
revision=2
patch_args="-Np1"
wrksrc="Python-$version"
distfiles="http://www.python.org/ftp/python/$version/Python-$version.tar.bz2"
build_style=custom-install
short_desc="Interpreted, interactive, object-oriented programming language"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.python.org"
license="PSF"
checksum=5057eb067eb5b5a6040dbd0e889e06550bde9ec041dadaa855ee9490034cbdab
long_desc="
 Python is an interpreted, interactive, object-oriented programming language
 that combines remarkable power with very clear syntax. For an introduction
 to programming in Python you are referred to the Python Tutorial. The Python
 Library Reference documents built-in and standard types, constants, functions
 and modules. Finally, the Python Reference Manual describes the syntax and
 and semantics of the core language in (perhaps too) much detail.

 Python's basic power can be extended with your own modules written in C or
 C++. On most systems such modules may be dynamically loaded. Python is also
 adaptable as an extension language for existing applications."

stow_copy=yes
subpackages="$pkgname-devel"

Add_dependency run glibc
Add_dependency run libffi
Add_dependency run zlib
Add_dependency run readline
Add_dependency run bzip2
Add_dependency run gdbm
Add_dependency run libssl
Add_dependency run expat
Add_dependency run libdb
Add_dependency run ncurses-libs
Add_dependency run sqlite

Add_dependency build libffi-devel
Add_dependency build zlib-devel
Add_dependency build readline-devel
Add_dependency build bzip2-devel
Add_dependency build gdbm-devel
Add_dependency build openssl-devel
Add_dependency build expat-devel
Add_dependency build db-devel
Add_dependency build ncurses-devel
Add_dependency build sqlite-devel

do_configure()
{
	# Enable built-in SQLite3 module to load extensions (Arch fix FS#22122)
	sed -i "/SQLITE_OMIT_LOAD_EXTENSION/d" setup.py

	export OPT="${XBPS_CFLAGS}"
	./configure ${CONFIGURE_SHARED_ARGS} --with-threads \
		--enable-ipv6 --with-signal-module --enable-shared \
		--with-system-ffi --enable-unicode=ucs4 --with-system-expat \
		--with-wctype-functions
}

do_build()
{
	make ${makejobs}
}

do_install()
{
	make DESTDIR=${DESTDIR} install

	chmod 755 ${DESTDIR}/usr/lib/libpython*.so*
	install -Dm644 LICENSE ${DESTDIR}/usr/share/licenses/python/LICENSE
}
