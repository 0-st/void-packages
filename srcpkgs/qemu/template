# Template file for 'qemu'
pkgname=qemu
version=1.1.1
revision=1
nostrip=yes
noextract=yes
build_style=configure
configure_args="--prefix=/usr --sysconfdir=/etc --enable-spice
--enable-kvm --audio-drv-list=alsa,sdl,pa --disable-xen
--enable-vhost-net --enable-vnc-thread --enable-vnc-png
--enable-vnc-tls --enable-virtfs --disable-fdt"
makedepends="perl python attr-devel libpng-devel>=1.5.10 jpeg-devel ncurses-devel
libuuid-devel libX11-devel alsa-lib-devel gnutls-devel SDL-devel libbluetooth-devel
libsasl-devel spice-devel glib-devel MesaLib-devel pulseaudio-devel nss-devel
libcurl-devel xfsprogs-devel libcap-ng-devel libcap-devel"
conf_files="/etc/qemu/target-${XBPS_MACHINE}.conf"
short_desc="Open Source Processor Emulator"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://qemu.org"
license="GPL-2, LGPL-2.1"
distfiles="http://wiki.qemu.org/download/qemu-${version}.tar.bz2"
checksum=004a3032b504e70174c504d6c156b1ec3445abd9913602af0d7a5ac0703ddf5c
long_desc="
 QEMU is a generic and open source machine emulator and virtualizer.

 When used as a machine emulator, QEMU can run OSes and programs made for
 one machine (e.g. an ARM board) on a different machine (e.g. your own PC).
 By using dynamic translation, it achieves very good performances."

do_extract() {
	# XXX distfile is not bzip2 compressed! it's in gzip format.
	tar xfz $XBPS_SRCDISTDIR/qemu-${version}.tar.bz2 -C $XBPS_BUILDDIR
}

pre_configure() {
	sed -i -e 's/lib64/lib/g' x86_64.ld
}

post_install() {
	vinstall ${FILESDIR}/65-kvm.rules 644 usr/lib/udev/rules.d
}
