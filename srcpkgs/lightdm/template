# Template file for 'lightdm'
pkgname=lightdm
version=1.2.2
homepage="https://launchpad.net/lightdm"
distfiles="https://launchpad.net/lightdm/1.2/$version/+download/$pkgname-$version.tar.gz"
build_style=gnu-configure
configure_args="--with-greeter-user=lightdm"
short_desc="Light Display Manager"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3, LGPL-3"
checksum=772cc6a4e7da670352f6a38c05470b8fcfe50a2c1d3d424be1c9309afb0c541b
long_desc="
 An X display manager that:
  * Has a lightweight codebase
  * Is standards compliant (PAM, ConsoleKit, etc)
  * Has a well defined interface between the server and user interface
  * Fully themeable (easiest with the webkit interface)
  * Cross-desktop (greeters can be written in any toolkit)"

conf_files="
/etc/lightdm/keys.conf
/etc/lightdm/lightdm.conf
/etc/lightdm/users.conf"

provides="display-manager-1"
replaces="display-manager>=0"
system_accounts="lightdm"
lightdm_homedir="/var/cache/lightdm"
systemd_services="lightdm.service off"
make_dirs="/var/cache/lightdm 0755 lightdm lightdm"

subpackages="liblightdm-gobject liblightdm-qt lightdm-devel"

Add_dependency build pkg-config
Add_dependency build intltool
Add_dependency build dbus-glib-devel
Add_dependency build libxklavier-devel
Add_dependency build libxml2-devel
Add_dependency build qt-devel
Add_dependency build gtk+3-devel
Add_dependency build libxcb-devel
Add_dependency build libXdmcp-devel
Add_dependency build pam-devel
Add_dependency build vala-devel
Add_dependency build gobject-introspection

Add_dependency full gnome-icon-theme
Add_dependency full dbus

post_install()
{
	local xs="/usr/share/lightdm/Xsession"

	# Remove provided init file and use our own.
	rm -rf ${DESTDIR}/etc/init
	vinstall ${FILESDIR}/lightdm.service 644 lib/systemd/system
	vinstall ${FILESDIR}/lightdm.pam 644 etc/pam.d lightdm
	vinstall ${FILESDIR}/Xsession 755 usr/share/lightdm
	vmkdir var/cache/lightdm

	# Minimum UID shall be 1000 for ordinary users.
	sed -i -e "s|^\(minimum-uid=\).*|\11000|" \
		${DESTDIR}/etc/lightdm/users.conf
	# Provide a working session wrapper.
	sed -i -e "s|^\#\(session-wrapper=\).*|\1${xs}|" \
		${DESTDIR}/etc/lightdm/lightdm.conf
}
