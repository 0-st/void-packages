# Template file for 'lightdm'
pkgname=lightdm
version=0.2.3
revision=2
distfiles="http://launchpad.net/lightdm/trunk/$version/+download/lightdm-$version.tar.gz"
build_style=gnu_configure
configure_args="--localstatedir=/var --with-greeter-user=lightdm"
short_desc="Light Display Manager"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=5b925a6eeb0b670b1e9f5a1b2f5dae29eceb1c1ceb17db5bd33aea4354bfe432
long_desc="
 An X display manager that:
  * Has a lightweight codebase
  * Is standards compliant (PAM, ConsoleKit, etc)
  * Has a well defined interface between the server and user interface
  * Fully themeable (easiest with the webkit interface)
  * Cross-desktop (greeters can be written in any toolkit)"

system_accounts="lightdm"
lightdm_homedir="/var/cache/lightdm"
openrc_services="lightdm default true"
keep_empty_dirs=yes

subpackages="gir-lightdm liblightdm-gobject liblightdm-qt"
subpackages="${subpackages} lightdm-webkit lightdm-devel"

Add_dependency run glibc
Add_dependency run glib
Add_dependency run dbus-libs
Add_dependency run dbus-glib
Add_dependency run cairo
Add_dependency run libXdmcp
Add_dependency run libxcb
Add_dependency run pam
Add_dependency run gdk-pixbuf
Add_dependency run gtk+
Add_dependency run liblightdm-gobject

Add_dependency build pkg-config
Add_dependency build intltool
Add_dependency build glib-devel
Add_dependency build dbus-glib-devel
Add_dependency build dbus-devel
Add_dependency build glibc-devel
Add_dependency build libxklavier-devel
Add_dependency build libxml2-devel
Add_dependency build libX11-devel
Add_dependency build qt-devel
Add_dependency build libstdc++-devel
Add_dependency build gtk+-devel
Add_dependency build gdk-pixbuf-devel
Add_dependency build cairo-devel
Add_dependency build webkit-gtk-devel
Add_dependency build libxcb-devel
Add_dependency build libXdmcp-devel
Add_dependency build pam-devel
Add_dependency build vala-devel

Add_dependency full gnome-icon-theme
Add_dependency full dbus

post_install()
{
	local xs="/usr/share/lightdm/Xsession"

	# Remove provided init file use our own.
	rm -rf ${DESTDIR}/etc/init
	install -D -m755 ${FILESDIR}/lightdm.rc ${DESTDIR}/etc/init.d/lightdm
	install -D -m644 ${FILESDIR}/lightdm.pam ${DESTDIR}/etc/pam.d/lightdm
	install -D -m755 ${FILESDIR}/Xsession ${DESTDIR}/${xs}

	# Minimum UID shall be 1000 for ordinary users.
	sed -i -e "s|^\#\(minimum-uid=\).*|\11000|" ${DESTDIR}/etc/lightdm.conf
	# Provide a working session wrapper.
	sed -i -e "s|^\#\(session-wrapper=\).*|\1${xs}|" \
		${DESTDIR}/etc/lightdm.conf
	install -d ${DESTDIR}/var/cache/lightdm
}
