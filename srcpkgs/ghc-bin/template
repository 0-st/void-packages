# Template file for 'ghc-bin'
pkgname=ghc-bin
version=7.8.2
revision=1
depends="perl gcc"
short_desc="Glorious Haskell Compiler - precompiled binaries"
maintainer="Christian Neukirchen <chneukirchen@gmail.com>"
license="custom"
homepage="http://www.haskell.org/ghc/"
only_for_archs="i686 x86_64"
case "$XBPS_TARGET_MACHINE" in
    x86_64*)
	distfiles="http://code.haskell.org/~slyfox/ghc-amd64/$pkgname-$version-amd64.tbz2"
	skip_extraction="$pkgname-$version-amd64.tbz2"
	checksum=7e84c220275afff6b1c16f1e76453728c64e30d88b77fb41897c975ede7825ab
	;;
    i686*)
	distfiles="http://code.haskell.org/~slyfox/ghc-x86/$pkgname-$version-x86.tbz2"
        skip_extraction="$pkgname-$version-x86.tbz2"
        checksum=a19795b1bb5c91d6ccebbdf12f1eaa7647c24db16c4551340a5271072a51f683
	;;
esac
create_wrksrc=yes
nostrip=1

do_install() {
  vmkdir ${DESTDIR}
  tar xjpvf ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${skip_extraction} -C ${DESTDIR}
  if [ -d ${DESTDIR}/usr/lib32 ]; then
    mv ${DESTDIR}/usr/lib32 ${DESTDIR}/usr/lib
  fi
  if [ -d ${DESTDIR}/usr/lib64 ]; then
    mv ${DESTDIR}/usr/lib64 ${DESTDIR}/usr/lib
  fi
  sed -i 's#x86_64-pc-linux-gnu-##g' ${DESTDIR}/usr/lib/ghc-${version}/settings
  sed -i 's#i686-pc-linux-gnu-##g' ${DESTDIR}/usr/lib/ghc-${version}/settings
  vlicense ${DESTDIR}/usr/share/doc/ghc-${version}/html/libraries/ghc-${version}/LICENSE
}
