# Template file for 'webkit-gtk3'
pkgname=webkit-gtk3
version=1.10.2
revision=3
wrksrc="webkitgtk-${version}"
makedepends="perl pkg-config intltool which gperf bison25 flex
 libjpeg-turbo-devel libpng-devel>=1.5.10 sqlite-devel gtk+-devel gtk+3-devel
 libXt-devel gst-plugins-base-devel libsoup-devel libxslt-devel icu-devel>=49
 enchant-devel dbus-glib-devel geoclue-devel gobject-introspection ruby"
short_desc="GTK+3 port of the WebKit browser engine"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://webkitgtk.org/"
license="LGPL-2.1, Simplified BSD (2 clause)"
distfiles="${homepage}/releases/webkitgtk-${version}.tar.xz"
checksum=19234f8e4edfaefe91ed06471a2aa8c71d26dd55d33787eede1dcfc9a3a96d9c

# Disable dbg pkgs; too huge for little gain.
disable_debug=yes

do_configure() {
	local args="--enable-jit --with-font-backend=freetype \
		--enable-introspection --disable-webkit2 \
		--with-unicode-backend=icu --disable-schemas-compile \
		${CONFIGURE_SHARED_ARGS} --disable-silent-rules"

	for ver in 2 3; do
		[ ! -d ${wrksrc}/build-gtk${ver} ] && \
			mkdir ${wrksrc}/build-gtk${ver}
		cd ${wrksrc}/build-gtk${ver}
		../configure ${args} --with-gtk=${ver}.0
	done
}

do_build() {
	for ver in 2 3; do
		msg_normal "Building GTK+${ver} version...\n"
		cd ${wrksrc}/build-gtk${ver}
		make ${makejobs}
	done
}

do_install() {
	for ver in 2 3; do
		msg_normal "Installing GTK+${ver} version...\n"
		cd ${wrksrc}/build-gtk${ver}
		make DESTDIR=${DESTDIR} install
	done
}

webkit-gtk_package() {
	short_desc="GTK+ port of the WebKit browser engine"
	pkg_install() {
		vmove usr/bin/jsc-1
		vmove "usr/lib/libwebkitgtk-1.0.so*"
		vmove "usr/lib/libjavascriptcoregtk-1.0.so*"
		vmove "usr/lib/girepository-1.0/*-1.0.typelib"
		for f in $(echo ${DESTDIR}/usr/share/locale/*); do
			vmove usr/share/locale/$(basename $f)/LC_MESSAGES/webkitgtk-2.0.mo
		done
		vmove usr/share/webkitgtk-1.0
	}
}

webkit-gtk-devel_package() {
	depends="libglib-devel gtk+-devel libsoup-devel webkit-gtk-${version}_${revision}"
	short_desc="GTK+ port of the WebKit browser engine - development files"
	pkg_install() {
		vmove usr/include/webkitgtk-1.0
		vmove "usr/lib/pkgconfig/*-1.0.pc"
		vmove "usr/share/gir-1.0/*-1.0.gir"
	}
}

webkit-gtk3-devel_package() {
	depends="libglib-devel gtk+3-devel>=3.6.0_2 libsoup-devel webkit-gtk3-${version}_${revision}"
	short_desc+=" -- development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/share/gir*"
	}
}

webkit-gtk3_package() {
	pkg_install() {
		vmove usr
	}
}
