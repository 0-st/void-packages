# Template file for 'chromium-widevine'
pkgname=chromium-widevine
version=1.0.0.0
revision=1
_chromeVersion=46.0.2490.71-1
_channel='stable'
_baseUrl='http://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-stable'
revision=1
short_desc="A browser plugin designed for the viewing of premium video content"
maintainer="Benjamin Hoffmeyer <hoffmeyer25@gmail.com>"
homepage="http://www.google.com/chrome"
license="chrome"
lib32disabled=yes
repository=nonfree
only_for_archs="i686 x86_64"
depends="chromium binutils xz"
create_wrksrc=yes

case "${XBPS_TARGET_MACHINE}" in
x86_64)
	_filename=google-chrome-${_channel}_${_chromeVersion}_amd64.deb
	_chromeChecksum="d70e55812164bf4f35f629af302ee53fc771ee4e00ffd26205e6541f3b6c8a96"
	;;
i686)
	_filename=google-chrome-${_channel}_${_chromeVersion}_i386.deb
	_chromeChecksum="4e931cedefb37ce905c51075c4a328202bfc97ec06eae37ff3b3fe26c6632aec"
	;;
esac
_chromeUrl="${_baseUrl}/${_filename}"
distfiles="${_chromeUrl}"
checksum="$_chromeChecksum"

skip_extraction="$_filename"

do_fetch() {
	mkdir -p $wrksrc
	cd $wrksrc
	xbps-uhelper fetch $distfiles
	echo "$checksum  $_filename" | sha256sum -c || { sha256sum "$_filename"; return 1; }
}
do_extract() {
	:
}
do_build() {
	sed \
		-e "s|%CHROME_URL%|${_chromeUrl}|" \
		-e "s|%CHROME_CHECKSUM%|${_chromeChecksum}|" \
			${FILESDIR}/chromium-widevine-vars.sh.in > chromium-widevine-vars.sh
}

do_install() {
	vlicense ${FILESDIR}/LICENSE
}
