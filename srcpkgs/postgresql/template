# Template file for 'postgresql'
pkgname=postgresql
version=8.4.10
distfiles="ftp://ftp.postgresql.org/pub/source/v${version}/${pkgname}-${version}.tar.bz2"
build_style=gnu-configure
configure_args="--with-docdir=/usr/share/doc --with-openssl --with-python
--with-pam --datadir=/usr/share/postgresql --enable-thread-safety
--with-perl --with-tcl --without-ldap --without-gssapi --without-krb5
--without-bonjour --with-libxml --with-libxslt --disable-rpath
--with-system-tzdata=/usr/share/zoneinfo --enable-nls"
short_desc="Sophisticated open-source Object-Relational DBMS"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.postgresql.org"
license="BSD"
checksum=749f83e9d467b07dcd012fdf2b1615c577b410fd219b44a27bb7097bb1b07cfb
long_desc="
 PostgreSQL is a powerful, open source object-relational database system.
 It has more than 15 years of active development and a proven architecture
 that has earned it a strong reputation for reliability, data integrity,
 and correctness."

stow_copy=yes
subpackages="${pkgname}-doc ${pkgname}-libs ${pkgname}-libs-devel"
subpackages="${subpackages} ${pkgname}-plperl ${pkgname}-plpython"
subpackages="${subpackages} ${pkgname}-pltcl ${pkgname}-client"

conf_files="
/etc/default/${pkgname}
/etc/pam.d/${pkgname}
/etc/${pkgname}/${pkgname}.conf"

systemd_services="${pkgname}.service on"

# Create 'postgres' user for the server.
system_accounts="postgres"
postgres_homedir="/var/lib/${pkgname}"
postgres_shell="/bin/sh"
postgres_descr="PostgreSQL database server user"

Add_dependency build flex
Add_dependency build gettext
Add_dependency build readline-devel
Add_dependency build openssl-devel
Add_dependency build perl
Add_dependency build tcl-devel
Add_dependency build python-devel
Add_dependency build libxml2-devel
Add_dependency build libxslt-devel
Add_dependency build pam-devel

post_install() {
	vinstall ${FILESDIR}/${pkgname}.confd 644 etc/default ${pkgname}
	vinstall ${FILESDIR}/${pkgname}.service 644 lib/systemd/system
	vinstall ${FILESDIR}/${pkgname}-initdb 755 lib/systemd/scripts
	vinstall ${FILESDIR}/${pkgname}.pam 644 etc/pam.d ${pkgname}
	vinstall ${DESTDIR}/usr/share/${pkgname}/${pkgname}.conf.sample \
		644 etc/${pkgname} ${pkgname}.conf
}
