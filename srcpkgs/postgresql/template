# Template file for 'postgresql'
pkgname=postgresql
version=8.4.15
revision=1
build_style=gnu-configure
configure_args="--with-docdir=/usr/share/doc --with-openssl --with-python
 --with-pam --datadir=/usr/share/postgresql --enable-thread-safety
 --with-perl --with-tcl --without-ldap --without-gssapi --without-krb5
 --without-bonjour --with-libxml --with-libxslt --disable-rpath
 --with-system-tzdata=/usr/share/zoneinfo --enable-nls"
short_desc="Sophisticated open-source Object-Relational DBMS"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.postgresql.org"
license="BSD"
distfiles="ftp://ftp.postgresql.org/pub/source/v${version}/${pkgname}-${version}.tar.bz2"
checksum=6a83771bbbdf1ad9c1dd900da3fbfdf6ef75857db8e012f7129a1f865279bc4d
long_desc="
 PostgreSQL is a powerful, open source object-relational database system.
 It has more than 15 years of active development and a proven architecture
 that has earned it a strong reputation for reliability, data integrity,
 and correctness."

makedepends="flex readline-devel openssl-devel perl>=5.16
 tcl-devel python-devel libxml2-devel libxslt-devel pam-devel"

subpackages="${pkgname}-doc ${pkgname}-libs ${pkgname}-libs-devel
 ${pkgname}-plperl ${pkgname}-plpython ${pkgname}-pltcl ${pkgname}-client"

conf_files="
/etc/default/${pkgname}
/etc/pam.d/${pkgname}
/etc/${pkgname}/${pkgname}.conf"

systemd_services="${pkgname}.service on"

# Create 'postgres' user for the server.
system_accounts="postgres"
postgres_homedir="/var/lib/${pkgname}"
postgres_shell="/bin/sh"
postgres_descr="PostgreSQL database server user"

post_install() {
	vinstall ${FILESDIR}/${pkgname}.confd 644 etc/default ${pkgname}
	vinstall ${FILESDIR}/${pkgname}.service 644 usr/lib/systemd/system
	vinstall ${FILESDIR}/${pkgname}-initdb 755 usr/lib/systemd/scripts
	vinstall ${FILESDIR}/${pkgname}.pam 644 etc/pam.d ${pkgname}
	vinstall ${DESTDIR}/usr/share/${pkgname}/${pkgname}.conf.sample \
		644 etc/${pkgname} ${pkgname}.conf
}
