# Template file for 'postgresql'
pkgname=postgresql
version=8.4.6
distfiles="ftp://ftp.postgresql.org/pub/source/v${version}/${pkgname}-${version}.tar.bz2"
build_style=gnu_configure
configure_args="--with-docdir=/usr/share/doc --with-openssl --with-python
--with-pam --datadir=/usr/share/postgresql --enable-thread-safety
--with-perl --with-tcl --without-ldap --without-gssapi --without-krb5
--without-bonjour --with-libxml --with-libxslt --disable-rpath
--with-system-tzdata=/usr/share/zoneinfo --enable-nls --with-gnu-ld"
short_desc="Sophisticated open-source Object-Relational DBMS"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=8110c576e9055286d7b04b8930f7a378e483f0530b41dd3098f6e35528ed7d3c
long_desc="
 PostgreSQL is a powerful, open source object-relational database system.
 It has more than 15 years of active development and a proven architecture
 that has earned it a strong reputation for reliability, data integrity,
 and correctness."

stow_copy=yes
subpackages="${pkgname}-doc ${pkgname}-libs ${pkgname}-libs-devel"
subpackages="${subpackages} ${pkgname}-plperl ${pkgname}-plpython"
subpackages="${subpackages} ${pkgname}-pltcl ${pkgname}-client"

conf_files="/etc/conf.d/postgresql"

# Create 'postgres' user for the server.
system_accounts="postgres"
postgres_homedir="/var/lib/postgresql"
postgres_shell="/bin/sh"
postgres_descr="PostgreSQL database server user"

# Add the OpenRC service.
openrc_services="postgresql default false"

Add_dependency run glibc
Add_dependency run pam
Add_dependency run libssl
Add_dependency run libxml2
Add_dependency run postgresql-libs

Add_dependency build flex
Add_dependency build gettext
Add_dependency build perl
Add_dependency build tcl-devel
Add_dependency build python-devel
Add_dependency build openssl-devel
Add_dependency build zlib-devel
Add_dependency build libxml2-devel
Add_dependency build pam-devel
Add_dependency build readline-devel

post_install()
{
	install -D -m644 ${FILESDIR}/postgresql.confd \
		${DESTDIR}/etc/conf.d/postgresql
	install -D -m755 ${FILESDIR}/postgresql.rc \
		${DESTDIR}/etc/init.d/postgresql
	install -D -m644 ${FILESDIR}/postgresql.pam \
		${DESTDIR}/etc/pam.d/postgresql
}
