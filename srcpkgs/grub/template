# Template file for 'grub'
pkgname=grub
version="2.00~beta4"
homepage="http://www.gnu.org/software/grub/"
distfiles="http://alpha.gnu.org/gnu/grub/grub-$version.tar.xz"
build_style=gnu-configure
configure_args="--disable-werror"
short_desc="GRand Unified Bootloader 2"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3"
checksum=628a17fefafcbd90cdab25220ef3ae717558dde73e55adf83dfee3aae55e390e
long_desc="
 This is GRUB 2, the second version of the GRand Unified Bootloader.
 GRUB 2 is rewritten from scratch to make GNU GRUB cleaner, safer, more
 robust, more powerful, and more portable."

conf_files="/etc/default/grub /etc/grub.d/40_custom"

Add_dependency build xz
Add_dependency build flex
Add_dependency build zlib-devel
Add_dependency build libusb-compat-devel
Add_dependency build ncurses-devel
Add_dependency build freetype-devel
Add_dependency build liblzma-devel
Add_dependency build device-mapper-devel
Add_dependency build font-unifont-bdf
Add_dependency build fuse-devel
Add_dependency full os-prober

pre_configure() {
	# fix unifont.bdf location so grub-mkfont can create *.pf2 files
	sed -i 's|/usr/share/fonts/unifont|/usr/share/fonts/misc|' configure
}

post_install() {
	# Required to compress info files.
	vmkdir usr/share/info
	touch -f ${DESTDIR}/usr/share/info/dir

	vinstall ${FILESDIR}/grub.default 644 etc/default grub
	# Kernel hooks.
	vinstall ${FILESDIR}/kernel.d/grub.post 750 \
		etc/kernel.d/post-install 50-grub
	vinstall ${FILESDIR}/kernel.d/grub.post 750 \
		etc/kernel.d/post-remove 50-grub
}
