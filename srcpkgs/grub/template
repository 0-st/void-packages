# Template file for 'grub'
pkgname=grub
version="2.00~rc1"
revision=1
build_style=gnu-configure
configure_args="--disable-werror"
makedepends="flex libusb-compat-devel ncurses-devel freetype-devel liblzma-devel device-mapper-devel font-unifont-bdf fuse-devel"
fulldepends="os-prober"
short_desc="GRand Unified Bootloader 2"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-3"
homepage="http://www.gnu.org/software/grub/"
distfiles="http://alpha.gnu.org/gnu/grub/grub-$version.tar.xz"
checksum=b203d04589bfb743d2844a695c2ae8ea11a3ee034c346a989f4474addb4ed032
long_desc="
 This is GRUB 2, the second version of the GRand Unified Bootloader.
 GRUB 2 is rewritten from scratch to make GNU GRUB cleaner, safer, more
 robust, more powerful, and more portable."

conf_files="/etc/default/grub /etc/grub.d/40_custom"

pre_configure() {
	# fix unifont.bdf location so grub-mkfont can create *.pf2 files
	sed -i 's|/usr/share/fonts/unifont|/usr/share/fonts/misc|' configure
}

post_install() {
	# Required to compress info files.
	vmkdir usr/share/info
	touch -f ${DESTDIR}/usr/share/info/dir

	vinstall ${FILESDIR}/grub.default 644 etc/default grub
	# Kernel hooks.
	vinstall ${FILESDIR}/kernel.d/grub.post 750 \
		etc/kernel.d/post-install 50-grub
	vinstall ${FILESDIR}/kernel.d/grub.post 750 \
		etc/kernel.d/post-remove 50-grub
}
