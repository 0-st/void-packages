# Template file for 'dcron'
pkgname=dcron
version=4.5
revision=16
distfiles="http://www.jimpryor.net/linux/releases/dcron-${version}.tar.gz"
short_desc="Dillon's lightweight cron daemon"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=9e50edb6f5bd8153b16bad05087d985e5153ce45cc01ae77e7f842213fb4a824
long_desc="
 This lightweight cron daemon aims to be simple and secure, with just enough
 features to stay useful. It was written from scratch by Matt Dillon in 1994.
 It's now developed and maintained by Jim Pryor.

 In the author's opinion, having to combine a cron daemon with another daemon
 like anacron makes for too much complexity. So the goal is a simple cron daemon
 that can also take over the central functions of anacron."

replaces="cronie>=0"
systemd_services="dcron.service on"
conf_files="/var/spool/cron/root"
provides="cron-daemon-0"
replaces="cron-daemon>=0"

# Build PIE binaries by default.
CFLAGS="-fPIE"
LDFLAGS="-pie"

do_build() {
	make PREFIX=/usr CRONTAB_GROUP=users CRONTABS=/var/spool/cron \
		CRONSTAMPS=/var/spool/cronstamps ${makejobs}
}

do_install() {
	make DESTDIR=${DESTDIR} install

	for f in etc/cron.d etc/cron.hourly etc/cron.weekly etc/cron.monthly \
		var/spool/cronstamps; do
		vmkdir ${f}
		touch ${DESTDIR}/${f}/.owned
	done

	install -Dm755 extra/run-cron ${DESTDIR}/usr/sbin/run-cron
	install -Dm600 extra/root.crontab ${DESTDIR}/var/spool/cron/root
	install -Dm644 extra/crond.logrotate ${DESTDIR}/etc/logrotate.d/crond

	vinstall ${FILESDIR}/dcron.service 644 usr/lib/systemd/system
	# crontab must be setuid for all users to work!
	chmod 4755 ${DESTDIR}/usr/bin/crontab
}
