# Template file for 'apache-mpm-event'
#
# We inherit all stuff from the apache build template.
. ${XBPS_SRCPKGDIR}/apache/template

# Unset unused stuff.
unset subpackages conf_files system_accounts openrc_services
unset post_install pre_configure build_depends run_depends

# Override some vars.
pkgname=apache-mpm-event
configure_args="${configure_args} --enable-modules=
--prefix=/usr --with-mpm=event"
short_desc="Apache HTTP Server - event driven model"
long_desc="
 Each Apache Multi-Processing Module provides a different \"flavor\" of web
 server binary, compiled with a different processing model.

 The event MPM is designed to allow more requests to be served simultaneously
 by passing off some processing work to supporting threads, freeing up the
 main threads to work on new requests. It is especially suitable for sites
 that see extensive KeepAlive traffic.

 This MPM is experimental and less tested than the worker and prefork MPMs."

Add_dependency run glibc
Add_dependency run libuuid
Add_dependency run pcre
Add_dependency run expat
Add_dependency run db
Add_dependency run gdbm
Add_dependency run apr
Add_dependency run apr-util
Add_dependency full apache	">=${version}"

pre_configure()
{
	cat ${XBPS_SRCPKGDIR}/apache/files/xbps.layout \
		>> ${wrksrc}/config.layout
}

post_install()
{
	# We are only interested in the httpd binary.
	cp -f ${DESTDIR}/usr/sbin/httpd ${wrksrc}
	rm -rf ${DESTDIR}/*
	install -D -m755 ${wrksrc}/httpd ${DESTDIR}/usr/sbin/httpd.event
}
