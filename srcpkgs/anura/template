# Template file for 'anura'
pkgname=anura
version=0.0.20151103
revision=1
_gitrev=074ec21eab10c3425f6713f286eb39f49686572a
wrksrc=${pkgname}-${_gitrev}
build_style=gnu-makefile
make_build_args="USE_DB_CLIENT=no"
hostmakedepends="pkg-config"
makedepends="boost-devel glew-devel cairo-devel lua52-devel
 SDL2_image-devel SDL2_mixer-devel SDL2_ttf-devel libvpx-devel"
depends="anura-data"
short_desc="Fully featured game engine for Frogatto & Friends"
maintainer="Jürgen Buchmüller <pullmoll@t-online.de>"
license="BSD, MIT"
homepage="https://github.com/anura-engine/anura"
distfiles="https://github.com/anura-engine/anura/archive/074ec21eab10c3425f6713f286eb39f49686572a.tar.gz>${pkgname}-${version}.tar.gz"
checksum=f12a065fb951f0d047dd56510f6202437ef90d70f7914dca348835b4260e9c3e

case "$XBPS_TARGET_MACHINE" in
	aarch64*|*-musl)
		# Don't treat warnings as errors
		CXXFLAGS="-Wno-error -Wno-sign-compare"
		make_build_args+=" SANITIZE_ADDRESS=no"
		make_build_args+=" SANITIZE_UNDEFINED=no"
		;;
	*)	makedepends+=" libsanitizer-devel"
		make_build_args+=" SANITIZE_ADDRESS=yes"
		make_build_args+=" SANITIZE_UNDEFINED=yes"
		;;
esac

pre_build() {
	# Use the system installed boost header files
	rm -fr external/include/boost
}

do_install() {
	vlicense LICENSE
	vinstall anura 755 usr/lib/anura
}

anura-data_package() {
	short_desc+=" - data files"
	noarch=yes
	pkg_install() {
		local f
		vmkdir usr/share/anura
		for f in data images music modules; do
			vcopy $f usr/share/anura
		done
	}
}
