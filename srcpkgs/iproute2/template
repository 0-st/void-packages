# Template file for 'iproute2'
pkgname=iproute2
version=3.7.0
revision=1
makedepends="pkg-config perl flex db-devel iptables-devel>=1.4.16.2"
crossmakedepends="libfl-devel db-devel iptables-devel>=1.4.16.2"
short_desc="IP Routing Utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.linux-foundation.org/en/Net:Iproute2"
license="GPL-2"
distfiles="${KERNEL_SITE}/utils/net/$pkgname/$pkgname-$version.tar.xz"
checksum=6b0e76d7adb8b9b65f70571f75d72db7c2548eff7813cace9e267065c3c0cb34

conf_files="
/etc/iproute2/ematch_map
/etc/iproute2/rt_dsfield
/etc/iproute2/rt_protos
/etc/iproute2/rt_realms
/etc/iproute2/rt_scopes
/etc/iproute2/rt_tables"

do_configure() {
	./configure
}

do_build() {
	if [ -n "$XBPS_CROSS_TRIPLET" ]; then
		make CC="$XBPS_CROSS_TRIPLET-gcc" \
			RANLIB="$XBPS_CROSS_TRIPLET-ranlib" \
			AR="$XBPS_CROSS_TRIPLET-ar" \
			LD="$XBPS_CROSS_TRIPLET-ld" \
			DBM_INCLUDE="/usr/$XBPS_CROSS_TRIPLET/include" \
			${makejobs}
	else
		make ${makejobs}
	fi
}

do_install() {
	make DESTDIR=${DESTDIR} install

	# Remove tex and sgml files.
	rm -f ${DESTDIR}/usr/share/doc/iproute2/*.{tex,sgml}
	# Remove devel manpages.
	rm -rf ${DESTDIR}/usr/share/man/man3
}
