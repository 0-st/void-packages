# Template build file for 'bzip2'.
pkgname=bzip2
version=1.0.6
revision=1
distfiles="http://www.bzip.org/$version/$pkgname-$version.tar.gz"
build_style=custom-install
short_desc="The bzip2 compression library"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=a2848f34fcd5d6cf47def00461fcb528a0484d8edef8208d6d2e2909dc61d9cd
long_desc="
 bzip2 is a freely available, patent free, high-quality data compressor.
 It typically compresses files to within 10%% to 15%% of the best available
 techniques, whilst being around twice as fast at compression and six times
 faster at decompression.

 bzip2 compresses files using the Burrows-Wheeler block-sorting text
 compression algorithm, and Huffman coding. Compression is generally
 considerably better than that achieved by more conventional LZ77/LZ78-based
 compressors, and approaches the performance of the PPM family of statistical
 compressors.

 The archive file format of bzip2 (.bz2) is incompatible with that of its
 predecessor, bzip (.bz)."

bootstrap=yes
subpackages="bzip2-devel"
Add_dependency run glibc

do_build()
{
	# Add large-file support
	sed -e 's/^CFLAGS=\(.*\)$/CFLAGS=\1 \$(BIGFILES)/' -i Makefile-libbz2_so

	# use our optimization
	sed -i "s|-O2|${CFLAGS}|g" Makefile
	sed -i "s|-O2|${CFLAGS}|g" Makefile-libbz2_so

	make ${makejobs} -f Makefile-libbz2_so
	make ${makejobs} bzip2recover libbz2.a
}

do_install()
{
	install -dm755 ${DESTDIR}/bin
	install -m755 bzip2-shared ${DESTDIR}/bin/bzip2
	install -m755 bzip2recover ${DESTDIR}/bin
	ln -sf bzip2 ${DESTDIR}/bin/bunzip2
	ln -sf bzip2 ${DESTDIR}/bin/bzcat

	install -dm755 ${DESTDIR}/usr/bin
	install -m755 bzdiff bzgrep bzmore ${DESTDIR}/usr/bin

	install -Dm755 libbz2.so.${version} ${DESTDIR}/lib/libbz2.so.${version}
	ln -s libbz2.so.${version} ${DESTDIR}/lib/libbz2.so
	ln -s libbz2.so.${version} ${DESTDIR}/lib/libbz2.so.1
	ln -s libbz2.so.${version} ${DESTDIR}/lib/libbz2.so.1.0

	install -Dm644 libbz2.a ${DESTDIR}/usr/lib/libbz2.a
	ln -sf ../../lib/libbz2.so ${DESTDIR}/usr/lib/libbz2.so

	install -Dm644 bzlib.h ${DESTDIR}/usr/include/bzlib.h

	install -Dm644 bzip2.1 ${DESTDIR}/usr/share/man/man1/bzip2.1
	ln -sf bzip2.1 ${DESTDIR}/usr/share/man/man1/bunzip2.1
	ln -sf bzip2.1 ${DESTDIR}/usr/share/man/man1/bzcat.1
	ln -sf bzip2.1 ${DESTDIR}/usr/share/man/man1/bzip2recover.1
}
