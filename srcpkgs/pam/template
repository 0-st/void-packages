# Template file for 'pam'
pkgname=pam
version=1.1.5
wrksrc="Linux-PAM-$version"
#distfiles="${KERNEL_SITE}/libs/pam/library/Linux-PAM-$version.tar.bz2"
distfiles="https://fedorahosted.org/releases/l/i/linux-pam/Linux-PAM-$version.tar.bz2"
revision=3
makedepends="flex cracklib-devel db-devel"
short_desc="A flexible mechanism for authenticating users"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.kernel.org/pub/linux/libs/pam/"
license="GPL-2"
checksum=65def4df04254dc4c5156859d36c34ad6d7afbcf3adbf2780530ebc4dbf2a116
long_desc="
 Linux-PAM provides a flexible mechanism for authenticating users.
 PAM was invented by SUN Microsystems."

conf_files="
/etc/environment
/etc/security/access.conf
/etc/security/group.conf
/etc/security/limits.conf
/etc/security/namespace.conf
/etc/security/pam_env.conf
/etc/security/time.conf"
subpackages="pam-devel pam-userdb"


do_configure() {
	./configure ${CONFIGURE_SHARED_ARGS} \
		--disable-selinux --libdir=/lib \
		--disable-rpath --docdir=/usr/share/doc/pam \
		--enable-read-both-confs DESTDIR=${DESTDIR}
}

do_build() {
	make ${makejobs}
}

do_install() {
	make DESTDIR=${DESTDIR} install

	rm -rf ${DESTDIR}/var
	# Fix unix_chkpwd perms.
	chmod 4755 ${DESTDIR}/sbin/unix_chkpwd
	#
	# Fix a syntax error in namespace.init, -p flag is unknown
	# at least to dash and bash.
	#
	sed -i -e "s|^#!/bin/sh -p$|#!/bin/sh|" \
		${DESTDIR}/etc/security/namespace.init
	chmod 755 ${DESTDIR}/etc/security/namespace.init
}
