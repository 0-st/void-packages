# Build template for 'kernel-uml'.
#
pkgname=kernel-uml
version=3.2.6
wrksrc=linux-${version}
homepage="http://www.kernel.org"
distfiles="http://www.kernel.org/pub/linux/kernel/v3.x/linux-${version}.tar.xz"
checksum=9db97d45638017e6dfaed768cfa9f47533c9c9fb3538bce0e594d9feff5489b4
makedepends="perl>=0 libpcap-devel"
fulldepends="uml-utilities"
revision=1
short_desc="Kernel ${version} for User Mode Linux"
long_desc="
 User-mode Linux (UML) is a port of the Linux kernel to its own system call
 interface. It provides a kind of virtual machine, which runs Linux as a user
 process under another Linux kernel. This is useful for kernel development,
 sandboxes, jails, experimentation, and many other things.

 This package contains the kernel itself, as an executable program, and the
 associated kernel modules."


do_build() {
	make LDFLAGS= ARCH=um defconfig && make LDFLAGS= ARCH=um ${makejobs}
}

do_install() {
	vinstall linux 755 usr/bin
	make ARCH=um INSTALL_MOD_PATH=${DESTDIR}/usr/lib/uml modules_install
	rm -f ${DESTDIR}/usr/lib/uml/lib/modules/${version}/{build,source}
	mv ${DESTDIR}/usr/lib/uml/lib/modules ${DESTDIR}/usr/lib/uml
	rmdir ${DESTDIR}/usr/lib/uml/lib
}
