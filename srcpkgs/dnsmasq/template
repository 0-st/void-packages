# Template file for 'dnsmasq'
pkgname=dnsmasq
version=2.58
revision=3
homepage="http://www.thekelleys.org.uk/dnsmasq/doc.html"
distfiles="http://www.thekelleys.org.uk/$pkgname/$pkgname-$version.tar.gz"
short_desc="Lightweight, easy to configure DNS forwarder and DHCP server"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
checksum=d5f64ed65f2b9a4db846d6da5d6903ec03e86924c09e232f42c7b63bcbfa3be6
long_desc="
 Dnsmasq is a lightweight, easy to configure DNS forwarder and DHCP server.
 It is designed to provide DNS and, optionally, DHCP, to a small network. It
 can serve the names of local machines which are not in the global DNS.
 The DHCP server integrates with the DNS server and allows machines with
 DHCP-allocated addresses to appear in the DNS with names configured either in
 each host or in a central configuration file. Dnsmasq supports static and
 dynamic DHCP leases and BOOTP/TFTP/PXE for network booting of diskless machines."

system_accounts="dnsmasq"
conf_files="/etc/dnsmasq.conf /etc/conf.d/dnsmasq"
systemd_services="dnsmasq.service on"

Add_dependency run libcap
Add_dependency run libidn
Add_dependency run dbus

Add_dependency build gettext
Add_dependency build dbus-devel
Add_dependency build libcap-devel
Add_dependency build libidn-devel

do_build()
{
	echo '#define HAVE_DBUS' >> src/config.h
	make ${makejobs}
}

do_install()
{
	make PREFIX=/usr DESTDIR=${DESTDIR} install

	vinstall dnsmasq.conf.example 644 etc dnsmasq.conf
	vinstall ${FILESDIR}/dnsmasq.service 644 lib/systemd/system
	vinstall dbus/dnsmasq.conf 644 etc/dbus-1/system.d
}
