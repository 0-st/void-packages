# Template file for 'systemd'
pkgname=systemd
version=192
revision=1
build_style=gnu-configure
configure_args="--with-distro=other --libexecdir=/usr/lib
--disable-selinux --disable-tcpwrap --with-rootprefix=/usr
--with-sysvinit-path= --with-sysvrcd-path= --disable-audit
--with-usb-ids-path=/usr/share/hwdata/usb.ids
--with-pci-ids-path=/usr/share/hwdata/pci.ids"
depends="dbus run-parts kbd>=1.15.3_5 systemd-libs>=${version}_${revision}
udev>=${version}_${revision}"
makedepends="pkg-config intltool gperf libxslt docbook-xsl acl-devel pam-devel
dbus-devel libcap-devel libkmod-devel liblzma-devel cryptsetup-devel
libblkid-devel glib-devel libgcrypt-devel python-devel gobject-introspection"
subpackages="udev libudev libudev-devel libgudev libgudev-devel
systemd-analyze systemd-devel systemd-libs systemd-python"
short_desc="A system and service manager for Linux"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.freedesktop.org/wiki/Software/systemd"
license="LGPL-2.1, GPL-2, MIT"
distfiles="http://www.freedesktop.org/software/$pkgname/$pkgname-$version.tar.xz"
checksum=55c449554ab68c7b237e86584a69b6e60538b4853ef7b6e5317d9d3e78f0c30f
long_desc="
 systemd is a system and service manager for Linux, compatible with SysV and LSB
 init scripts. systemd provides aggressive parallelization capabilities, uses 
 socket and D-Bus activation for starting services, offers on-demand starting of 
 daemons, keeps track of processes using Linux cgroups, supports snapshotting and 
 restoring of the system state, maintains mount and automount points and 
 implements an elaborate transactional dependency-based service control logic. 
 It can work as a drop-in replacement for sysvinit."

conf_files="
/etc/hostname
/etc/vconsole.conf
/etc/locale.conf
/etc/systemd/system.conf
/etc/systemd/user.conf
/etc/systemd/journald.conf
/etc/systemd/logind.conf"

system_groups="adm"

# Required empty dirs to be created.
make_dirs="
/etc/binfmt.d 0755 root root
/etc/sysctl.d 0755 root root
/etc/modules-load.d 0755 root root
/etc/tmpfiles.d 0755 root root
/etc/local.d 0755 root root
/etc/systemd/ntp-units.d 0755 root root
/etc/systemd/user 0755 root root
/etc/systemd/system/local-fs.target.wants 0755 root root
/etc/systemd/system/sysinit.target.wants 0755 root root
/usr/lib/systemd/system-shutdown 0755 root root
/usr/lib/systemd/system-sleep 0755 root root
/usr/lib/systemd/system/graphical.target.wants 0755 root root
/usr/lib/systemd/user-generators 0755 root root
/usr/lib/systemd/ntp-units.d 0755 root root
/usr/lib/binfmt.d 0755 root root
/usr/lib/sysctl.d 0755 root root
/usr/lib/modules-load.d 0755 root root
/var/lib/systemd 0755 root root
/var/log/journal 0755 root adm"

post_install() {
	vinstall ${FILESDIR}/hostname 644 etc
	vinstall ${FILESDIR}/vconsole.conf 644 etc
	vinstall ${FILESDIR}/os-release 644 etc
	vinstall ${FILESDIR}/locale.conf 644 etc

	printf "d /run/console 755 root root\n" > \
		${DESTDIR}/usr/lib/tmpfiles.d/console.conf
	chmod 644 ${DESTDIR}/usr/lib/tmpfiles.d/console.conf

	# Create halt, reboot, shutdown, poweroff compat symlinks. Some
	# applications expect them for "normal" use!
	vmkdir usr/sbin
	for f in halt poweroff shutdown reboot; do
		ln -sf /usr/bin/systemctl ${DESTDIR}/usr/sbin/${f}
	done
	# Create /usr/sbin/init for compatibility.
	ln -sf /usr/lib/systemd/systemd ${DESTDIR}/usr/sbin/init

	# Install local-d.service.
	vinstall ${FILESDIR}/local-d.service 644 usr/lib/systemd/system

	# Remove RPM stuff.
	rm -rf ${DESTDIR}/etc/rpm

	# Disable units in /etc; we do this at post-install time.
	rm -rf ${DESTDIR}/etc/systemd/system/getty.target.wants
}
