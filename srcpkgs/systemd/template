# Template file for 'systemd'
pkgname=systemd
version=36
revision=3
distfiles="http://www.freedesktop.org/software/$pkgname/$pkgname-$version.tar.bz2"
build_style=gnu_configure
configure_args="--with-distro=other --with-rootdir= --localstatedir=/var
--with-pamlibdir=/lib/security --disable-selinux --disable-tcpwrap
--with-sysvinit-path=/etc/init.d --with-sysvrcd-path=/etc/init.d --disable-audit"
short_desc="systemd is a system and service manager for Linux"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.freedesktop.org/wiki/Software/systemd"
license="GPL-2"
checksum=693cd0a8ad63c5e22c0fc45115e05180f0d33f60118972c0d5d080957fc69774
long_desc="
 systemd is a system and service manager for Linux, compatible with SysV and LSB
 init scripts. systemd provides aggressive parallelization capabilities, uses 
 socket and D-Bus activation for starting services, offers on-demand starting of 
 daemons, keeps track of processes using Linux cgroups, supports snapshotting and 
 restoring of the system state, maintains mount and automount points and 
 implements an elaborate transactional dependency-based service control logic. 
 It can work as a drop-in replacement for sysvinit."

subpackages="systemd-admin systemd-analyze systemd-gnome-passwd-agent systemd-devel"

keep_empty_dirs=yes
system_groups="lock"
conf_files="
/etc/hostname
/etc/vconsole.conf
/etc/locale.conf
/etc/systemd/system.conf
/etc/systemd/user.conf
/etc/systemd/systemd-logind.conf"

Add_dependency run glibc
Add_dependency run libudev
Add_dependency run pam
Add_dependency run libcap
Add_dependency run dbus-libs
Add_dependency run dbus
Add_dependency run acl

Add_dependency build pkg-config
Add_dependency build intltool
Add_dependency build gperf
Add_dependency build libxslt
Add_dependency build acl-devel
Add_dependency build libudev-devel
Add_dependency build pam-devel
Add_dependency build dbus-devel
Add_dependency build libcap-devel
Add_dependency build gtk+-devel
Add_dependency build libnotify-devel
Add_dependency build vala-devel

pre_configure()
{
	sed -i -e "s|/bin/loadkeys|/sbin/loadkeys|g" Makefile.in
	sed -i -e "s|/bin/setfont|/sbin/setfont|g" Makefile.in
}

post_install()
{
	cd ${DESTDIR}/usr/share/man/man8
	for manpage in telinit halt reboot poweroff runlevel shutdown; do
		mv ${manpage}.8 ${manpage}-systemd.8
	done
	vinstall ${FILESDIR}/hostname 644 etc
	vinstall ${FILESDIR}/vconsole.conf 644 etc
	vinstall ${FILESDIR}/os-release 644 etc
	vinstall ${FILESDIR}/locale.conf 644 etc

	printf "d /run/console 755 root root\n" > \
		${DESTDIR}/usr/lib/tmpfiles.d/console.conf
	chmod 644 ${DESTDIR}/usr/lib/tmpfiles.d/console.conf
}
