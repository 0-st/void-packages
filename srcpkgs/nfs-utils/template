# Template file for 'nfs-utils'
pkgname=nfs-utils
version=1.2.6
homepage="http://nfs.sourceforge.net"
distfiles="http://downloads.sf.net/nfs/$pkgname-$version.tar.bz2"
build_style=gnu-configure
configure_args="--with-statduser=nobody --enable-gss --enable-nfsv4
--with-statedir=/var/lib/nfs --enable-libmount-mount
--without-tcp-wrappers --enable-ipv6 --sbindir=/usr/sbin"
conf_files="/etc/exports /etc/idmapd.conf"
depends="rpcbind"
makedepends="pkg-config libblkid-devel libmount-devel libtirpc-devel librpcsecgss-devel libnfsidmap-devel libevent-devel device-mapper-devel libcap-devel mit-krb5-devel"
revision=1
short_desc="Network File System utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2"
checksum=70267288500408495085b7c54a667c4e8cfde5882f3193da095fc7dad2da0b83
long_desc="
 The $pkgname package provides a daemon for the kernel NFS server and
 related tools, which provides a much higher level of performance than the
 traditional Linux NFS server used by most users."

# systemd services
systemd_services="
exportfs.service	on
nfsd.service 		on
rpc-gssd.service	on
rpc-idmapd.service	on
rpc-mountd.service	on
rpc-statd.service	on
rpc-svcgssd.service	on
blkmapd.service 	on"

pre_install() {
	# Makefile doesn't seem to create it!
	vmkdir sbin
}

post_install() {
	vmove "sbin/*" usr/sbin
	# conffiles
	vinstall ${FILESDIR}/exports 644 etc
	vinstall ${FILESDIR}/idmapd.conf 644 etc
	# systemd glue
	vinstall ${FILESDIR}/${pkgname}.tmpfiles.d 644 \
		usr/lib/tmpfiles.d ${pkgname}.conf
	vmkdir lib/systemd/system
	install -m644 ${FILESDIR}/*.{service,mount} \
		${DESTDIR}/lib/systemd/system
}
