# Template file for 'ghostscript'
pkgname=ghostscript
version=9.05
revision=3
disable_parallel_build=yes
subpackages="libgs libijs $pkgname-devel"
depends="gsfonts"
makedepends="automake pkg-config dbus-devel libXext-devel libXt-devel fontconfig-devel jasper-devel tiff-devel jpeg-devel libpng-devel>=1.5.10 lcms2-devel cups-devel"
short_desc="An interpreter for the PostScript language"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.ghostscript.com/"
license="GPL-3, custom"
distfiles="http://downloads.ghostscript.com/public/$pkgname-$version.tar.bz2"
checksum=0f41212af3a5a552ab2302cd90606dc8245be34490a699726dc95ed3cd89ceac
long_desc="
 GPL Ghostscript is used for PostScript/PDF preview and printing. Usually as a
 back-end to a program such as ghostview, it can display PostScript and PDF
 documents in an X11 environment.

 Furthermore, it can render PostScript and PDF files as graphics to be printed
 on non-PostScript printers. Supported printers include common dot-matrix,
 inkjet and laser models."


pre_configure() {
	# force it to use system libs.
	rm -rf jpeg libpng zlib jasper expat tiff lcms lcms2 freetype
}

do_configure() {
	# configure ghostscript
	./configure ${CONFIGURE_SHARED_ARGS} --enable-dynamic --with-ijs \
		--with-jbig2dec --with-omni --with-x --with-drivers=ALL \
		--with-fontpath=/usr/share/fonts/Type1:/usr/share/fonts \
		--with-install-cups --enable-fontconfig --enable-freetype \
		--without-luratech --with-system-libtiff \
		--disable-compile-inits

	# configure libijs
	cd ijs && ./autogen.sh && \
		./configure ${CONFIGURE_SHARED_ARGS} --enable-shared \
			--disable-static
}

do_build() {
	# build ghostscript
	make ${makejobs} && make ${makejobs} so
	# build libijs
	cd ijs && make ${makejobs}
}

do_install() {
	# install ghostscript
	make DESTDIR=${DESTDIR} cups_serverroot=${DESTDIR}/etc/cups \
		cups_serverbin=${DESTDIR}/usr/lib/cups install soinstall
	# install missing doc files # http://bugs.archlinux.org/task/18023
	install -m644 doc/{Ps2ps2.htm,gs-vms.hlp,gsdoc.el,pscet_status.txt} \
		${DESTDIR}/usr/share/ghostscript/$version/doc/
	# install license
	vinstall LICENSE 644 usr/share/licenses/${pkgname}
	
	# install libijs
	cd ijs && make DESTDIR=${DESTDIR} install
}

