# Template build file for 'xulrunner'.
pkgname=xulrunner
_xulver=2.0
_xulpatchver=1
_ffver=4.0.1
# Current xulrunner version is available at $wrksrc/config/milestone.txt
if [ -n "${_xulpatchver}" ]; then
	version=${_xulver}.${_xulpatchver}
else
	version=${_xulver}
fi
patch_args="-Np1"
stow_copy=yes
#revision=1
wrksrc=mozilla-${_xulver}
distfiles="${MOZILLA_SITE}/firefox/releases/${_ffver}/source/firefox-${_ffver}.source.tar.bz2"
short_desc="XML User Interface Language runtime environment"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=cf3a39877facc229a67760915341fe95095cca647faab3a7adcb70046105199c
long_desc="
 XULRunner is a runtime environment for applications using the
 XML User Interface Language, XUL. It is the successor of the Gecko
 runtime environment"

subpackages="$pkgname-devel"
Add_dependency run libgcc
Add_dependency run glibc
Add_dependency run libstdc++
Add_dependency run jpeg
Add_dependency run libpng
Add_dependency run cairo	">=1.10.2_3"	# tee support
Add_dependency run freetype
Add_dependency run fontconfig
Add_dependency run libXrender
Add_dependency run libX11
Add_dependency run zlib
Add_dependency run nspr
Add_dependency run dbus-libs
Add_dependency run glib
Add_dependency run pango
Add_dependency run atk
Add_dependency run libXt
Add_dependency run libXext
Add_dependency run gdk-pixbuf
Add_dependency run gtk+
Add_dependency run alsa-lib
Add_dependency run sqlite
Add_dependency run libIDL
Add_dependency run nss
Add_dependency run dbus-glib
Add_dependency run startup-notification
Add_dependency run pixman
Add_dependency run hunspell
Add_dependency run libevent
Add_dependency run libXext
Add_dependency run GConf
Add_dependency run libnotify

Add_dependency build zip
Add_dependency build python
Add_dependency build flex
Add_dependency build yasm
Add_dependency build jpeg-devel
Add_dependency build libpng-devel
Add_dependency build cairo-devel	">=1.10.2_3"
Add_dependency build freetype-devel
Add_dependency build fontconfig-devel
Add_dependency build libXrender-devel
Add_dependency build libX11-devel
Add_dependency build zlib-devel
Add_dependency build nspr-devel
Add_dependency build dbus-devel
Add_dependency build glib-devel
Add_dependency build pango-devel
Add_dependency build atk-devel
Add_dependency build libXt-devel
Add_dependency build libXext-devel
Add_dependency build gdk-pixbuf-devel
Add_dependency build gtk+-devel
Add_dependency build pixman-devel
Add_dependency build alsa-lib-devel
Add_dependency build sqlite-devel
Add_dependency build libIDL-devel
Add_dependency build nss-devel
Add_dependency build dbus-glib-devel
Add_dependency build startup-notification-devel
Add_dependency build hunspell-devel
Add_dependency build libevent-devel
Add_dependency build libXext-devel
Add_dependency build GConf-devel
Add_dependency build libnotify-devel
Add_dependency build wireless_tools-devel

do_build()
{
	export CXXFLAGS="$XBPS_CXXFLAGS -fpermissive"
	cp -f ${FILESDIR}/mozconfig .mozconfig
	if [ -n "$makejobs" ]; then
		echo "mk_add_options MOZ_MAKE_FLAGS=\"${makejobs}\"" >> .mozconfig
	fi
	make -f client.mk build
}

do_install()
{
	make -f client.mk DESTDIR="${DESTDIR}" install
	# Remove libsqlite3, provided by sqlite.
	rm -f ${DESTDIR}/usr/lib/${pkgname}-${_xulver}/libsqlite3.so
	rm -f ${DESTDIR}/usr/lib/pkgconfig/mozilla-nss.pc
	# Add xulrunner library path to ld.so.conf
	install -d ${DESTDIR}/etc/ld.so.conf.d
	echo "/usr/lib/xulrunner-2.0" > \
		${DESTDIR}/etc/ld.so.conf.d/xulrunner.conf
}

post_stow()
{
	msg_normal "Updating dynamic linker shared cache...\n"
	ldconfig
}
