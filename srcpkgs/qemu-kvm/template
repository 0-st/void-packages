# Template file for 'qemu-kvm'
pkgname=qemu-kvm
version=1.2.0
revision=1
nostrip=yes
conflicts="qemu>=0"
provides="qemu-$version"
build_style=configure
configure_args="--prefix=/usr --sysconfdir=/etc --enable-spice
--enable-kvm --audio-drv-list=alsa,sdl,pa --disable-xen
--enable-vhost-net --enable-vnc-png --enable-vnc-tls 
--enable-virtfs --disable-fdt --enable-vde"
makedepends="perl python attr-devel libpng-devel>=1.5.10 jpeg-devel ncurses-devel
libuuid-devel libX11-devel alsa-lib-devel gnutls-devel SDL-devel libbluetooth-devel
libsasl-devel spice-devel glib-devel MesaLib-devel pulseaudio-devel nss-devel
libcurl-devel xfsprogs-devel libcap-ng-devel libcap-devel vde2-devel libtool"
conf_files="/etc/qemu/target-x86_64.conf"
short_desc="Open Source Processor Emulator -- KVM version"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://www.linux-kvm.org"
license="GPL-2, LGPL-2.1"
distfiles="${SOURCEFORGE_SITE}/kvm/$pkgname-$version.tar.gz"
checksum=e98ab96c24337e312864f2341016695ac11cb9a04be83548a8da89596d591b05
long_desc="
 QEMU is a generic and open source machine emulator and virtualizer.

 When used as a machine emulator, QEMU can run OSes and programs made for
 one machine (e.g. an ARM board) on a different machine (e.g. your own PC).
 By using dynamic translation, it achieves very good performances."

post_install() {
	# symbolic link for backwards compatibility
	ln -s qemu-system-x86_64 ${DESTDIR}/usr/bin/qemu-kvm
	# symbolic link for to qemu binary for emulator apps
	ln -s qemu-system-x86_64 ${DESTDIR}/usr/bin/qemu
	# symbolic link for to qemu binary for emulator apps
	ln -s qemu-system-x86_64 ${DESTDIR}/usr/bin/kvm
	# fix man page
	mv ${DESTDIR}/usr/share/man/man1/qemu.1 \
		${DESTDIR}/usr/share/man/man1/qemu-kvm.1

	vinstall ${FILESDIR}/65-kvm.rules 644 usr/lib/udev/rules.d
	# qemu-bridge-helper must be setuid for non privileged users.
	chmod u+s ${DESTDIR}/usr/libexec/qemu-bridge-helper
}
