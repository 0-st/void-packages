# Template file for 'util-linux'
pkgname=util-linux
_distver=2.19
#_patchver=rc3
version=${_distver}${_patchver}
revision=1
wrksrc=${pkgname}-${_distver}
distfiles="${KERNEL_SITE}/utils/${pkgname}-ng/v${_distver}/${pkgname}-${_distver}.tar.bz2"
build_style=gnu_configure
configure_args="--enable-partx --enable-write --enable-libuuid
--enable-libblkid --disable-fsck --disable-rpath --with-gnu-ld
--disable-makeinstall-chown"
short_desc="Miscellaneous linux utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=d8189ba6dfb508d5c36f50103a7b84943d893e51e6d7a314155a82f68efb33b6
long_desc="
 The ${pkgname} package contains miscellaneous utility programs. Among
 them are utilities for handling file systems, consoles, partitions,
 and messages."

replaces="util-linux-ng>=0"
subpackages="libmount libmount-devel libblkid libblkid-devel libuuid libuuid-devel"
# Required by /var/lib/hwclock
keep_empty_dirs=yes

Add_dependency run glibc
Add_dependency run coreutils
Add_dependency run zlib
Add_dependency run libuuid
Add_dependency run libblkid
Add_dependency run libmount
Add_dependency run ncurses-libs
Add_dependency run shadow
Add_dependency build pkg-config
Add_dependency build gettext
Add_dependency build zlib-devel
Add_dependency build ncurses-devel

post_configure()
{
	cd $wrksrc
	for f in $(grep -rl '/etc/adjtime' .); do
		sed -i -e 's@etc/adjtime@var/lib/hwclock/adjtime@g' $f
	done
}

post_install()
{
	# Move logger to /bin.
	install -d -m 755 ${DESTDIR}/bin
	mv ${DESTDIR}/usr/bin/logger ${DESTDIR}/bin
	mkdir -p ${DESTDIR}/var/lib/hwclock

	# Install the cron daily job.
	install -D -m744 ${FILESDIR}/adjtime.cron-hourly \
		${DESTDIR}/etc/cron.hourly/adjtime
}
