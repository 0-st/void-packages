# Template file for 'util-linux'
pkgname=util-linux
version=2.21.2
distfiles="${KERNEL_SITE}/utils/${pkgname}/v2.21/${pkgname}-${version}.tar.xz"
depends="coreutils shadow"
makedepends="pkg-config zlib-devel ncurses-devel"
replaces="util-linux-ng>=0 e2fsprogs<=1.41.14_1"
subpackages="libmount libmount-devel libblkid libblkid-devel libuuid libuuid-devel"
make_dirs="/var/lib/hwclock 0755 0 0"
short_desc="Miscellaneous linux utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://userweb.kernel.org/~kzak/util-linux-ng"
license="GPL-2"
checksum=39b25765a02385dc73580ab5edc3c5a2cecd03c92b42e41b03fd037b1c7cefe6
long_desc="
 The ${pkgname} package contains miscellaneous utility programs. Among
 them are utilities for handling file systems, consoles, partitions,
 and messages."

do_configure() {
	./configure ${CONFIGURE_SHARED_ARGS} \
		--libdir=/usr/lib --libexecdir=/usr/lib --without-udev \
		--enable-partx --enable-write --enable-new-mount \
		--enable-libuuid --disable-makeinstall-chown \
		--enable-libblkid --enable-fsck --disable-rpath \
		--enable-fs-paths-extra=/usr/sbin:/usr/bin \
		SUID_CFLAGS="-fPIE" SUID_LDFLAGS="-pie"
}

do_build() {
	sed -e 's%etc/adjtime%var/lib/hwclock/adjtime%' -i include/pathnames.h
	make ${makejobs}
}

do_install() {
	make DESTDIR=${DESTDIR} install
	# Remove obsolete chkdupexec
	rm -f ${DESTDIR}/usr/bin/chkdupexe
	rm -f ${DESTDIR}/usr/share/man/man1/chkdupexe.1
}
