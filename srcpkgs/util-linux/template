# Template file for 'util-linux'
pkgname=util-linux
_distver=2.20
#_patchver=".1"
version=${_distver}${_patchver}
revision=2
wrksrc=${pkgname}-${version}
patch_args="-Np1"
distfiles="${KERNEL_SITE}/utils/${pkgname}/v${_distver}/${pkgname}-${version}.tar.bz2"
build_style=custom-install
short_desc="Miscellaneous linux utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://userweb.kernel.org/~kzak/util-linux-ng"
license="GPL-2"
checksum=c1cffbf5a1a7a32965f2e8e9ce76336310031e10b87c418d0679075724271d4c
long_desc="
 The ${pkgname} package contains miscellaneous utility programs. Among
 them are utilities for handling file systems, consoles, partitions,
 and messages."

replaces="util-linux-ng>=0 e2fsprogs<=1.41.14_1"
subpackages="libmount libmount-devel libblkid libblkid-devel libuuid libuuid-devel"
# Required by /var/lib/hwclock
keep_empty_dirs=yes

Add_dependency run glibc
Add_dependency run zlib
Add_dependency run coreutils
Add_dependency run libuuid
Add_dependency run libblkid
Add_dependency run libmount
Add_dependency run ncurses-libs
Add_dependency run shadow

Add_dependency build pkg-config
Add_dependency build gettext
Add_dependency build zlib-devel
Add_dependency build ncurses-devel

do_configure()
{
	./configure ${CONFIGURE_SHARED_ARGS} \
		--enable-partx --enable-write \
		--enable-libuuid --disable-makeinstall-chown \
		--enable-libblkid --enable-fsck --disable-rpath \
		--enable-libmount-mount
}

do_build()
{
	sed -e 's%etc/adjtime%var/lib/hwclock/adjtime%' -i include/pathnames.h
	make ${makejobs}
}

do_install()
{
	make DESTDIR=${DESTDIR} install
	# Move logger to /bin.
	vmkdir bin
	mv ${DESTDIR}/usr/bin/logger ${DESTDIR}/bin
	vmkdir var/lib/hwclock
}
