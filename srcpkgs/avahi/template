# Template file for 'avahi'
pkgname=avahi
version=0.6.31
revision=9
build_style=gnu-configure
configure_args="--disable-qt3 --disable-qt4 --disable-mono --disable-monodoc
 --disable-doxygen-doc --enable-compat-libdns_sd --enable-compat-howl
 --with-xml=expat --with-avahi-user=avahi --with-avahi-group=avahi
 --with-avahi-priv-access-group=netdev --with-autoipd-user=avahi
 --with-autoipd-group=avahi --with-distro=none --disable-xmltoman
 --disable-dbm --with-systemdsystemunitdir=/usr/lib/systemd/system
 --disable-static ssp_cv_lib=no"
short_desc="Multicast DNS Service Discovery"
maintainer="Juan RP <xtraeme@gmail.com>"
license="LGPL-2.1"
homepage="http://www.avahi.org"
distfiles="$homepage/download/avahi-$version.tar.gz"
checksum=8372719b24e2dd75de6f59bb1315e600db4fd092805bd1201ed0cb651a2dab48

depends="dbus"
makedepends="pkg-config intltool dbus-devel libcap-devel
 libdaemon-devel gdbm-devel dbus-python pygtk-devel
 gtk+3-devel>=3.6.0_5 gobject-introspection"

# Create avahi and netdev system accounts.
system_accounts="avahi netdev"
systemd_services="avahi-daemon.service on"

conf_files="
/etc/avahi/services/ssh.service
/etc/avahi/services/sftp-ssh.service
/etc/avahi/avahi-daemon.conf
/etc/avahi/hosts
/etc/avahi/avahi-dnsconfd.action"

subpackages="avahi-autoipd avahi-discover avahi-compat-libs avahi-compat-libs-devel
 avahi-libs avahi-libs-devel avahi-glib-libs avahi-glib-libs-devel
 avahi-ui-libs avahi-ui-libs-gtk3 avahi-ui-libs-devel avahi-utils
 avahi-ui-utils avahi-python-utils avahi-python"

if [ -n "$XBPS_CROSS_TRIPLET" ]; then
	# XXX glib, gtk, introspection and python
	makedepends="automake gettext-devel glib-devel pkg-config intltool"
	crossmakedepends="dbus-devel libcap-devel libdaemon-devel gdbm-devel"
	subpackages="avahi-autoipd avahi-compat-libs avahi-compat-libs-devel
		     avahi-libs avahi-libs-devel avahi-utils"
	configure_args="${configure_args} --disable-glib --disable-gobject
			--disable-gtk --disable-gtk3 --disable-introspection
			--disable-python --disable-pygtk
			PKG_CONFIG_SYSROOT_DIR=/usr/$XBPS_CROSS_TRIPLET
			PKG_CONFIG_LIBDIR=/usr/$XBPS_CROSS_TRIPLET/lib/pkgconfig"
	pre_configure() {
		autoreconf -fi
	}
fi
