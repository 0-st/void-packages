# Template file for 'cronie'
pkgname=cronie
version=1.4.8
revision=8
distfiles="https://fedorahosted.org/releases/c/r/cronie/cronie-$version.tar.gz"
build_style=gnu-configure
configure_args="--with-inotify --without-selinux --with-pam --disable-anacron
--localstatedir=/var"
short_desc="Runs specified programs at scheduled times"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="https://fedorahosted.org/cronie/"
license="BSD"
checksum=a3b910876f255712f1a5c364b74f34b0ceac9f6f3bbc45e854c5722785f513b3
long_desc="
 Cronie contains the standard UNIX daemon crond that runs specified programs at
 scheduled times and related tools. It is based on the original cron and
 has security and configuration enhancements like the ability to use PAM and
 SELinux."

conf_files="/etc/crontab /etc/pam.d/crond /etc/cron.deny"
systemd_services="cronie.service"
provides="cron-daemon-0"
replaces="cron-daemon>=0"

Add_dependency run glibc
Add_dependency run pam
Add_dependency full run-parts
Add_dependency build pam-devel

post_install()
{
	install -d ${DESTDIR}/etc/cron.{d,hourly,daily,weekly,monthly}
	touch ${DESTDIR}/etc/cron.{d,hourly,daily,weekly,monthly}/.owned
	vmkdir var/spool/cron
	touch ${DESTDIR}/var/spool/cron/.owned

	vinstall ${FILESDIR}/cronie.service 644 lib/systemd/system
	vinstall ${FILESDIR}/crontab 644 etc
	vinstall ${FILESDIR}/crond.logrotate 644 etc/logrotate.d crond
	rm -f ${DESTDIR}/etc/pam.d/crond
	vinstall ${FILESDIR}/crond.pam 644 etc/pam.d crond

	# Add /etc/cron.deny empty, to allow all users.
	touch ${DESTDIR}/etc/cron.deny
	chmod 644 ${DESTDIR}/etc/cron.deny
}
