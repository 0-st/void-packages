# Template file for 'cronie'
pkgname=cronie
version=1.4.7
distfiles="https://fedorahosted.org/releases/c/r/cronie/cronie-$version.tar.gz"
build_style=gnu_configure
configure_args="--with-inotify --without-selinux --with-pam --disable-anacron
--with-daemon_username=nobody --with-daemon_groupname=nobody
--localstatedir=/var"
short_desc="Runs specified programs at scheduled times"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="https://fedorahosted.org/cronie/"
license="BSD"
checksum=83bae15ae5504454ba74f4142f5db3aa22be594327fea19d2534f65803137fbd
long_desc="
 Cronie contains the standard UNIX daemon crond that runs specified programs at
 scheduled times and related tools. It is based on the original cron and
 has security and configuration enhancements like the ability to use PAM and
 SELinux."

keep_empty_dirs=yes
conf_files="/etc/crontab"
openrc_services="crond default true"
provides="syslog-daemon-0"
replaces="syslog-daemon>=0"

Add_dependency run glibc
Add_dependency run pam
Add_dependency full run-parts
Add_dependency build pam-devel

post_install()
{
	install -d ${DESTDIR}/etc/cron.d ${DESTDIR}/etc/cron.hourly \
		${DESTDIR}/etc/cron.daily ${DESTDIR}/etc/cron.weekly \
		${DESTDIR}/etc/cron.monthly ${DESTDIR}/etc/logrotate.d
	install -d -m755 ${DESTDIR}/var/spool/cron

	install -D -m755 ${FILESDIR}/crond.rc ${DESTDIR}/etc/init.d/crond
	install -m644 ${FILESDIR}/crontab ${DESTDIR}/etc/crontab
	install -m644 ${FILESDIR}/crond.logrotate \
		${DESTDIR}/etc/logrotate.d/crond
	rm -vf ${DESTDIR}/etc/pam.d/crond
	install -D -m644 ${FILESDIR}/crond.pam ${DESTDIR}/etc/pam.d/crond

	# Add /etc/cron.deny empty, to allow all users.
	touch ${DESTDIR}/etc/cron.deny
	chmod 644 ${DESTDIR}/etc/cron.deny
}
