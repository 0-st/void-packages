# Template file for 'libcap'
pkgname=libcap
version=2.22
revision=1
distfiles="${KERNEL_SITE}/libs/security/linux-privs/libcap2/$pkgname-$version.tar.bz2"
short_desc="POSIX.1e capabilities library"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://sites.google.com/site/fullycapable/"
license="GPL-2"
checksum=73ebbd4877b5f69dd28b72098e510c5b318bc480f8201c4061ac98b78c04050f
long_desc="
 libcap is a library for getting and setting POSIX.1e (formerly POSIX 6)
 draft 15 capabilities."

subpackages="$pkgname-devel $pkgname-pam $pkgname-progs"
Add_dependency run glibc
Add_dependency run attr
Add_dependency build perl
Add_dependency build pam-devel
Add_dependency build attr-devel

do_build()
{
	sed -i -e "s|LIBDIR=\$(FAKEROOT)\$(lib_prefix)\/lib|LIBDIR=\$(FAKEROOT)/\$(lib)|g" \
		Make.Rules
	make ${makejobs}
}

do_install()
{
	vmkdir lib
	vmkdir usr/lib
	if [ "$xbps_machine" = "x86_64" ]; then
		ln -sf lib ${DESTDIR}/lib64
	fi
	make DESTDIR=${DESTDIR} RAISE_SETFCAP=no install
	rm -f ${DESTDIR}/lib64

	vinstall pam_cap/capability.conf 644 etc/security
	cd ${DESTDIR}/usr/lib && ln -sf ../../lib/libcap.so .
	chmod 755 ${DESTDIR}/lib/libcap.so.*
}
