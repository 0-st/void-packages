# Template file for 'libcap'
pkgname=libcap
version=2.19
distfiles="${KERNEL_SITE}/libs/security/linux-privs/libcap2/$pkgname-$version.tar.bz2"
build_style=gnu_makefile
make_install_args="prefix=/usr"
short_desc="POSIX.1e capabilities library"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=ed1693e344054a398e68a7cc840892e3d1a880562743bdf28fd918649aa5a4ce
long_desc="
 libcap is a library for getting and setting POSIX.1e (formerly POSIX 6)
 draft 15 capabilities."

subpackages="$pkgname-devel $pkgname-pam $pkgname-progs"
Add_dependency run glibc
Add_dependency run attr
Add_dependency build perl
Add_dependency build pam-devel
Add_dependency build attr-devel

pre_build()
{
	sed -i -e "s|LIBDIR=\$(FAKEROOT)\$(lib_prefix)\/lib|LIBDIR=\$(FAKEROOT)/\$(lib)|g" \
		${wrksrc}/Make.Rules
}

pre_install()
{
	if [ "$xbps_machine" = "x86_64" ]; then
		mkdir -p ${DESTDIR}/usr/lib
		cd ${DESTDIR}/usr && ln -s lib lib64 && cd ${wrksrc}
	fi
}

post_install()
{
	install -D -m644 ${wrksrc}/pam_cap/capability.conf \
		${DESTDIR}/etc/security/capability.conf || return 1
	mkdir -p ${DESTDIR}/lib || return 1
	mv ${DESTDIR}/usr/lib/security ${DESTDIR}/lib || return 1
	rm -f ${DESTDIR}/usr/lib64
}
