# Template file for 'dev86'
pkgname=dev86
version=0.16.17
distfiles="http://www.debath.co.uk/dev86/Dev86src-$version.tar.gz"
build_style=gnu_makefile
make_build_args="PREFIX=/usr DIST=$XBPS_DESTDIR/$pkgname-$version"
make_install_target="DIST=$XBPS_DESTDIR/$pkgname-$version install-all"
short_desc="8086 cross development compiler, assembler and linker"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=52ed4980c0e4b68d2624aadb0ceb0339cb3fd8dd7c2175419d4f77a451846cbe
long_desc="
 This package provides a cross development C compiler, assembler and linker
 environment for the production of 8086 executables (Optionally MSDOS COM)."

nostrip=yes
disable_parallel_build=yes

Add_dependency run glibc
Add_dependency build bin86

pre_build()
{
	if [ "${xbps_machine}" = "x86_64" ]; then
		sed -i -e 's,alt-libs elksemu,alt-libs,' \
			-e 's,install-lib install-emu,install-lib,' \
			${wrksrc}/makefile.in
	fi
}

post_install()
{
	install -d ${DESTDIR}/usr/share
	mv ${DESTDIR}/usr/man ${DESTDIR}/usr/share
	# Remove stuff supplied by bin86
	rm -f ${DESTDIR}/usr/bin/{as,ld,nm,objdump,size}86
	rm -f ${DESTDIR}/usr/share/man/man1/{as,ld}86.1
}
