# Template file for 'dmraid'
pkgname=dmraid
_distver=1.0.0.rc16
_patchver=3
version="${_distver}_${_patchver}"
wrksrc="${pkgname}"
build_wrksrc="${_distver}-${_patchver}/${pkgname}"
homepage="http://people.redhat.com/~heinzm/sw/dmraid/"
distfiles="${homepage}/src/dmraid-${_distver}-${_patchver}.tar.bz2"
build_style=gnu-configure
configure_args="--enable-led --enable-intel_led --enable-shared_lib"
short_desc="Device mapper RAID interface"
maintainer="Juan RP <xtraeme@gmail.com>"
license="GPL-2, LGPL-2.1"
checksum=93421bd169d71ff5e7d2db95b62b030bfa205a12010b6468dcdef80337d6fbd8
long_desc="
 dmraid discovers, activates, deactivates and displays properties of software RAID sets
 (eg, ATARAID) and contained DOS partitions.

 dmraid uses the Linux device-mapper to create devices with respective mappings
 for the ATARAID sets discovered.

 The following formats are supported:

  Highpoint HPT37X/HPT45X
  Intel Software RAID
  LSI Logic MegaRAID
  NVidia NForce RAID (nvraid)
  Promise FastTrack
  Silicon Image(tm) Medley(tm)
  VIA Software RAID"

systemd_services="dmraid.service off"
shlib_depends="device-mapper>=2.02.95_3"
triggers="initramfs-tools"

Add_dependency build device-mapper-devel ">=2.02.95_1"

post_install() {
	rm -rf ${DESTDIR}/usr/include
	rm -f ${DESTDIR}/usr/lib/*.a

	# Install initramfs-tools stuff.	
	vinstall ${FILESDIR}/dmraid.initramfs-hook 755 \
		usr/share/initramfs-tools/hooks dmraid
	vinstall ${FILESDIR}/dmraid.initramfs-local-top 755 \
		usr/share/initramfs-tools/scripts/local-top dmraid
	# Install dmraid-activate from Debian.
	vinstall ${FILESDIR}/dmraid-activate 755 usr/sbin
	# systemd service.
	vinstall ${FILESDIR}/dmraid.service 644 lib/systemd/system
}
