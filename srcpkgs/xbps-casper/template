# Template file for 'xbps-casper'
pkgname=xbps-casper
_localver=0.12	# XBPS package version
_distver=1.236	# This should match the upstream (Ubuntu) version
version=${_localver}.${_distver}
build_style=custom-install
short_desc="Run a live preinstalled system from read-only media"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=b31983b27630b3ef99f68bd8382851a7963542c944b625bdbfd2f2ff301a02d3
long_desc="
 $pkgname is a modified version of Ubuntu's casper, that is able
 to run a live pre-installed system from read-only media."

noextract=yes
noarch=yes
keep_empty_dirs=yes
conf_files="/etc/casper.conf"

Add_dependency full initramfs-tools

do_install()
{
	# /etc config files
	install -d ${DESTDIR}/etc
	install -m 644 ${FILESDIR}/casper.conf ${DESTDIR}/etc

	# Helpers
	install -d ${DESTDIR}/sbin
	install -m 755 ${FILESDIR}/bin/* ${DESTDIR}/sbin

	# initramfs-tools hooks/scripts
	initramfsdir=${DESTDIR}/usr/share/initramfs-tools
	install -d ${initramfsdir}/hooks ${initramfsdir}/scripts/casper-bottom \
		${initramfsdir}/conf.d
	install -m 755 ${FILESDIR}/hooks/* ${initramfsdir}/hooks
	install -m 755 ${FILESDIR}/scripts/casper-bottom/* \
		${initramfsdir}/scripts/casper-bottom
	install -m 644 ${FILESDIR}/scripts/{casper,casper-helpers} \
		${initramfsdir}/scripts
	install -m 644 ${FILESDIR}/conf.d/* ${initramfsdir}/conf.d
}
