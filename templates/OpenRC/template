# Template file for 'OpenRC'
pkgname=OpenRC
version=0.5.2
wrksrc=openrc-${version}
distfiles="http://roy.marples.name/downloads/openrc/openrc-$version.tar.bz2"
build_style=gnu_makefile
short_desc="Universal init system"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=0633f5cc8c0f055a292722b36108cebbe1925f164df8c0d2688dd376e6f0e18c
long_desc="
 OpenRC is a dependency based init system that works with the system
 provided init program, normally /sbin/init. It is not a replacement for
 /sbin/init. OpenRC is 100% compatible with Gentoo init scripts, which
 means you can probably find one for the daemons you want to start in the
 Gentoo Portage Tree. OpenRC also provides an init script that runs BSD
 rc.d style scripts too, making it easy to port your BSD system to OpenRC." 

keep_empty_dirs=yes
conf_files="/etc/rc.conf /etc/conf.d/bootmisc /etc/conf.d/consolefont
 /etc/conf.d/dmesg /etc/conf.d/fsck /etc/conf.d/hostname /etc/conf.d/hwclock
 /etc/conf.d/keymaps /etc/conf.d/local /etc/conf.d/locale
 /etc/conf.d/localmount /etc/conf.d/modules /etc/conf.d/network
 /etc/conf.d/urandom /etc/conf.d/staticroutes /etc/inittab"
 
Add_dependency full glibc
Add_dependency full psmisc
Add_dependency full sysvinit

pre_build()
{
	# Install the "locale" service
	cp ${FILESDIR}/locale.rc ${wrksrc}/init.d/locale.in

	# Fix path for kbd stuff.
	for f in init.d/consolefont.in conf.d/consolefont; do
		sed -i -e "s|/usr/share|/lib/kbd|g" ${wrksrc}/${f}
	done
}

post_install()
{
	install -D -m755 ${wrksrc}/support/sysvinit/inittab \
		${DESTDIR}/etc/inittab
	install -D -m644 ${FILESDIR}/$pkgname.logrotate \
		${DESTDIR}/etc/logrotate.d/OpenRC
	install -D -m644 ${FILESDIR}/locale.confd \
		${DESTDIR}/etc/conf.d/locale
	install -d ${DESTDIR}/etc/default
	mv ${DESTDIR}/etc/rc.conf ${DESTDIR}/etc/default
	install -m 644 ${FILESDIR}/rc.conf ${DESTDIR}/etc
}
