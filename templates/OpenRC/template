# Template file for 'OpenRC'
pkgname=OpenRC
version=20090513
wrksrc=openrc
patch_files="xbps-locale-service.diff"
distfiles="http://ftp.gnu.org/gnu/openrc/openrc-$version.tar.bz2"
build_style=gnu_makefile
short_desc="Universal init system"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=eb764438651d7f265379dc794cd8a3d1557990df7e448a9728c39bcd2187ab70
long_desc="
 OpenRC is a dependency based init system that works with the system
 provided init program, normally /sbin/init. It is not a replacement for
 /sbin/init. OpenRC is 100% compatible with Gentoo init scripts, which
 means you can probably find one for the daemons you want to start in the
 Gentoo Portage Tree. OpenRC also provides an init script that runs BSD
 rc.d style scripts too, making it easy to port your BSD system to OpenRC." 

conf_files="/etc/rc.conf /etc/conf.d/bootmisc /etc/conf.d/consolefont
 /etc/conf.d/dmesg /etc/conf.d/fsck /etc/conf.d/hostname /etc/conf.d/hwclock
 /etc/conf.d/keymaps /etc/conf.d/local /etc/conf.d/localmount
 /etc/conf.d/modules /etc/conf.d/network /etc/conf.d/urandom
 /etc/inittab"
 
Add_dependency full glibc
Add_dependency full psmisc
Add_dependency full sysvinit

pre_configure()
{
	# Install the "locale" service
	cp ${FILESDIR}/locale.rc ${wrksrc}/init.d/locale.in

	# Fix path for kbd stuff.
	for f in init.d/consolefont.in conf.d/consolefont; do
		sed -i -e "s|/usr/share/consolefonts|/lib/kbd/consolefonts|g" \
			${wrksrc}/${f}
	done
}

post_install()
{
	install -D -m755 ${wrksrc}/support/sysvinit/inittab \
		${DESTDIR}/etc/inittab
}
