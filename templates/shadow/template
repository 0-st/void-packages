# Template file for 'shadow'
pkgname=shadow
version=4.1.2.2
patch_files="$pkgname-enable-pam.diff"
distfiles="ftp://pkg-shadow.alioth.debian.org/pub/pkg-shadow/$pkgname-$version.tar.bz2"
build_style=gnu_configure
configure_args="--libdir=/lib --enable-shared --disable-static
 --with-libpam --without-selinux"
make_install_target="DESTDIR=$XBPS_DESTDIR/$pkgname-$version install"
short_desc="Shadow password file utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=378fbfb0e8bb8c87be239fccd692818871f763206bb7d881744f4fa72dc6b491
long_desc="
 Shadow password file utilities for GNU/Linux."

conf_files="/etc/pam.d/usermod /etc/pam.d/userdel /etc/pam.d/useradd
 /etc/pam.d/su /etc/pam.d/passwd /etc/pam.d/newusers /etc/pam.d/login
 /etc/pam.d/groupmod /etc/pam.d/groupmems /etc/pam.d/groupdel
 /etc/pam.d/groupadd /etc/pam.d/chsh /etc/pam.d/chpasswd
 /etc/pam.d/chgpasswd /etc/pam.d/chfn /etc/pam.d/chage /etc/defaults/useradd
 /etc/pam.d/other /etc/login.defs"

Add_dependency full glibc
Add_dependency full pam

pre_build()
{
	# Don't install the groups cmd, we use the one from coreutils.
	cd $wrksrc && \
		sed -i 's/groups$(EXEEXT) //' src/Makefile && \
		find man -name Makefile -exec sed -i 's/groups\.1 / /' {}
}

post_install()
{
	# Use the same auth file for all these cmds.
	for f in chpasswd chgpasswd groupadd groupdel groupmems \
		 groupmod newusers useradd userdel usermod other; do
		install -m644 $DESTDIR/etc/pam.d/chage $DESTDIR/etc/pam.d/${f}
	done
}
