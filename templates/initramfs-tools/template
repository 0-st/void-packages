# Template file for 'initramfs-tools'
pkgname=initramfs-tools
version=0.93
patch_files="$pkgname-xbps.diff"
distfiles="
http://ftp.de.debian.org/debian/pool/main/i/$pkgname/${pkgname}_${version}.tar.gz"
build_style=custom-install
short_desc="Tools for generating an initramfs"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=1d56acc8dd64504d1e383a9e671179979369624323814ea691bceaa3560e0ec7
long_desc="
 This package contains tools to create and boot an initramfs for packaged 2.6
 Linux kernel. The initramfs is a gzipped cpio archive. At boot time, the
 kernel unpacks that archive into RAM, mounts and uses it as initial root
 file system. The mounting of the real root file system occurs in early user
 space. klibc provides utilities to setup root. Having the root on EVMS, MD,
 LVM2, LUKS or NFS is also supported. Any boot loader with initrd support is
 able to load an initramfs archive."

noarch=yes
keep_dirs="/var/lib/$pkgname"
conf_files="/etc/$pkgname/initramfs.conf /etc/$pkgname/update-initramfs.conf
 /etc/$pkgname/modules"

Add_dependency full glibc
Add_dependency full cpio
Add_dependency full util-linux-ng
Add_dependency full klibc-utils
Add_dependency full module-init-tools
Add_dependency full busybox-initramfs
Add_dependency full gawk
Add_dependency full findutils
Add_dependency full sed
Add_dependency full grep
Add_dependency full gzip
Add_dependency full udev

do_install()
{
	local destdir=$XBPS_DESTDIR/$pkgname-$version
	local etcdir=$destdir/etc/$pkgname

	# Required dirs
	install -d $etcdir/hooks
	install -d $etcdir/conf.d
	install -d $etcdir/scripts/init-bottom
	install -d $etcdir/scripts/init-premount
	install -d $etcdir/scripts/init-top
	install -d $etcdir/scripts/local-bottom
	install -d $etcdir/scripts/local-premount
	install -d $etcdir/scripts/local-top
	install -d $destdir/usr/share/$pkgname
	install -d $destdir/usr/share/$pkgname/conf.d
	install -d $destdir/usr/share/$pkgname/hooks
	install -d $destdir/usr/share/$pkgname/hooksconf.d
	install -d $destdir/usr/share/$pkgname/modules.d
	install -d $destdir/usr/share/$pkgname/scripts
	install -d $destdir/usr/share/$pkgname/scripts/init-premount
	install -d $destdir/usr/share/$pkgname/scripts/init-top
	install -d $destdir/usr/share/$pkgname/scripts/local-premount
	install -d $destdir/usr/share/$pkgname/scripts/local-top
	install -d $destdir/usr/share/doc/$pkgname
	install -d $destdir/usr/share/doc/$pkgname/examples
	install -d $destdir/usr/share/man/man5
	install -d $destdir/usr/share/man/man8
	install -d $destdir/usr/sbin
	install -d $destdir/var/lib/$pkgname

	# /etc config files
	install -m 644 $wrksrc/conf/initramfs.conf $etcdir
	install -m 644 $wrksrc/conf/update-initramfs.conf $etcdir

	# Data
	install -m 755 $wrksrc/init $destdir/usr/share/$pkgname
	for f in functions local nfs; do
		install -m 644 $wrksrc/scripts/$f \
			$destdir/usr/share/$pkgname/scripts
	done
	install -m 755 $wrksrc/scripts/init-premount/* \
		$destdir/usr/share/$pkgname/scripts/init-premount
	install -m 755 $wrksrc/scripts/init-top/* \
		$destdir/usr/share/$pkgname/scripts/init-top
	install -m 755 $wrksrc/scripts/local-premount/* \
		$destdir/usr/share/$pkgname/scripts/local-premount
	install -m 755 $wrksrc/hooks/* $destdir/usr/share/$pkgname/hooks
	install -m 644 $wrksrc/hook-functions $destdir/usr/share/$pkgname
	install -m 644 $wrksrc/conf/modules $etcdir

	# Examples
	install -m 644 $wrksrc/docs/* $destdir/usr/share/doc/$pkgname/examples
	
	# Manpages
	install -m 644 $wrksrc/*.5 $destdir/usr/share/man/man5
	install -m 644 $wrksrc/*.8 $destdir/usr/share/man/man8

	# Scripts
	install -m 755 $wrksrc/mkinitramfs $destdir/usr/sbin
	install -m 755 $wrksrc/mkinitramfs-kpkg $destdir/usr/sbin
	install -m 755 $wrksrc/update-initramfs $destdir/usr/sbin
}
