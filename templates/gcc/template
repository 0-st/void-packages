# Template build file for 'gcc'
pkgname=gcc
version=4.4.2
distfiles="http://ftp.gnu.org/pub/gnu/gcc/gcc-$version/gcc-$version.tar.bz2"
build_style=gnu_configure
configure_args="--enable-clocale=gnu --disable-bootstrap
 --enable-threads=posix --enable-__cxa_atexit --disable-multilib
 --enable-languages=c,c++,objc,obj-c++ --enable-tls
 --with-mpfr=$XBPS_MASTERDIR/usr --with-gmp=$XBPS_MASTERDIR/usr
 --disable-rpath --with-system-zlib --enable-shared"
short_desc="The GNU C Compiler suite"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=1126b6a7b585b3a178bfb7d559221779eb7eba12ce01bc9ca5896f6f9ee639de
long_desc="
 The GNU C Compiler suite, with support for C, C++, Fortran, ObjC."

base_chroot=yes
subpackages="libgcc libstdc++ libstdc++-devel libgomp libmudflap"
subpackages="${subpackages} libmudflap-devel libobjc libobjc-devel"
subpackages="${subpackages} c++ objc objc++"

Add_dependency full	gmp
Add_dependency full	mpfr
Add_dependency full	binutils
Add_dependency run	gcc-libgcc
Add_dependency run	gcc-libgomp
Add_dependency run	glibc-devel

# As specified in the LFS book, disable installing libiberty.
pre_configure()
{
	sed -i 's/install_to_$(INSTALL_DEST) //' $wrksrc/libiberty/Makefile.in
}

pre_install()
{
	if [ "$xbps_machine" = "x86_64" ]; then
		mkdir -vp ${SRCPKGDESTDIR}/usr/lib
		cd ${SRCPKGDESTDIR}/usr && ln -sv lib lib64 && cd ${wrksrc}
	fi
}

post_install()
{
	cd ${DESTDIR}/usr/bin && ln -s gcc cc
	#
	# rpcgen wants /lib/cpp, make a symlink.
	#
	mkdir -p ${DESTDIR}/lib
	cd ${DESTDIR}/lib && ln -s ../usr/bin/cpp .
}
