# Template file for 'klibc-udev'
pkgname=klibc-udev
version=139
wrksrc="udev-${version}"
distfiles="
http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev-$version.tar.bz2"
build_style=custom-install
short_desc="A Userspace implementation of devfs (for initramfs)"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=6786a896146b12323d0ef31601dc23b6e5501762d7d61c475d09e405494c21df
long_desc="
 udev is a implementation of devfs in userspace using sysfs and
 /sbin/hotplug. It requires a 2.5/2.6 kernel to run properly.

 This package has been built with klibc for use on the initramfs."

Add_dependency build klibc
Add_dependency run klibc

do_install()
{
	local destdir=$XBPS_DESTDIR/$pkgname-$version

	cd $wrksrc
	CC=klcc LD=klcc CFLAGS="-O2" ./configure --prefix=
	make || exit 1

	install -d ${destdir}/usr/lib/klibc/udev
	install -s -m755 udev/udevd ${destdir}/usr/lib/klibc/udev
	install -s -m755 udev/udevadm ${destdir}/usr/lib/klibc/udev
	install -m755 extras/path_id/path_id ${destdir}/usr/lib/klibc/udev
	install -s -m755 extras/volume_id/vol_id ${destdir}/usr/lib/klibc/udev

	# Install the initramfs-tools hook.
	install -d $destdir/usr/share/initramfs-tools/hooks
	install -d $destdir/usr/share/initramfs-tools/scripts/init-premount
	install -d $destdir/usr/share/initramfs-tools/scripts/init-bottom
	install -m 755 ${FILESDIR}/udev.initramfs-hook \
		$destdir/usr/share/initramfs-tools/hooks/udev
	install -m 755 ${FILESDIR}/udev.initramfs-premount \
		$destdir/usr/share/initramfs-tools/scripts/init-premount/udev
	install -m 755 ${FILESDIR}/udev.initramfs-bottom \
		$destdir/usr/share/initramfs-tools/scripts/init-bottom/udev
}
