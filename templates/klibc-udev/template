# Template file for 'klibc-udev'
pkgname=klibc-udev
version=142
wrksrc="udev-${version}"
distfiles="${KERNEL_SITE}//utils/kernel/hotplug/udev-$version.tar.bz2"
build_style=custom-install
short_desc="A Userspace implementation of devfs (for initramfs)"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=59c819d4717bc4940a5372c027ebf569e992949778ec1b20a12a0e3b3d4d165b
long_desc="
 udev is a implementation of devfs in userspace using sysfs and
 /sbin/hotplug. It requires a 2.5/2.6 kernel to run properly.

 This package has been built with klibc for use on the initramfs."

Add_dependency build klibc
Add_dependency run klibc
Add_dependency run udev

do_install()
{
	cd $wrksrc
	CC=klcc LD=klcc CFLAGS="-O2" ./configure --prefix=
	make || exit 1

	install -d ${DESTDIR}/usr/lib/klibc/udev
	install -s -m755 udev/udevd ${DESTDIR}/usr/lib/klibc/udev
	install -s -m755 udev/udevadm ${DESTDIR}/usr/lib/klibc/udev
	install -m755 extras/path_id/path_id ${DESTDIR}/usr/lib/klibc/udev

	# Install the initramfs-tools hook/scripts.
	install -d $DESTDIR/usr/share/initramfs-tools/hooks
	install -d $DESTDIR/usr/share/initramfs-tools/scripts/init-premount
	install -d $DESTDIR/usr/share/initramfs-tools/scripts/init-bottom
	install -m 755 ${FILESDIR}/udev.initramfs-hook \
		$DESTDIR/usr/share/initramfs-tools/hooks/udev
	install -m 755 ${FILESDIR}/udev.initramfs-premount \
		$DESTDIR/usr/share/initramfs-tools/scripts/init-premount/udev
	install -m 755 ${FILESDIR}/udev.initramfs-bottom \
		$DESTDIR/usr/share/initramfs-tools/scripts/init-bottom/udev
}
