# Template file for 'klibc-udev'
pkgname=klibc-udev
version=138
wrksrc="udev-${version}"
distfiles="
http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev-$version.tar.bz2"
build_style=custom-install
configure_args="--prefix="
configure_env="CC=klcc LD=klcc"
short_desc="A Userspace implementation of devfs (for initramfs)"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=bc525a4d6bdbace1b23433256643cc331e4049e1e2442333707e6d2ba8a173b4
long_desc="
 udev is a implementation of devfs in userspace using sysfs and
 /sbin/hotplug. It requires a 2.5/2.6 kernel to run properly.

 This package has been built with klibc for use on the initramfs."

Add_dependency build klibc-devel
Add_dependency run klibc

do_install()
{
	local destdir=$XBPS_DESTDIR/$pkgname-$version

	cd $wrksrc
	CC=klcc LD=klcc CFLAGS="-O2" ./configure --prefix=
	make || exit 1

	install -d ${destdir}/usr/lib/klibc/bin
	install -s -m755 udev/udevd ${destdir}/usr/lib/klibc/bin
	install -s -m755 udev/udevadm ${destdir}/usr/lib/klibc/bin

        # Install the initramfs-tools hook.
	install -d $destdir/usr/share/initramfs-tools/hooks
	install -d $destdir/usr/share/initramfs-tools/scripts/init-premount
	install -d $destdir/usr/share/initramfs-tools/scripts/init-bottom
	install -m 755 ${FILESDIR}/udev.initramfs-hook \
		$destdir/usr/share/initramfs-tools/hooks/udev
	install -m 755 ${FILESDIR}/udev.initramfs-premount \
		$destdir/usr/share/initramfs-tools/scripts/init-premount/udev
	install -m 755 ${FILESDIR}/udev.initramfs-bottom \
		$destdir/usr/share/initramfs-tools/scripts/init-bottom/udev
}
